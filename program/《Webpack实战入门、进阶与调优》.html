<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/blog-site/578220.ico"><title>《Webpack实战入门、进阶与调优》 | Leon Chen</title><meta name="description" content="">
    <link rel="modulepreload" href="/blog-site/assets/app.5b55431a.js"><link rel="modulepreload" href="/blog-site/assets/《Webpack实战入门、进阶与调优》.html.fec85784.js"><link rel="modulepreload" href="/blog-site/assets/《Webpack实战入门、进阶与调优》.html.d05e255b.js"><link rel="modulepreload" href="/blog-site/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/blog-site/assets/style.5c2fd74e.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog-site/" class=""><img class="logo" src="/blog-site/578220.png" alt="Leon Chen"><span class="site-name can-hide">Leon Chen</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog-site/program" class="router-link-active" aria-label="编程书籍笔记"><!--[--><!--]--> 编程书籍笔记 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/promote" class="" aria-label="课外书籍笔记"><!--[--><!--]--> 课外书籍笔记 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/questions" class="" aria-label="编程疑问清单"><!--[--><!--]--> 编程疑问清单 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/leetcode" class="" aria-label="LeetCode题解"><!--[--><!--]--> LeetCode题解 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog-site/program" class="router-link-active" aria-label="编程书籍笔记"><!--[--><!--]--> 编程书籍笔记 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/promote" class="" aria-label="课外书籍笔记"><!--[--><!--]--> 课外书籍笔记 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/questions" class="" aria-label="编程疑问清单"><!--[--><!--]--> 编程疑问清单 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/leetcode" class="" aria-label="LeetCode题解"><!--[--><!--]--> LeetCode题解 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">《Webpack实战入门、进阶与调优》 <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#第1章-webpack简介" class="router-link-active router-link-exact-active sidebar-item" aria-label="第1章 Webpack简介"><!--[--><!--]--> 第1章 Webpack简介 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_1-1-何为webpack" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.1 何为Webpack"><!--[--><!--]--> 1.1 何为Webpack <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_1-2-为什么需要webpack" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.2 为什么需要Webpack"><!--[--><!--]--> 1.2 为什么需要Webpack <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_1-3-安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.3 安装"><!--[--><!--]--> 1.3 安装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_1-4-打包第一个应用" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.4 打包第一个应用"><!--[--><!--]--> 1.4 打包第一个应用 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#第2章-模块打包" class="router-link-active router-link-exact-active sidebar-item" aria-label="第2章 模块打包"><!--[--><!--]--> 第2章 模块打包 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_2-1-commonjs" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.1 CommonJS"><!--[--><!--]--> 2.1 CommonJS <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_2-2-es6-module" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.2 ES6 Module"><!--[--><!--]--> 2.2 ES6 Module <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_2-3-commonjs和es6-module的区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.3 CommonJS和ES6 Module的区别"><!--[--><!--]--> 2.3 CommonJS和ES6 Module的区别 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_2-4-加载其他类型模块" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.4 加载其他类型模块"><!--[--><!--]--> 2.4 加载其他类型模块 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_2-5-模块打包原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.5 模块打包原理"><!--[--><!--]--> 2.5 模块打包原理 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#第3章-资源输入输出" class="router-link-active router-link-exact-active sidebar-item" aria-label="第3章 资源输入输出"><!--[--><!--]--> 第3章 资源输入输出 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_3-1-资源处理流程" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.1 资源处理流程"><!--[--><!--]--> 3.1 资源处理流程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_3-2-配置资源入口" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.2 配置资源入口"><!--[--><!--]--> 3.2 配置资源入口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_3-3-配置资源出口" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.3 配置资源出口"><!--[--><!--]--> 3.3 配置资源出口 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#第4章-预处理器" class="router-link-active router-link-exact-active sidebar-item" aria-label="第4章 预处理器"><!--[--><!--]--> 第4章 预处理器 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_4-1-一切皆模块" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1 一切皆模块"><!--[--><!--]--> 4.1 一切皆模块 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_4-2-loader概述" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2 loader概述"><!--[--><!--]--> 4.2 loader概述 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_4-3-loader的配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3 loader的配置"><!--[--><!--]--> 4.3 loader的配置 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_4-4-常用loader介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4 常用loader介绍"><!--[--><!--]--> 4.4 常用loader介绍 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_4-5-自定义loader" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.5 自定义loader"><!--[--><!--]--> 4.5 自定义loader <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#第5章-样式处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="第5章 样式处理"><!--[--><!--]--> 第5章 样式处理 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_5-1-分离样式文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1 分离样式文件"><!--[--><!--]--> 5.1 分离样式文件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_5-2-样式预处理" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2 样式预处理"><!--[--><!--]--> 5.2 样式预处理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_5-3-postcss" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.3 PostCSS"><!--[--><!--]--> 5.3 PostCSS <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_5-4-css-modules" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.4 CSS Modules"><!--[--><!--]--> 5.4 CSS Modules <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#第6章-代码分片" class="router-link-active router-link-exact-active sidebar-item" aria-label="第6章 代码分片"><!--[--><!--]--> 第6章 代码分片 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_6-1-通过入口划分代码" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.1 通过入口划分代码"><!--[--><!--]--> 6.1 通过入口划分代码 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_6-2-optimization-splitchunks" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.2 optimization.SplitChunks"><!--[--><!--]--> 6.2 optimization.SplitChunks <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_6-3-资源异步加载" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.3 资源异步加载"><!--[--><!--]--> 6.3 资源异步加载 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#第7章-生产环境配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="第7章 生产环境配置"><!--[--><!--]--> 第7章 生产环境配置 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_7-1-环境配置的封装" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.1 环境配置的封装"><!--[--><!--]--> 7.1 环境配置的封装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_7-2-开启production模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.2 开启production模式"><!--[--><!--]--> 7.2 开启production模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_7-3-环境变量" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.3 环境变量"><!--[--><!--]--> 7.3 环境变量 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_7-4-source-map" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.4 source map"><!--[--><!--]--> 7.4 source map <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_7-5-资源压缩" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.5 资源压缩"><!--[--><!--]--> 7.5 资源压缩 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_7-6-缓存" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.6 缓存"><!--[--><!--]--> 7.6 缓存 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_7-7-bundle体积监控和分析" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.7 bundle体积监控和分析"><!--[--><!--]--> 7.7 bundle体积监控和分析 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#第8章-打包优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="第8章 打包优化"><!--[--><!--]--> 第8章 打包优化 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_8-1-happypack" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.1 HappyPack"><!--[--><!--]--> 8.1 HappyPack <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_8-2-缩小打包作用域" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.2 缩小打包作用域"><!--[--><!--]--> 8.2 缩小打包作用域 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_8-3-动态链接库与dllplugin" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.3 动态链接库与DllPlugin"><!--[--><!--]--> 8.3 动态链接库与DllPlugin <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_8-4-tree-shaking" class="router-link-active router-link-exact-active sidebar-item" aria-label="8.4 tree shaking"><!--[--><!--]--> 8.4 tree shaking <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#第9章-开发环境调优" class="router-link-active router-link-exact-active sidebar-item" aria-label="第9章 开发环境调优"><!--[--><!--]--> 第9章 开发环境调优 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_9-1-webpack开发效率插件" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.1 Webpack开发效率插件"><!--[--><!--]--> 9.1 Webpack开发效率插件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_9-2-模块热替换" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.2 模块热替换"><!--[--><!--]--> 9.2 模块热替换 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#第10章-更多javascript打包工具" class="router-link-active router-link-exact-active sidebar-item" aria-label="第10章 更多JavaScript打包工具"><!--[--><!--]--> 第10章 更多JavaScript打包工具 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_10-1-rollup" class="router-link-active router-link-exact-active sidebar-item" aria-label="10.1 Rollup"><!--[--><!--]--> 10.1 Rollup <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8AWebpack%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8%E3%80%81%E8%BF%9B%E9%98%B6%E4%B8%8E%E8%B0%83%E4%BC%98%E3%80%8B.html#_10-2-parcel" class="router-link-active router-link-exact-active sidebar-item" aria-label="10.2 Parcel"><!--[--><!--]--> 10.2 Parcel <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="第1章-webpack简介" tabindex="-1"><a class="header-anchor" href="#第1章-webpack简介" aria-hidden="true">#</a> 第1章 Webpack简介</h2><h3 id="_1-1-何为webpack" tabindex="-1"><a class="header-anchor" href="#_1-1-何为webpack" aria-hidden="true">#</a> 1.1 何为Webpack</h3><p>Webpack是一个开源的JavaScript模块打包工具，其最核心的功能是解决模块之间的依赖，把各个模块按照特定的规则和顺序组织在一起，最终合并为一个JS文件。</p><h3 id="_1-2-为什么需要webpack" tabindex="-1"><a class="header-anchor" href="#_1-2-为什么需要webpack" aria-hidden="true">#</a> 1.2 为什么需要Webpack</h3><h4 id="_1-2-1-何为模块" tabindex="-1"><a class="header-anchor" href="#_1-2-1-何为模块" aria-hidden="true">#</a> 1.2.1 何为模块</h4><p>按照特定的功能将其拆分为多个代码段，每个代码段实现一个特定的目的。</p><h4 id="_1-2-2-javascript中的模块" tabindex="-1"><a class="header-anchor" href="#_1-2-2-javascript中的模块" aria-hidden="true">#</a> 1.2.2 JavaScript中的模块</h4><p>通过导入和导出语句我们可以清晰的看到模块间的依赖关系。</p><p>模块可以借助工具来进行打包，在页面中只需要加载合并后的资源文件，减少了网络开销。</p><p>多个模块之间的作用域是隔离的，彼此不会有命名冲突。</p><h4 id="_1-2-3-模块打包工具" tabindex="-1"><a class="header-anchor" href="#_1-2-3-模块打包工具" aria-hidden="true">#</a> 1.2.3 模块打包工具</h4><p>模块打包工具的任务就是解决模块间的依赖，使其打包后的结果能运行在浏览器上。他的工作方式主要分为两种：</p><ul><li>将存在依赖关系的模块按照特定规则合并为单个JS文件，一次全部加载进页面中。</li><li>在页面初始时加载一个入口模块，其他模块异步的进行加载。</li></ul><h4 id="_1-2-4-为什么选择webpack" tabindex="-1"><a class="header-anchor" href="#_1-2-4-为什么选择webpack" aria-hidden="true">#</a> 1.2.4 为什么选择Webpack</h4><p>Webpack具备以下几点优势：</p><ul><li>Webpack默认支持多种模块标准。包括AMD、CommonJS，以及最新的ES6模块。</li><li>Webpack有完备的代码分割（code splitting）解决方案。它可以分割打包后的资源，首屏只加载必要的部分，不太重要的功能放到后面动态的加载。</li><li>Webpack可以处理各种类型的资源。Webpack还可以处理样式、模板，甚至图片等。</li><li>Webpack拥有庞大的社区支持。</li></ul><h3 id="_1-3-安装" tabindex="-1"><a class="header-anchor" href="#_1-3-安装" aria-hidden="true">#</a> 1.3 安装</h3><p><code>npm i webpack webpack-cli -S</code></p><p>webpack是核心模块，webpack-cli是命令行工具。</p><h3 id="_1-4-打包第一个应用" tabindex="-1"><a class="header-anchor" href="#_1-4-打包第一个应用" aria-hidden="true">#</a> 1.4 打包第一个应用</h3><p>打包模式mode分为：development、production、none三种模式。</p><p>使用script添加脚本命令。</p><p>webpack-dev-server的两大职能：</p><ul><li>令Webpack进行模块打包，并处理打包结果的资源请求。</li><li>作为普通的Web Server，处理静态资源文件请求。</li></ul><p>webpack-dev-server只是将打包结果放在内存中，并不会写入实际的bundle.js。它还有一项很便捷的特性就是live-reloading（自动刷新）。</p><h2 id="第2章-模块打包" tabindex="-1"><a class="header-anchor" href="#第2章-模块打包" aria-hidden="true">#</a> 第2章 模块打包</h2><h3 id="_2-1-commonjs" tabindex="-1"><a class="header-anchor" href="#_2-1-commonjs" aria-hidden="true">#</a> 2.1 CommonJS</h3><p>CommonJS是由JavaScript社区于2009年提出的包含模块、文件、IO、控制台在内的一系列标准。</p><h4 id="_2-1-1-模块" tabindex="-1"><a class="header-anchor" href="#_2-1-1-模块" aria-hidden="true">#</a> 2.1.1 模块</h4><p>CommonJS规定每个文件是一个模块。</p><p>每个模块拥有各自的作用域。</p><h4 id="_2-1-2-导出" tabindex="-1"><a class="header-anchor" href="#_2-1-2-导出" aria-hidden="true">#</a> 2.1.2 导出</h4><p><code>module.export</code>和<code>export</code>导出模块。</p><p>建议将<code>module.export</code>和<code>export</code>放在模块的末尾</p><h4 id="_2-1-3-导入" tabindex="-1"><a class="header-anchor" href="#_2-1-3-导入" aria-hidden="true">#</a> 2.1.3 导入</h4><p><code>require()</code></p><p>当我们require一个模块时会有两种情况：</p><ul><li>require的模块是第一次被加载。这时会首先执行该模块，然后导出内容。</li><li>require的模块曾被加载过。这时该模块的代码不会再次执行，而是直接导出上次执行后得到的结果。</li></ul><h3 id="_2-2-es6-module" tabindex="-1"><a class="header-anchor" href="#_2-2-es6-module" aria-hidden="true">#</a> 2.2 ES6 Module</h3><h4 id="_2-2-1-模块" tabindex="-1"><a class="header-anchor" href="#_2-2-1-模块" aria-hidden="true">#</a> 2.2.1 模块</h4><p>ES6 Module将每个文件作为一个模块。ES6 Module会自动采用严格模式。</p><h4 id="_2-2-2-导出" tabindex="-1"><a class="header-anchor" href="#_2-2-2-导出" aria-hidden="true">#</a> 2.2.2 导出</h4><ul><li>命名导出。<code>export const xx</code></li><li>默认导出。<code>export default</code></li></ul><h4 id="_2-2-3-导入" tabindex="-1"><a class="header-anchor" href="#_2-2-3-导入" aria-hidden="true">#</a> 2.2.3 导入</h4><p><code>import</code>和<code>import xx from</code></p><h4 id="_2-2-4-复合写法" tabindex="-1"><a class="header-anchor" href="#_2-2-4-复合写法" aria-hidden="true">#</a> 2.2.4 复合写法</h4><p>`export { name, add } from &#39;./xx.js&#39;</p><p>把某一模块导入之后立即导出。</p><h3 id="_2-3-commonjs和es6-module的区别" tabindex="-1"><a class="header-anchor" href="#_2-3-commonjs和es6-module的区别" aria-hidden="true">#</a> 2.3 CommonJS和ES6 Module的区别</h3><h4 id="_2-3-1-动态与静态" tabindex="-1"><a class="header-anchor" href="#_2-3-1-动态与静态" aria-hidden="true">#</a> 2.3.1 动态与静态</h4><p>CommonJS和ES6 Module的本质区别在于CommonJS对模块依赖关系的建立发生在代码运行阶段，而ES6 Module的模块依赖关系的建立发生在代码编译阶段。</p><p>ES6 Module相比CommonJS具备的几点优势：</p><ul><li>死代码检测和排除。检测哪些模块没有被调用过。</li><li>模块变量类型检查。</li><li>编译器优化。</li></ul><h4 id="_2-3-2-值拷贝与动态映射" tabindex="-1"><a class="header-anchor" href="#_2-3-2-值拷贝与动态映射" aria-hidden="true">#</a> 2.3.2 值拷贝与动态映射</h4><p>在导入一个模块时，对于CommonJS来说获取的是一份<strong>导出值的拷贝</strong>；而在ES6 Module中则是<strong>值的动态映射</strong>，并且这个映射是只读的。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">// Commonjs</span></span>
<span class="line"><span style="color:#616E88;">// calculator.js</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">0</span></span>
<span class="line"><span style="color:#8FBCBB;">module</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">exports</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#D8DEE9;">count</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">add</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">b</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">+=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">1</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">return</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">a</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">+</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">b</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#616E88;">// index.js</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">./calculator.js</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">count</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">add</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">./calculator.js</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">add</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;">) </span><span style="color:#616E88;">// 0</span></span>
<span class="line"><span style="color:#88C0D0;">add</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">3</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;">) </span><span style="color:#616E88;">// 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">count</span><span style="color:#81A1C1;">++</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;">) </span><span style="color:#616E88;">// 1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">// ES6 Module</span></span>
<span class="line"><span style="color:#616E88;">// calculator.js</span></span>
<span class="line"><span style="color:#81A1C1;">let</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">0</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">add</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">b</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">+=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">1</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">return</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">a</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">+</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">b</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#81A1C1;">export</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#D8DEE9;">count</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#D8DEE9;">add</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// index.js</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;"> </span><span style="color:#8FBCBB;">count</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#8FBCBB;">add</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">from</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">./calculator.js</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;">) </span><span style="color:#616E88;">// 0</span></span>
<span class="line"><span style="color:#88C0D0;">add</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">3</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;">) </span><span style="color:#616E88;">// 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9;">count</span><span style="color:#81A1C1;">++</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;">// 不可更改，会抛出SyntaxError: &#39;count&#39; is read-only</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_2-3-3-循环依赖" tabindex="-1"><a class="header-anchor" href="#_2-3-3-循环依赖" aria-hidden="true">#</a> 2.3.3 循环依赖</h4><p>尽量避免循环依赖的产生。ES6 Module的特性使其更好地支持循环依赖。</p><h3 id="_2-4-加载其他类型模块" tabindex="-1"><a class="header-anchor" href="#_2-4-加载其他类型模块" aria-hidden="true">#</a> 2.4 加载其他类型模块</h3><h4 id="_2-4-1-非模块化文件" tabindex="-1"><a class="header-anchor" href="#_2-4-1-非模块化文件" aria-hidden="true">#</a> 2.4.1 非模块化文件</h4><p>通过import直接引入即可</p><h4 id="_2-4-2-amd" tabindex="-1"><a class="header-anchor" href="#_2-4-2-amd" aria-hidden="true">#</a> 2.4.2 AMD</h4><p>AMD是Asynchronous Module Definition（异步模块定义）。它加载模块的方式是异步的。</p><h4 id="_2-4-3-umd" tabindex="-1"><a class="header-anchor" href="#_2-4-3-umd" aria-hidden="true">#</a> 2.4.3 UMD</h4><p>UMD的全称是Universal Module Definition，通用模块标准。它的目标是使一个模块能运行在各种环境下。</p><h4 id="_2-4-4-加载npm模块" tabindex="-1"><a class="header-anchor" href="#_2-4-4-加载npm模块" aria-hidden="true">#</a> 2.4.4 加载npm模块</h4><p>npm和yarn两者的仓库是共通的。</p><p><code>npm init -y</code>初始化</p><h3 id="_2-5-模块打包原理" tabindex="-1"><a class="header-anchor" href="#_2-5-模块打包原理" aria-hidden="true">#</a> 2.5 模块打包原理</h3><p>打包结果（bundle）可以分为以下几个部分：</p><ul><li>最外层立即执行匿名函数。用来包裹整个bundle，并构成自身的作用域。</li><li>installedModules对象。每个模块只在第一次被加载的时候执行，之后其导出值就被存储到这个对象里面。</li><li><code>__webpack_require__</code>函数。对模块加载的实现。</li><li>modules对象。工程中所有产生了依赖关系的模块都会以key-value的形式放在这里。key可以理解为一个模块的id，由数字或者一个很短的hash字符串构成；value则是由一个匿名函数包裹的模块实体，匿名函数的参数则赋予了每个模块导出和导入的能力。</li></ul><p>bundle如何在浏览器中执行的</p><ol><li>在最外层的匿名函数中会初始化浏览器执行环境，包括定义installedModules对象、<code>__webpack_require__</code>函数等，为模块的夹杂和执行做一些准备工作。</li><li>加载入口模块。每个bundle都有且只有一个入口模块，在上面的示例中，index.js是入口模块，在浏览器中会从它开始执行。</li><li>执行模块代码。如果执行到了module.exports则记录下模块的导出值；如果中间遇到require函数（准确的说是<code>__webpack_require__</code>），则会暂时交出执行权，进入<code>__webpack_require__</code>函数体内进行加载其他模块的逻辑。</li><li>在<code>__webpack_require__</code>中会判断即将加载的模块是否存在于installedModules中。如果存在则直接取值，否则回到第3步，执行该模块的代码来获取导出值。</li><li>所有依赖的模块都已执行完毕，最后执行权又回到入口模块。当入口模块的代码执行到结尾，也就意味着整个bundle运行结束。</li></ol><h2 id="第3章-资源输入输出" tabindex="-1"><a class="header-anchor" href="#第3章-资源输入输出" aria-hidden="true">#</a> 第3章 资源输入输出</h2><h3 id="_3-1-资源处理流程" tabindex="-1"><a class="header-anchor" href="#_3-1-资源处理流程" aria-hidden="true">#</a> 3.1 资源处理流程</h3><p><strong>chunk</strong>的字面的意思是代码块，在Webpack中可以理解成被抽象和包装过后的一些模块。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2Ckpfe.jpg" alt="2Ckpfe.jpg"></p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2CkE0P.jpg" alt="2CkE0P.jpg"></p><h3 id="_3-2-配置资源入口" tabindex="-1"><a class="header-anchor" href="#_3-2-配置资源入口" aria-hidden="true">#</a> 3.2 配置资源入口</h3><p>在配置入口时，实际上做了两件事：</p><ul><li>确定入口模块位置，告诉Webpack从哪里开始进行打包。</li><li>定义chunk name。如果工程只有一个入口，name默认其chunk name为“main”；如果工程有多个入口，我们需要为每个入口定义chunk name，来作为该chunk的唯一标识。</li></ul><h4 id="_3-2-1-context" tabindex="-1"><a class="header-anchor" href="#_3-2-1-context" aria-hidden="true">#</a> 3.2.1 context</h4><p>context可以理解为资源入口的<strong>路径前缀</strong>，在配置时要求必须使用绝对路径的形式。</p><h4 id="_3-2-2-entry" tabindex="-1"><a class="header-anchor" href="#_3-2-2-entry" aria-hidden="true">#</a> 3.2.2 entry</h4><p>entry的配置有多种形式：字符串、数组、对象、函数。</p><h4 id="_3-2-3-实例" tabindex="-1"><a class="header-anchor" href="#_3-2-3-实例" aria-hidden="true">#</a> 3.2.3 实例</h4><h5 id="_1-单页应用" tabindex="-1"><a class="header-anchor" href="#_1-单页应用" aria-hidden="true">#</a> 1.单页应用</h5><p>对于单页应用（SPA）来说，一般定义单一入口即可。</p><h5 id="_2-提取vendor" tabindex="-1"><a class="header-anchor" href="#_2-提取vendor" aria-hidden="true">#</a> 2.提取vendor</h5><p>vendor的意思是“供应商”，在Webpack中vendor一般指的是工程所使用的库、框架等第三方模块集合打包而产生的bundle。</p><h5 id="_3-多页应用" tabindex="-1"><a class="header-anchor" href="#_3-多页应用" aria-hidden="true">#</a> 3.多页应用</h5><p>提供多个入口，形成多个bundle。</p><h3 id="_3-3-配置资源出口" tabindex="-1"><a class="header-anchor" href="#_3-3-配置资源出口" aria-hidden="true">#</a> 3.3 配置资源出口</h3><h4 id="_3-3-1-filename" tabindex="-1"><a class="header-anchor" href="#_3-3-1-filename" aria-hidden="true">#</a> 3.3.1 filename</h4><p>filename的作用是控制输出资源的文件名，字符串。</p><p>Webpack支持使用一种类似模板语言的形式动态地生成文件名。<code>output: { filename: &#39;[name].js&#39; }</code></p><p>filename配置项模板变量</p><table><thead><tr><th style="text-align:center;">变量名称</th><th style="text-align:center;">功能描述</th></tr></thead><tbody><tr><td style="text-align:center;">[chunkhash]</td><td style="text-align:center;">指代当前chunk内容的hash</td></tr><tr><td style="text-align:center;">[hash]</td><td style="text-align:center;">指代Webpack此次打包所有资源生成的hash</td></tr><tr><td style="text-align:center;">[id]</td><td style="text-align:center;">指代当前chunk的id</td></tr><tr><td style="text-align:center;">[query]</td><td style="text-align:center;">指代filenmae配置项中的query</td></tr></tbody></table><p>变量的两个作用：</p><ul><li><p>对不同的chunk进行区分。</p></li><li><p>控制客户端缓存。</p><p>更新缓存一般只用在生产环境的配置下。</p></li></ul><h4 id="_3-3-2-path" tabindex="-1"><a class="header-anchor" href="#_3-3-2-path" aria-hidden="true">#</a> 3.3.2 path</h4><p>path可以指定资源输出的位置，要求值必须为绝对路径。</p><h4 id="_3-3-3-publicpath" tabindex="-1"><a class="header-anchor" href="#_3-3-3-publicpath" aria-hidden="true">#</a> 3.3.3 publicPath</h4><p>publicPath用来指定资源的请求位置。</p><ul><li>输出位置：打包完成后资源产生的目录，一般将其指定为工程中的dist目录。</li><li>请求位置：由JS或CSS所请求的间接资源路径。页面中的资源分为两种，一种是由HTML页面直接请求，比如通过script标签加载的JS；另一种是由JS或CSS请求的，如异步加载的JS、从CSS请求的图片字体等。publicPath的作用就是制定这部分间接资源的请求位置。</li></ul><p>publicPath有3中形式：</p><ol><li><p>HTML相关。</p></li><li><p>Host相关。</p><p>若值为“/”开始，则代表是以当前页面的host name为基础路径。</p></li><li><p>CDN相关</p><p>当publicPath以协议头或相对协议的形成开始时，代表当前路径是CDN相关。</p></li></ol><p>devServer的publicPath指的是静态资源服务路径。</p><h4 id="_3-3-4-实例" tabindex="-1"><a class="header-anchor" href="#_3-3-4-实例" aria-hidden="true">#</a> 3.3.4 实例</h4><h4 id="_1-单入口" tabindex="-1"><a class="header-anchor" href="#_1-单入口" aria-hidden="true">#</a> 1.单入口</h4><p>对于单入口的场景，通常不必设置动态地output.filename，直接指定输出的文件名即可。</p><h5 id="_2-多入口" tabindex="-1"><a class="header-anchor" href="#_2-多入口" aria-hidden="true">#</a> 2.多入口</h5><p>在多入口的场景下，必然会需要模板变量来配置filename。</p><h2 id="第4章-预处理器" tabindex="-1"><a class="header-anchor" href="#第4章-预处理器" aria-hidden="true">#</a> 第4章 预处理器</h2><p>预处理器（loader），它赋予了Webpack可处理不同资源类型的能力。</p><h3 id="_4-1-一切皆模块" tabindex="-1"><a class="header-anchor" href="#_4-1-一切皆模块" aria-hidden="true">#</a> 4.1 一切皆模块</h3><p>对webpack来说，所有静态资源都模块。Webpack维护模块间的关系可以使工程结构更加直观，代码的可维护性更强。</p><h3 id="_4-2-loader概述" tabindex="-1"><a class="header-anchor" href="#_4-2-loader概述" aria-hidden="true">#</a> 4.2 loader概述</h3><p>每个loader本质上都是一个函数。在Webpack4之后，loader同时支持字符串和抽象语法书（AST）的传递。</p><p>用公式表达loader的本质：<code>output = loader(input)</code>。</p><p>这里的input可能是工程源文件的字符串，也可能是上一个loader转化后的结果，包括转化后的结果（也是字符串类型）、source map，以及AST对象；</p><p>output同样包含转化后的文件字符串、source map，以及AST。</p><p>如果这是最后一个loader，结果将直接被送到Webpack进行后续处理，否则将作为下一个loader的输入向后传递。</p><p>loader本身就是一个函数，在该函数中对接收到的内容进行转换，然后返回转换后的结果。</p><h3 id="_4-3-loader的配置" tabindex="-1"><a class="header-anchor" href="#_4-3-loader的配置" aria-hidden="true">#</a> 4.3 loader的配置</h3><p>loader的字面意思是装载器，在Webpack中它的实际功能则更像是预处理器。Webpack本身只认识JavaScript，对于其他类型的资源必须预先定义一个或多个loader对其进行转译，输出为Webpack能够接收的形式再继续进行。</p><h4 id="_4-3-1-loader的引入" tabindex="-1"><a class="header-anchor" href="#_4-3-1-loader的引入" aria-hidden="true">#</a> 4.3.1 loader的引入</h4><p>loader都是一些第三方npm模块，Webpack本身并不包含任何loader。</p><p>与loader相关的配置都在module对象中，其中<code>module.rules</code>代表了模块的处理规则。每条规则内部可以包含很多配置项，这里介绍最重要的两项——test和use。</p><ul><li>test可接收一个正则表达式或者一个元素为正则表达式的数组，只有正则匹配上的模块才会使用这条规则。</li><li>use可接收一个数组，数组包含该规则所使用的loader。</li></ul><h4 id="_4-3-2-链式loader" tabindex="-1"><a class="header-anchor" href="#_4-3-2-链式loader" aria-hidden="true">#</a> 4.3.2 链式loader</h4><p><code>use: [&#39;style-loader&#39;, &#39;css-loader&#39;]</code>。</p><p>Webpack打包时是按照数组<strong>从后往前</strong>的顺序将资源交给loader处理的。</p><h4 id="_4-3-3-loader-options" tabindex="-1"><a class="header-anchor" href="#_4-3-3-loader-options" aria-hidden="true">#</a> 4.3.3 loader options</h4><p>在引入loader的时候可以通过options将它们传入。</p><h4 id="_4-3-4-更多配置" tabindex="-1"><a class="header-anchor" href="#_4-3-4-更多配置" aria-hidden="true">#</a> 4.3.4 更多配置</h4><h5 id="_1-exclude与include" tabindex="-1"><a class="header-anchor" href="#_1-exclude与include" aria-hidden="true">#</a> 1.exclude与include</h5><p>exclude和include是用来排除或包含指定目录下的模块，可接收正则表达式或者字符串，以及由它们组成的数组。</p><p><code>exclude: /node_modules/</code>。<code>include: /src/</code>。该配置通常是比较的，否则可能拖慢整体的打包速度。</p><p>exclude和include同时存在时，exclude的优先级更高。</p><h5 id="_2-resource与issuer" tabindex="-1"><a class="header-anchor" href="#_2-resource与issuer" aria-hidden="true">#</a> 2.resource与issuer</h5><p>resource与issuer可用于更加精确地确定模块规则的作用范围。</p><p>在Webpack中，被加载者是resource，加载者是issuer。test、exclude、include本质上属于对resourece也就是被加载者的配置。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">rules</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">use</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">style-loader</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">css-loader</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">resource</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.css</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    	</span><span style="color:#88C0D0;">exclude</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">node-modules</span><span style="color:#ECEFF4;">/</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#D8DEE9;">issuer</span><span style="color:#D8DEE9FF;">: </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.js</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">include</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">src</span><span style="color:#ECEFF4;">/</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h5 id="_3-enforce" tabindex="-1"><a class="header-anchor" href="#_3-enforce" aria-hidden="true">#</a> 3.enforce</h5><p>enforce用来指定一个loader的种类，只接受“pre”或“post”两个字符串类型的值。</p><p>Webpack中的loader按照执行顺序可分为pre、inline、normal、post四种类型。inline官方已推荐不使用。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.js</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  enforce</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">pre</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  use</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">eslint-loader</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>“pre”表示将在所有正常loader之前执行。需要在所有loader之后执行的可以使用“post”。</p><p>我们也可以不适用enforce而只要保证loader顺序是正确的即可。</p><h3 id="_4-4-常用loader介绍" tabindex="-1"><a class="header-anchor" href="#_4-4-常用loader介绍" aria-hidden="true">#</a> 4.4 常用loader介绍</h3><h4 id="_4-4-1-babel-loader" tabindex="-1"><a class="header-anchor" href="#_4-4-1-babel-loader" aria-hidden="true">#</a> 4.4.1 babel-loader</h4><p>babel-loader用来处理ES6+并将其编译为ES5。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.js</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      exclude</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">node_modules</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      use</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        loader</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">babel-loader</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        options</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          cacheDirectory</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          presets</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [[</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">env</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">              </span><span style="color:#88C0D0;">modules</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">false</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          ]]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_4-4-2-ts-loader" tabindex="-1"><a class="header-anchor" href="#_4-4-2-ts-loader" aria-hidden="true">#</a> 4.4.2 ts-loader</h4><p>ts-loader用于连接Webpack与Typescript的模块。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.ts</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    use</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">ts-loader</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_4-4-3-html-loader" tabindex="-1"><a class="header-anchor" href="#_4-4-3-html-loader" aria-hidden="true">#</a> 4.4.3 html-loader</h4><p>html-loader用于将HTML文件转化为字符串并进行格式化，这使得我们可以把一个HTML片段通过JS加载进来。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.html</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      use</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">html-loader</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_4-4-4-handlebars-loader" tabindex="-1"><a class="header-anchor" href="#_4-4-4-handlebars-loader" aria-hidden="true">#</a> 4.4.4 handlebars-loader</h4><p>handlebars-loader用于处理handlebars模板。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.handlebars</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      use</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">handlebars-loader</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_4-4-5-file-loader" tabindex="-1"><a class="header-anchor" href="#_4-4-5-file-loader" aria-hidden="true">#</a> 4.4.5 file-loader</h4><p>file-loader用于打包文件类型的资源，并返回其publicPath。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">			test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.</span><span style="color:#ECEFF4;">(</span><span style="color:#EBCB8B;">png</span><span style="color:#81A1C1;">|</span><span style="color:#EBCB8B;">jpg</span><span style="color:#81A1C1;">|</span><span style="color:#EBCB8B;">gif</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">			use</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">file-loader</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_4-4-6-url-loader" tabindex="-1"><a class="header-anchor" href="#_4-4-6-url-loader" aria-hidden="true">#</a> 4.4.6 url-loader</h4><p>url-loader与file-loader作用类似，唯一不同在于用户可以设置一个文件大小的阈值，当大于阈值返回publicPath，小于阈值返回base64形式编码。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.</span><span style="color:#ECEFF4;">(</span><span style="color:#EBCB8B;">png</span><span style="color:#81A1C1;">|</span><span style="color:#EBCB8B;">jpg</span><span style="color:#81A1C1;">|</span><span style="color:#EBCB8B;">gif</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        use</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          loader</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">url-loader</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          options</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            limit</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">10240</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            name</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">[name].[ext]</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            publicPath</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">./assets-path</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_4-4-7-vue-loader" tabindex="-1"><a class="header-anchor" href="#_4-4-7-vue-loader" aria-hidden="true">#</a> 4.4.7 vue-loader</h4><p>vue-loader用于处理vue组件。</p><p><a href="https://vue-loader-v14.vuejs.org/zh-cn/" target="_blank" rel="noopener noreferrer">vue-loader介绍<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><h3 id="_4-5-自定义loader" tabindex="-1"><a class="header-anchor" href="#_4-5-自定义loader" aria-hidden="true">#</a> 4.5 自定义loader</h3><h4 id="_1-loader初始化" tabindex="-1"><a class="header-anchor" href="#_1-loader初始化" aria-hidden="true">#</a> 1.loader初始化</h4><h4 id="_2-启用缓存" tabindex="-1"><a class="header-anchor" href="#_2-启用缓存" aria-hidden="true">#</a> 2.启用缓存</h4><p>Webpack中可以使用this.cacheable进行控制。</p><h4 id="_3-获取options" tabindex="-1"><a class="header-anchor" href="#_3-获取options" aria-hidden="true">#</a> 3.获取options</h4><p><code>loader-utils</code>依赖库可以用于提供一些帮助函数。</p><h4 id="_4-source-map" tabindex="-1"><a class="header-anchor" href="#_4-source-map" aria-hidden="true">#</a> 4.source-map</h4><p>source-map可以便于实际开发者在浏览器控制台查看源码。</p><h2 id="第5章-样式处理" tabindex="-1"><a class="header-anchor" href="#第5章-样式处理" aria-hidden="true">#</a> 第5章 样式处理</h2><h3 id="_5-1-分离样式文件" tabindex="-1"><a class="header-anchor" href="#_5-1-分离样式文件" aria-hidden="true">#</a> 5.1 分离样式文件</h3><p>mini-css-extract-plugin（适用于Webpack4及以上），专门用于提取样式到CSS文件。</p><h4 id="_5-1-1-mini-css-extract-plugin" tabindex="-1"><a class="header-anchor" href="#_5-1-1-mini-css-extract-plugin" aria-hidden="true">#</a> 5.1.1 mini-css-extract-plugin</h4><p>plugins用于接收一个插件数组，我们可以使用Webpack内部提供的一些插件，也可以加载外部插件。</p><h4 id="_5-1-2-多样式文件的处理" tabindex="-1"><a class="header-anchor" href="#_5-1-2-多样式文件的处理" aria-hidden="true">#</a> 5.1.2 多样式文件的处理</h4><p><code>[name].css</code>处理多样式文件。</p><h3 id="_5-2-样式预处理" tabindex="-1"><a class="header-anchor" href="#_5-2-样式预处理" aria-hidden="true">#</a> 5.2 样式预处理</h3><h4 id="_5-2-1-sass与scss" tabindex="-1"><a class="header-anchor" href="#_5-2-1-sass与scss" aria-hidden="true">#</a> 5.2.1 Sass与SCSS</h4><p>现在使用更多的是SCSS（对CSS3的扩充版本）。</p><p>sass-loader就是将SCSS语法编译为CSS。</p><p>node-sass用来编译SCSS。</p><h4 id="_5-2-2-less" tabindex="-1"><a class="header-anchor" href="#_5-2-2-less" aria-hidden="true">#</a> 5.2.2 Less</h4><p><code>less-loader</code>。</p><h3 id="_5-3-postcss" tabindex="-1"><a class="header-anchor" href="#_5-3-postcss" aria-hidden="true">#</a> 5.3 PostCSS</h3><p>PostCSS是一个编译插件的容器，它的工作模式是接受样式源代码并交由编译插件处理，最后输出CSS。</p><h4 id="_5-3-1-postcss与webpack" tabindex="-1"><a class="header-anchor" href="#_5-3-1-postcss与webpack" aria-hidden="true">#</a> 5.3.1 PostCSS与Webpack</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">rules</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.css</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">use</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">style-loader</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">css-loader</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">postcss-loader</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    ]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_5-3-2-自动前缀" tabindex="-1"><a class="header-anchor" href="#_5-3-2-自动前缀" aria-hidden="true">#</a> 5.3.2 自动前缀</h4><p>结合Autoprefixer自动添加厂商前缀。</p><h4 id="_5-3-3-stylelint" tabindex="-1"><a class="header-anchor" href="#_5-3-3-stylelint" aria-hidden="true">#</a> 5.3.3 stylelint</h4><p>stylelint是一个CSS的质量检测工具，就像eslint一样，可以为其添加各种规则，来统一项目的代码规范。</p><p>在postcss.config.js中添加相应的配置。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  plugins</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">stylelint</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{}</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  ]</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_5-3-4-cssnext" tabindex="-1"><a class="header-anchor" href="#_5-3-4-cssnext" aria-hidden="true">#</a> 5.3.4 CSSNext</h4><p>CSSNext可以让我们在应用中使用最新的css语法特性。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  plugins</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">postcssNext</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{}</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  ]</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_5-4-css-modules" tabindex="-1"><a class="header-anchor" href="#_5-4-css-modules" aria-hidden="true">#</a> 5.4 CSS Modules</h3><p>CSS Modules的理念就是CSS模块化，具体如下：</p><ul><li>每个CSS文件中的样式都拥有单独的作用域，不会和外界发生命名冲突。</li><li>对CSS进行依赖管理，可以通过相对路径引入CSS文件。</li><li>可以通过composes轻松复用其他CSS模块。</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.css</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        use</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">style-loader</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">loader</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">css-loader</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">options</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#88C0D0;">modules</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#88C0D0;">localIdentName</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">[name]__[local]__[hash:base64:5]</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#ECEFF4;">},</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">postcss-loader</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="第6章-代码分片" tabindex="-1"><a class="header-anchor" href="#第6章-代码分片" aria-hidden="true">#</a> 第6章 代码分片</h2><p>代码分片（code splitting）可以把代码按照特定的形式进行拆分，使用户不必一次全部加载，而是按需加载。</p><h3 id="_6-1-通过入口划分代码" tabindex="-1"><a class="header-anchor" href="#_6-1-通过入口划分代码" aria-hidden="true">#</a> 6.1 通过入口划分代码</h3><p>可以把一些库和工具放在一个单独的入口，该入口产生的资源不会经常更新，可以有效利用客户端缓存。</p><h3 id="_6-2-optimization-splitchunks" tabindex="-1"><a class="header-anchor" href="#_6-2-optimization-splitchunks" aria-hidden="true">#</a> 6.2 optimization.SplitChunks</h3><p>公共模块提取的好处：</p><ul><li>开发过程中减少了重复模块打包，可以提升开发速度。</li><li>减小整体资源体积。</li><li>合理分片后的代码可以有效地利用客户端缓存。</li></ul><p>optimization.SplitChunks是Webpack4为了改进CommonsChunkPlugin而重新设计和实现的代码分片特性。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">optimization</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  splitChunks</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    chunks</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">all</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#616E88;">// 这个配置项的含义是，SplitChunks将会对所有的chunks生效。</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_6-2-1-从命令式到声明式" tabindex="-1"><a class="header-anchor" href="#_6-2-1-从命令式到声明式" aria-hidden="true">#</a> 6.2.1 从命令式到声明式</h4><p>splitChunks默认情形下的提取条件：</p><ul><li>提取后的chunk可被共享或者来自node_modules目录。</li><li>提取后的JavaScript chunk体积大于30kB（压缩和gzip之前），CSS chunk体积大于50kB。</li><li>在按需加载过程中，并行请求的资源最大值小于等于5。</li><li>在首次加载时，并行请求的资源数最大值小于等于3。</li></ul><h4 id="_6-2-2-默认的异步提取" tabindex="-1"><a class="header-anchor" href="#_6-2-2-默认的异步提取" aria-hidden="true">#</a> 6.2.2 默认的异步提取</h4><p>默认情况下满足上面4个条件就会被提取。</p><h4 id="_6-2-3-配置" tabindex="-1"><a class="header-anchor" href="#_6-2-3-配置" aria-hidden="true">#</a> 6.2.3 配置</h4><p>splitChunks默认配置。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">splitChunks</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  chunks</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">async</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  minSize</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    javascript</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">30000</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    style</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">50000</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">},</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  maxSize</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  minChunks</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  maxAsyncRequests</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">5</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  maxInitialRequests</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">3</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  automaticNameDelimiter</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">~</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  name</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  cacheGroups</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  	vendors</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  		test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/[</span><span style="color:#EBCB8B;">\\/</span><span style="color:#ECEFF4;">]</span><span style="color:#EBCB8B;">node_modules</span><span style="color:#ECEFF4;">[</span><span style="color:#EBCB8B;">\\/</span><span style="color:#ECEFF4;">]/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  		priority</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">10</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  	</span><span style="color:#ECEFF4;">},</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  	</span><span style="color:#81A1C1;">default</span><span style="color:#D8DEE9FF;">: </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  		</span><span style="color:#88C0D0;">minChunks</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  		</span><span style="color:#88C0D0;">priority</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">20</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  		</span><span style="color:#88C0D0;">reuseExistingChunk</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">true</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  	</span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><ol><li><p>匹配模式</p><p>chunks字段配置工作模式有3个可选值，分别是async（默认）、initial和all。</p></li><li><p>匹配条件</p><p>maxSize、minChunks、maxAsyncRequests、maxInitialRequests都属于匹配条件。</p></li><li><p>命名</p><p>配置项name默认为true，意味着splitChunks可以根据cacheGroups和作用范围自动为新生成的chunk命名，并以autoMaticNameDelimiter分隔。</p></li><li><p>cacheGroups</p><p>分离chunks时的规则。默认情况下有两种规则——vendors和dafault。vendors用于提取所有node_modules中符合条件的模块，default则作用于被多次引用的模块。</p></li></ol><h3 id="_6-3-资源异步加载" tabindex="-1"><a class="header-anchor" href="#_6-3-资源异步加载" aria-hidden="true">#</a> 6.3 资源异步加载</h3><p>资源异步加载（按需加载）主要解决当模块数量过多、资源体积过大时，可以把一些暂时使用不到的模块延迟加载。</p><h4 id="_6-3-1-import" tabindex="-1"><a class="header-anchor" href="#_6-3-1-import" aria-hidden="true">#</a> 6.3.1 import()</h4><p>通过import函数加载的模块及其依赖会被异步地进行加载，并返回一个Promise对象。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">// foo.js</span></span>
<span class="line"><span style="color:#81A1C1;">import</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">./bar.js</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">then</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">add</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#D8DEE9;">console</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">log</span><span style="color:#D8DEE9FF;">(</span><span style="color:#88C0D0;">add</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">3</span><span style="color:#D8DEE9FF;">))</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// bar.js</span></span>
<span class="line"><span style="color:#81A1C1;">export</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">add</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">b</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">return</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">a</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">+</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">b</span><span style="color:#81A1C1;">;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>首屏加载的JS资源地址是通过页面中的script标签来指定的，而间接资源（通过首屏JS再进一步加载的JS）的位置则要通过output.publicPath来指定。</p><p>Webpack的import函数可以在任何我们希望的时候调用，而ES6 Module中的import必须出现在代码的顶层作用域。</p><h4 id="_6-3-2-异步chunk的配置" tabindex="-1"><a class="header-anchor" href="#_6-3-2-异步chunk的配置" aria-hidden="true">#</a> 6.3.2 异步chunk的配置</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">output</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">	chunkFilename</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">[name].js</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// foo.js</span></span>
<span class="line"><span style="color:#88C0D0;">import</span><span style="color:#D8DEE9FF;">(</span><span style="color:#616E88;">/* webpackChunkName: &quot;aaa&quot; */</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">./bar.js</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>通过特有的注释来让Webpack获取到异步chunk的名字，并配置output.chunkFilename为[name].js。</p><h2 id="第7章-生产环境配置" tabindex="-1"><a class="header-anchor" href="#第7章-生产环境配置" aria-hidden="true">#</a> 第7章 生产环境配置</h2><h3 id="_7-1-环境配置的封装" tabindex="-1"><a class="header-anchor" href="#_7-1-环境配置的封装" aria-hidden="true">#</a> 7.1 环境配置的封装</h3><ol><li>使用相同的配置文件。</li><li>为不同环境创建各自的配置文件。</li></ol><h3 id="_7-2-开启production模式" tabindex="-1"><a class="header-anchor" href="#_7-2-开启production模式" aria-hidden="true">#</a> 7.2 开启production模式</h3><p><code>mode: &#39;production&#39;</code>。Webpack会自动添加许多适用于生产环境的配置项，减少了人为手动的工作。</p><h3 id="_7-3-环境变量" tabindex="-1"><a class="header-anchor" href="#_7-3-环境变量" aria-hidden="true">#</a> 7.3 环境变量</h3><p>在Webpack中可以使用DefinePlugin进行设置，为生产环境和本地环境添加不同的环境变量。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">plugins</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">new</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">webpack</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">DefinePlugin</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">ENV</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">production</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">IS_PRODUCTION</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">true</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">ENV_ID</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#B48EAD;">111111</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">CONSTANTS</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">JSON</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">stringify</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">TYPES</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">foo</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">bar</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// app.js</span></span>
<span class="line"><span style="color:#D8DEE9;">document</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">ENV</span><span style="color:#D8DEE9FF;">) </span><span style="color:#616E88;">// production</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>许多框架和库都采用<code>proces.env.NODE_ENV</code>作为一个区别开发环境和生成环境的变量。如果启用了mode：production，Webpack会设置好<code>proces.env.NODE_ENV</code>，不需要人为再添加。</p><h3 id="_7-4-source-map" tabindex="-1"><a class="header-anchor" href="#_7-4-source-map" aria-hidden="true">#</a> 7.4 source map</h3><p>source map 是指将编译、打包、压缩后的代码映射回源代码的过程。</p><h4 id="_7-4-1-原理" tabindex="-1"><a class="header-anchor" href="#_7-4-1-原理" aria-hidden="true">#</a> 7.4.1 原理</h4><p>Webpack对于源代码的每一步处理都有可能会改变代码的位置、结构，甚至是所处文件，因此每一步都需要生成对应的source map。若我们启用了devtool配置项，source map就会跟随源代码一步步被传递，直到生成最后的map文件。</p><h4 id="_7-4-2-source-map配置" tabindex="-1"><a class="header-anchor" href="#_7-4-2-source-map配置" aria-hidden="true">#</a> 7.4.2 source map配置</h4><p><code>devtool: &#39;source-map&#39;</code>。开启source map之后，打开Chrome的开发者工具，在“Sources”选项卡下面的“webpack://”目录中可以找到解析后的工程源码。</p><p>source map还有cheap-source-map、eval-source-map等。</p><h4 id="_7-4-3-安全" tabindex="-1"><a class="header-anchor" href="#_7-4-3-安全" aria-hidden="true">#</a> 7.4.3 安全</h4><p>Webpack提供了hidden-source-map及nonsoureces-source-map两种策略来提升source map的安全性。</p><p>hidden-source-map会产出完整的map文件，但是不会在bundle文件中添加对map文件的引用。这样一来我们就无法追溯源码，我们可以使用**Sentry（错误跟踪平台，开发者接入后可以进行错误的收集和聚类）**来解决这个问题。</p><p>nosources-source-map，它对于安全性的保护则没那么强，但是使用方式相对简单。文件的具体内容会被隐藏起来，我们仍然可以在控制台查看源代码的错误栈。</p><p>还有另外一种选择是正常打包source map，然后通过服务器的nginx设置将.map文件只对固定的白名单（比如公司内网）开放。</p><h3 id="_7-5-资源压缩" tabindex="-1"><a class="header-anchor" href="#_7-5-资源压缩" aria-hidden="true">#</a> 7.5 资源压缩</h3><p>在将资源发布到线上环境前，我们通常都会进行代码压缩，或者叫uglify，意思是移除多余的空格、换行及执行不到的代码，缩短变量名，在执行结果不变的前提下将代码替换为更短的形式。</p><h4 id="_7-5-1-压缩javascript" tabindex="-1"><a class="header-anchor" href="#_7-5-1-压缩javascript" aria-hidden="true">#</a> 7.5.1 压缩JavaScript</h4><p>terser工具，支持ES6+代码的压缩，官方在Webpack4中默认使用了terser的插件terser-webpack-plugin。Webpack4如果开启了mode:production，则不需要人为 设置。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2CkYkT.jpg" alt="2CkYkT.jpg"></p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">// 覆盖默认的minimizer</span></span>
<span class="line"><span style="color:#D8DEE9FF;">optimization</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    minimizer</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#81A1C1;">new</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">TerserPlugin</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{}</span><span style="color:#D8DEE9FF;">)]</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_7-5-2-压缩css" tabindex="-1"><a class="header-anchor" href="#_7-5-2-压缩css" aria-hidden="true">#</a> 7.5.2 压缩CSS</h4><p>压缩CSS文件的前提是使用extract-text-webpack-plugin或mini-css-extract-plugin将样式提取出来，接着使用optimize-css-assets-webpack-plugin来进行压缩，这个插件本质上使用的是压缩器cssnano。</p><h3 id="_7-6-缓存" tabindex="-1"><a class="header-anchor" href="#_7-6-缓存" aria-hidden="true">#</a> 7.6 缓存</h3><p>缓存是指重复利用浏览器已经获取过的资源。</p><h4 id="_7-6-1-资源hash" tabindex="-1"><a class="header-anchor" href="#_7-6-1-资源hash" aria-hidden="true">#</a> 7.6.1 资源hash</h4><p>一个常用的方法是每次打包的过程中对资源的内容计算一次hash，并作为版本号存放在文件名中。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">output</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  filename</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">bundle@[chunkhash].js</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_7-6-2-输出动态html" tabindex="-1"><a class="header-anchor" href="#_7-6-2-输出动态html" aria-hidden="true">#</a> 7.6.2 输出动态HTML</h4><p>理想的情况是在打包结束后自动把最新的资源名同步过去。使用html-webpack-plugin可以帮我们做到这一点。</p><p><code>new HtmlWebpackPlguin({ template: xx.html })</code>。html-webpack-plugin会自动将我们打包出来的资源名放入生成的index.html中。</p><h4 id="_7-6-3-使chunk-id更稳定" tabindex="-1"><a class="header-anchor" href="#_7-6-3-使chunk-id更稳定" aria-hidden="true">#</a> 7.6.3 使chunk id更稳定</h4><p>理想状态下，对于缓存的应用是尽量让用户在启动时只更新代码变化的部分，而对没有变化的部分使用缓存。</p><p>从Webpack4以后已经修改了模块id的生成机制，也就不再有chunk id都改变的问题。</p><h3 id="_7-7-bundle体积监控和分析" tabindex="-1"><a class="header-anchor" href="#_7-7-bundle体积监控和分析" aria-hidden="true">#</a> 7.7 bundle体积监控和分析</h3><p>通过vs code的import cost插件进行模块大小的实时监测。也可以通过webpack-bundle-analyzer进行分析。</p><h2 id="第8章-打包优化" tabindex="-1"><a class="header-anchor" href="#第8章-打包优化" aria-hidden="true">#</a> 第8章 打包优化</h2><p>让打包的速度更快，输出的资源更小。</p><h3 id="_8-1-happypack" tabindex="-1"><a class="header-anchor" href="#_8-1-happypack" aria-hidden="true">#</a> 8.1 HappyPack</h3><p>HappyPack是一个通过多线程来提升Webpack打包速度的工具。</p><h4 id="_8-1-1-工作原理" tabindex="-1"><a class="header-anchor" href="#_8-1-1-工作原理" aria-hidden="true">#</a> 8.1.1 工作原理</h4><p>代码转译的工作流程： 1.从配置中获取打包入口； 2.匹配loader规则，并对入口模块进行转译。 3.对转译后的模块进行依赖查找（如a.js中加载了b.js和c.js）。 4.对新找到的模块重复进行步骤2和步骤3，直到没有新的依赖模块。</p><p>HappyPack使用于那些转译任务比较中的工程，比如babel-loader和ts-loader。</p><h4 id="_8-1-2-单个loader的优化" tabindex="-1"><a class="header-anchor" href="#_8-1-2-单个loader的优化" aria-hidden="true">#</a> 8.1.2 单个loader的优化</h4><p>用HappyPack提供的loader来替换原有loader，并将原有的那个通过HappyPack插件传进去。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">HappyPack</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">happypack</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#8FBCBB;">module</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">exports</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">module</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">rules</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.js</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">exclude</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">node_modules</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">loader</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">happypack/loader</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    ]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">},</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">plugins</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">new</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">HappyPack</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">loaders</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">loader</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">babel-loader</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">options</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#88C0D0;">presets</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">react</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      ]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  ]</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h4 id="_8-1-3-多个loader的优化" tabindex="-1"><a class="header-anchor" href="#_8-1-3-多个loader的优化" aria-hidden="true">#</a> 8.1.3 多个loader的优化</h4><p>优化多个loader时，需要为每一个loader配置一个id。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">HappyPack</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">happypack</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#8FBCBB;">module</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">exports</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">module</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">rules</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.js</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">exclude</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">node_modules</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">loader</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">happypack/loader?id=js</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#ECEFF4;">},</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.ts</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">exclude</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">node_modules</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">loader</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">happypack/loader?id=ts</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    ]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">},</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">plugins</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">new</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">HappyPack</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">id</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">js</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">loaders</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">loader</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">babel-loader</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">options</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      ]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">new</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">HappyPack</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">id</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">ts</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">loaders</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">loader</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">ts-loader</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">options</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      ]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;">    </span></span>
<span class="line"><span style="color:#D8DEE9FF;">  ]</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="_8-2-缩小打包作用域" tabindex="-1"><a class="header-anchor" href="#_8-2-缩小打包作用域" aria-hidden="true">#</a> 8.2 缩小打包作用域</h3><p>缩小范围针对任务本身，比如去掉冗余的流程，尽量不做重复性的工作等。</p><h4 id="_8-2-1-exclude和include" tabindex="-1"><a class="header-anchor" href="#_8-2-1-exclude和include" aria-hidden="true">#</a> 8.2.1 exclude和include</h4><p>一般使用exclude和include排除掉node_modules目录。</p><h4 id="_8-2-2-noparse" tabindex="-1"><a class="header-anchor" href="#_8-2-2-noparse" aria-hidden="true">#</a> 8.2.2 noParse</h4><p>noParse可以对模块进行忽略，这些模块仍然会被打包进资源文件，只不过Webpack不会对其进行任何解析。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#8FBCBB;">module</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">exports</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">module</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">noParse</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">lodash</span><span style="color:#ECEFF4;">/</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_8-2-3-ignoreplugin" tabindex="-1"><a class="header-anchor" href="#_8-2-3-ignoreplugin" aria-hidden="true">#</a> 8.2.3 IgnorePlugin</h4><p>IgnorePlugin可以完全排除一些模块，被排除的模块即便被引用了也不会被打包进资源文件中。</p><p>这对于排除一些库相关文件非常有用。一些由库产生的额外资源我们用不到但又无法去掉，因为引用的语句处于库文件的内部。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">plugins</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">new</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">webpack</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">IgnorePlugin</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">resourceRegExp</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#81A1C1;">^</span><span style="color:#EBCB8B;">\.\/locals</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;">// 匹配资源文件</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">contextRegExp</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">moment</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;">// 匹配检索目录</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_8-2-4-cache" tabindex="-1"><a class="header-anchor" href="#_8-2-4-cache" aria-hidden="true">#</a> 8.2.4 Cache</h4><p>有些loader会有一个cache配置项，用来在编译代码后同时保存一份缓存，在执行下一次编译前会先检查源文件是否有变化，如果没有就直接采用缓存，也就是上次编译的结果。</p><p>在Webpack5中添加了一个新的配置项<code>cache: { type: &quot;filesystem&quot; }</code>，它会在全局启用一个文件缓存。</p><h3 id="_8-3-动态链接库与dllplugin" tabindex="-1"><a class="header-anchor" href="#_8-3-动态链接库与dllplugin" aria-hidden="true">#</a> 8.3 动态链接库与DllPlugin</h3><p>动态链接库是早期Windows解决计算机内存空间较小的一种内存优化方法。当一段相同的子程序被多个程序调用时，为了减少内存消耗，可以将这段子程序存储为一个可执行文件，当被多个程序调用时只在内存中生成和使用同一个实例。</p><p>DllPlugin借鉴了动态链接库的这种思路，对于第三方模块或者一些不常用变化的模块，可以将它们预先编译和打包，然后在项目实际构建过程中直接取用即可。</p><p>DllPlugin和Code Splitting有点类似，都可以用来提取公共模块，但本质上有一些区别。Code Splitting的思路是设置一些特定的规则并在打包的过程中根据这些规则提取模块；DllPlugin则是将vendor完全拆出来，有自己的一整套Webpack配置并独立打包，在实际工程构建时就不用再对它进行任何处理，直接取用即可。</p><h4 id="_8-3-1-vendor配置" tabindex="-1"><a class="header-anchor" href="#_8-3-1-vendor配置" aria-hidden="true">#</a> 8.3.1 vendor配置</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">// webpack.vendor.config.js</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">path</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">path</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">webpack</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">webpack</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">dllAssetPath</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">join</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__dirname</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">dll</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">dllLibraryName</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">dllExample</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8FBCBB;">module</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">exports</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">entry</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">react</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">]</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">output</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">path</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">dllAssetPath</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">filename</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">vendor.js</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">library</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">dllLibraryName</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#ECEFF4;">},</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">plugins</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#81A1C1;">new</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">webpack</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">DllPlugin</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#88C0D0;">name</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">dllLibraryName</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#88C0D0;">path</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">join</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">dllAssetPath</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">manifest.json</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    ]</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_8-3-2-vendor打包" tabindex="-1"><a class="header-anchor" href="#_8-3-2-vendor打包" aria-hidden="true">#</a> 8.3.2 vendor打包</h4><p>打包之后会生成一个dll目录，vendor.js包含了库的代码，manifest.json是资源清单。</p><h4 id="_8-3-3-链接到业务代码" tabindex="-1"><a class="header-anchor" href="#_8-3-3-链接到业务代码" aria-hidden="true">#</a> 8.3.3 链接到业务代码</h4><p>将vendor链接到项目中很简单，通过DllReferencePlugin，它起到一个索引和链接的作用。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#81A1C1;">new</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">webpack</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">DllReferencePlugin</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">manifest</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">join</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">__dirname</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">dll/manifest.json</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">))</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">// index.html</span></span>
<span class="line"><span style="color:#81A1C1;">&lt;script</span><span style="color:#D8DEE9FF;"> </span><span style="color:#8FBCBB;">src</span><span style="color:#81A1C1;">=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">../dll/vendor.js</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">&gt;&lt;/script&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>当页面执行到vendor.js时，会声明dllExample全局变量。而manifest相当于我们注入app.js的资源地图。</p><h3 id="_8-4-tree-shaking" tabindex="-1"><a class="header-anchor" href="#_8-4-tree-shaking" aria-hidden="true">#</a> 8.4 tree shaking</h3><p>tree shaking可以在打包过程中帮助我们检测工程中没有被引用过得模块，这部分代码将永远无法被执行到，因此也被称为“死代码”。Webpack会对这部分代码进行标记，并在资源压缩时将它们从最终的bundle中去掉。</p><h4 id="_8-4-1-es6-module" tabindex="-1"><a class="header-anchor" href="#_8-4-1-es6-module" aria-hidden="true">#</a> 8.4.1 ES6 Module</h4><p>tree shaking只能对ES6 Module生效。如果bundle的体积并没有因为tree shaking而减小，这可能是由于该库是使用CommonJS的形式导出的。</p><p>我们应该尽可能使用ES6 Module形式的模块，这样tree shaking的效率更高。</p><h4 id="_8-4-2-使用webpack进行依赖关系构建" tabindex="-1"><a class="header-anchor" href="#_8-4-2-使用webpack进行依赖关系构建" aria-hidden="true">#</a> 8.4.2 使用Webpack进行依赖关系构建</h4><p>如果我们在工程中使用了babel-loader，那么一定要通过配置来禁用它的模块依赖解析。因为如果由babel-loader来做依赖解析，Webpack接受到的就都是转化过得CommonJS形式的模块，无法进行tree-shaking。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">rules</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.js</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">exclude</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">node_modules</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">use</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">loader</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">babel-loader</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">options</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">presets</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          [@</span><span style="color:#D8DEE9;">babel</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9;">preset</span><span style="color:#81A1C1;">-</span><span style="color:#D8DEE9;">env</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">modules</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">false</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        ]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_8-4-3-使用压缩工具去除死代码" tabindex="-1"><a class="header-anchor" href="#_8-4-3-使用压缩工具去除死代码" aria-hidden="true">#</a> 8.4.3 使用压缩工具去除死代码</h4><p>tree shaking本身只是为死代码添加上标记，真正去除死代码是通过压缩工具来进行的。在Webpack4之后的版本，将mode设置为production可以达到压缩的效果。</p><h2 id="第9章-开发环境调优" tabindex="-1"><a class="header-anchor" href="#第9章-开发环境调优" aria-hidden="true">#</a> 第9章 开发环境调优</h2><h3 id="_9-1-webpack开发效率插件" tabindex="-1"><a class="header-anchor" href="#_9-1-webpack开发效率插件" aria-hidden="true">#</a> 9.1 Webpack开发效率插件</h3><h4 id="_9-1-1-webpack-dashboard" tabindex="-1"><a class="header-anchor" href="#_9-1-1-webpack-dashboard" aria-hidden="true">#</a> 9.1.1 webpack-dashboard</h4><p>webpack-dashboard用于更好地展示控制台输出的一些打包相关的信息。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#81A1C1;">new</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">DashboardPlugin</span><span style="color:#D8DEE9FF;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_9-1-2-webpack-merge" tabindex="-1"><a class="header-anchor" href="#_9-1-2-webpack-merge" aria-hidden="true">#</a> 9.1.2 webpack-merge</h4><p>webpack-merge对于需要配置多种打包环境的项目来说非常实用。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">merge</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">webpack-merge</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#8FBCBB;">module</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">exports</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">merge</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">smart</span><span style="color:#D8DEE9FF;">(</span><span style="color:#D8DEE9;">commonConfig</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">mode</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">production</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">module</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">rules</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> [</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">test</span><span style="color:#ECEFF4;">:</span><span style="color:#EBCB8B;"> </span><span style="color:#ECEFF4;">/</span><span style="color:#EBCB8B;">\.css</span><span style="color:#81A1C1;">$</span><span style="color:#ECEFF4;">/</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#81A1C1;">...</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    ]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>合并代码时会自动添加，不需要编写冗余的代码。</p><h4 id="_9-1-3-speed-measure-webpack-plugin" tabindex="-1"><a class="header-anchor" href="#_9-1-3-speed-measure-webpack-plugin" aria-hidden="true">#</a> 9.1.3 speed-measure-webpack-plugin</h4><p>speed-measure-webpack-plugin简称SMP，SMP可以分析出Webpack整个打包过程中的各个loader和plugin上耗费的时间。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">// webpack.xx.config.js</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">SpeedMeasurePlugin</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">require</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">speed-measure-webpack-plugin</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"><span style="color:#81A1C1;">const</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">smp</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">new</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">SpeedMeasurePlugin</span><span style="color:#D8DEE9FF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#8FBCBB;">module</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">exports</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">smp</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">wrap</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">entry</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">./app.js</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#ECEFF4;">,</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">...</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_9-1-4-size-plugin" tabindex="-1"><a class="header-anchor" href="#_9-1-4-size-plugin" aria-hidden="true">#</a> 9.1.4 size-plugin</h4><p>size-plugin可以帮助我们监控资源体积的变化，尽早地发现问题。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#81A1C1;">new</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">SizePlugin</span><span style="color:#D8DEE9FF;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_9-2-模块热替换" tabindex="-1"><a class="header-anchor" href="#_9-2-模块热替换" aria-hidden="true">#</a> 9.2 模块热替换</h3><p>只要检测到代码改动就会自动重新构建，然后触发网页刷新，这种一般被称为live reload。Webpack在live reload的基础上又进一步，可以让代码在网页不刷新的前提下得到最新的改动，甚至不需要重新发起请求就能看到更新后的效果，这就是模块热替换（Hot Module Replacement，HMR）。</p><h4 id="_9-2-1-开启hmr" tabindex="-1"><a class="header-anchor" href="#_9-2-1-开启hmr" aria-hidden="true">#</a> 9.2.1 开启HMR</h4><p>HMR是需要手动开启的，并且有一些必要条件。</p><p>确保项目是基于webpack-dev-server或webpack-dev-middle进行开发，Webpack本身的命令行并不支持HMR。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">devServer</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  hot</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">true</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>上面配置产生的结果是Webpack会为每个模块绑定一个module.hot对象，这个对象包含了HMR的API。</p><p>调用HMR API有两种方式，一种是手动地添加这部分代码，另一种是借助一些现成的工具，比如react-hot-loader、vue-loader等。</p><h4 id="_9-2-2-hmr原理" tabindex="-1"><a class="header-anchor" href="#_9-2-2-hmr原理" aria-hidden="true">#</a> 9.2.2 HMR原理</h4><p>在本地开发环境下，浏览器是客户端，webpack-dev-server（WDS）相当于是我们的服务端。HMR的核心就是客户端从服务端拉取更新后的资源（HMR拉取的不是整个资源文件，而是chunk diff，即chunk需要更新的部分）。</p><p>WDS与浏览器之间维护了一个websocket，当本地资源发生变化时WDS会向浏览器推送更新事件，并带上这次构建的hash，让客户端与上一次资源进行比对。</p><p>如果客户端知道新的构建结果和当前的有了差别，就会向WDS发起一个请求来获取更改文件的列表，通常这个请求的名字为[hash].hot-update.json。</p><h4 id="_9-2-3-hmr-api示例" tabindex="-1"><a class="header-anchor" href="#_9-2-3-hmr-api示例" aria-hidden="true">#</a> 9.2.3 HMR API示例</h4><p><code>module.hot.accept()</code>只要发生改变就在当前环境下全部重新执行一遍。</p><h2 id="第10章-更多javascript打包工具" tabindex="-1"><a class="header-anchor" href="#第10章-更多javascript打包工具" aria-hidden="true">#</a> 第10章 更多JavaScript打包工具</h2><h3 id="_10-1-rollup" tabindex="-1"><a class="header-anchor" href="#_10-1-rollup" aria-hidden="true">#</a> 10.1 Rollup</h3><p>Webpack的优势在于它更全面，基于“一切皆模块”的思想而衍生出丰富的loader和plugin可以满足各种使用场景。</p><p>Rollup更专注于JavaScript的打包。不包含无关代码，资源体积更小。</p><p>Rollup有一项Webpack不具备的特性，即通过配置output.format开发者可以选择输出资源的模块形式（CommonJS，amd，esm，iife，umd及system）。</p><h3 id="_10-2-parcel" tabindex="-1"><a class="header-anchor" href="#_10-2-parcel" aria-hidden="true">#</a> 10.2 Parcel</h3><p>Parcel在JavaScript打包工具中属于相对后来者。（使用的人不多）。</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: czl624824554@163.com">chenzilin</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog-site/assets/app.5b55431a.js" defer></script>
  </body>
</html>
