<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/blog-site/578220.ico"><title>Leon Chen</title><meta name="description" content="">
    <link rel="modulepreload" href="/blog-site/assets/app.5b55431a.js"><link rel="modulepreload" href="/blog-site/assets/《Linux命令行与shell脚本编程大全》.html.9fe88163.js"><link rel="modulepreload" href="/blog-site/assets/《Linux命令行与shell脚本编程大全》.html.49d9757d.js"><link rel="modulepreload" href="/blog-site/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/blog-site/assets/style.5c2fd74e.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog-site/" class=""><img class="logo" src="/blog-site/578220.png" alt="Leon Chen"><span class="site-name can-hide">Leon Chen</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog-site/program" class="router-link-active" aria-label="编程书籍笔记"><!--[--><!--]--> 编程书籍笔记 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/promote" class="" aria-label="课外书籍笔记"><!--[--><!--]--> 课外书籍笔记 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/questions" class="" aria-label="编程疑问清单"><!--[--><!--]--> 编程疑问清单 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/leetcode" class="" aria-label="LeetCode题解"><!--[--><!--]--> LeetCode题解 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog-site/program" class="router-link-active" aria-label="编程书籍笔记"><!--[--><!--]--> 编程书籍笔记 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/promote" class="" aria-label="课外书籍笔记"><!--[--><!--]--> 课外书籍笔记 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/questions" class="" aria-label="编程疑问清单"><!--[--><!--]--> 编程疑问清单 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/leetcode" class="" aria-label="LeetCode题解"><!--[--><!--]--> LeetCode题解 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第一部分-linux命令行" class="router-link-active router-link-exact-active sidebar-item" aria-label="第一部分 Linux命令行"><!--[--><!--]--> 第一部分 Linux命令行 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第1章-初识linux-shell" class="router-link-active router-link-exact-active sidebar-item" aria-label="第1章 初识Linux shell"><!--[--><!--]--> 第1章 初识Linux shell <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第2章-走进shell" class="router-link-active router-link-exact-active sidebar-item" aria-label="第2章 走进shell"><!--[--><!--]--> 第2章 走进shell <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第3章-基本的bash-shell命令" class="router-link-active router-link-exact-active sidebar-item" aria-label="第3章 基本的bash shell命令"><!--[--><!--]--> 第3章 基本的bash shell命令 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第4章-更多的bash-shell命令" class="router-link-active router-link-exact-active sidebar-item" aria-label="第4章 更多的bash shell命令"><!--[--><!--]--> 第4章 更多的bash shell命令 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第5章-理解shell" class="router-link-active router-link-exact-active sidebar-item" aria-label="第5章 理解shell"><!--[--><!--]--> 第5章 理解shell <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第6章-使用linux环境变量" class="router-link-active router-link-exact-active sidebar-item" aria-label="第6章 使用Linux环境变量"><!--[--><!--]--> 第6章 使用Linux环境变量 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第7章-理解linux文件权限" class="router-link-active router-link-exact-active sidebar-item" aria-label="第7章 理解Linux文件权限"><!--[--><!--]--> 第7章 理解Linux文件权限 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第8章-管理文件系统" class="router-link-active router-link-exact-active sidebar-item" aria-label="第8章 管理文件系统"><!--[--><!--]--> 第8章 管理文件系统 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第9章-安装软件程序" class="router-link-active router-link-exact-active sidebar-item" aria-label="第9章 安装软件程序"><!--[--><!--]--> 第9章 安装软件程序 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第10章-使用编辑器" class="router-link-active router-link-exact-active sidebar-item" aria-label="第10章 使用编辑器"><!--[--><!--]--> 第10章 使用编辑器 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第二部分-shell脚本编程基础" class="router-link-active router-link-exact-active sidebar-item" aria-label="第二部分 shell脚本编程基础"><!--[--><!--]--> 第二部分 shell脚本编程基础 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第11章-构建基本脚本" class="router-link-active router-link-exact-active sidebar-item" aria-label="第11章 构建基本脚本"><!--[--><!--]--> 第11章 构建基本脚本 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第12章-使用结构化命令" class="router-link-active router-link-exact-active sidebar-item" aria-label="第12章 使用结构化命令"><!--[--><!--]--> 第12章 使用结构化命令 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第13章-更多的结构化命令" class="router-link-active router-link-exact-active sidebar-item" aria-label="第13章 更多的结构化命令"><!--[--><!--]--> 第13章 更多的结构化命令 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第14章-处理用户输入" class="router-link-active router-link-exact-active sidebar-item" aria-label="第14章 处理用户输入"><!--[--><!--]--> 第14章 处理用户输入 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第15章-呈现数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="第15章 呈现数据"><!--[--><!--]--> 第15章 呈现数据 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第16章-控制脚本" class="router-link-active router-link-exact-active sidebar-item" aria-label="第16章 控制脚本"><!--[--><!--]--> 第16章 控制脚本 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第三部分-高级shell脚本编程" class="router-link-active router-link-exact-active sidebar-item" aria-label="第三部分 高级shell脚本编程"><!--[--><!--]--> 第三部分 高级shell脚本编程 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第17章-创建函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="第17章 创建函数"><!--[--><!--]--> 第17章 创建函数 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第四部分-创建实用的脚本" class="router-link-active router-link-exact-active sidebar-item" aria-label="第四部分 创建实用的脚本"><!--[--><!--]--> 第四部分 创建实用的脚本 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/program/%E3%80%8ALinux%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%8Eshell%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E5%A4%A7%E5%85%A8%E3%80%8B.html#第24章-编写简单的脚本实用工具" class="router-link-active router-link-exact-active sidebar-item" aria-label="第24章 编写简单的脚本实用工具"><!--[--><!--]--> 第24章 编写简单的脚本实用工具 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><p>[TOC]</p><h2 id="第一部分-linux命令行" tabindex="-1"><a class="header-anchor" href="#第一部分-linux命令行" aria-hidden="true">#</a> 第一部分 Linux命令行</h2><h3 id="第1章-初识linux-shell" tabindex="-1"><a class="header-anchor" href="#第1章-初识linux-shell" aria-hidden="true">#</a> 第1章 初识Linux shell</h3><h4 id="_1-1-什么是linux" tabindex="-1"><a class="header-anchor" href="#_1-1-什么是linux" aria-hidden="true">#</a> 1.1 什么是linux</h4><p>Linux分为四部分：</p><ul><li>Linux内核</li><li>GNU工具</li><li>图形化桌面环境</li><li>应用软件</li></ul><h5 id="_1-1-1-深入探究linux内核" tabindex="-1"><a class="header-anchor" href="#_1-1-1-深入探究linux内核" aria-hidden="true">#</a> 1.1.1 深入探究Linux内核</h5><p>内核负责以下四种功能：</p><ul><li><p>系统内存管理</p></li><li><p>软件程序管理</p><p>运行中的程序称为进程，进程可以在前台运行，输出显示在屏幕上，也可以在后台运行，隐藏到幕后。</p><p>Linux内核会创建第一个init进程来启动系统上所有其他进程。</p></li><li><p>硬件设备管理</p><p>驱动程序代码相当于应用程序和硬件设备的中间人，允许内核与设备之间交换数据。</p></li><li><p>文件系统管理</p></li></ul><h5 id="_1-1-2-gnu工具" tabindex="-1"><a class="header-anchor" href="#_1-1-2-gnu工具" aria-hidden="true">#</a> 1.1.2 GNU工具</h5><p>GNU组织（GNU&#39;s Not Unix）开发了一套完整的Unix工具。GNU是一套操作系统工具。</p><ol><li><p>核心GNU工具</p><p>GNU coreutils软件包由三部分构成：</p><ul><li>用以处理文件的工具</li><li>用以操作文本的工具</li><li>用以管理进程的工具</li></ul></li><li><p>shell</p><p>shell是一种特殊的交互式工具。它为用户提供了启动程序、管理文件系统中的文件以及运行在Linux系统上的进程的途径。shell的核心是命令行提示符，它允许你输入文本命令，然后解释命令，并在内核中执行。</p><p>将多个shell命令放入文件中作为程序执行的文件称为shell脚本。所有Linux发行版默认的shell都是bash shell。</p><p>几种常见的shell：</p><ul><li><p>ash</p></li><li><p>korn</p></li><li><p>tcsh</p></li><li><p>zsh</p><p>一种结合了bash、tcsh和korn的特性，同时提供高级编程特性、共享历史文件和主题化提示符的高级shell</p></li></ul></li></ol><h5 id="_1-1-3-linux桌面环境" tabindex="-1"><a class="header-anchor" href="#_1-1-3-linux桌面环境" aria-hidden="true">#</a> 1.1.3 Linux桌面环境</h5><ul><li>X Window系统</li><li>KDE桌面</li><li>GNOME桌面（Red Hat Linux）</li><li>Unity桌面（ubuntu）</li><li>其他桌面</li></ul><h4 id="_1-2-linux发行版" tabindex="-1"><a class="header-anchor" href="#_1-2-linux发行版" aria-hidden="true">#</a> 1.2 Linux发行版</h4><p>完整的Linux系统包称为发行版。</p><p>Linux发行版通常归类为3种：</p><ul><li><p>完整的核心Linux发行版</p><p>代表有：</p><ul><li>Slackware</li><li>Red Hat</li><li>Gentoo</li></ul></li><li><p>特定用途的发行版</p><p>代表有：</p><ul><li>CentOS</li><li>Ubuntu</li><li>PCLinuxOS</li></ul></li><li><p>LiveCD测试发行版</p><p>通过CD来启动PC，无需在硬盘安装任何东西就能运行LInux发行版</p><p>代表有：</p><ul><li>Knoppic</li><li>Ubuntu</li><li>PCLinuxOS</li></ul></li></ul><h3 id="第2章-走进shell" tabindex="-1"><a class="header-anchor" href="#第2章-走进shell" aria-hidden="true">#</a> 第2章 走进shell</h3><h4 id="_2-2-通过linux控制台终端访问cli" tabindex="-1"><a class="header-anchor" href="#_2-2-通过linux控制台终端访问cli" aria-hidden="true">#</a> 2.2 通过Linux控制台终端访问CLI</h4><p>在很多Linux发行版中，在完成启动过程之后会切换到图形化环境。</p><p>可以使用（Ctrl+Alt）+F1~F7功能键进入虚拟控制台。</p><p>在Linux虚拟控制台中是无法运行任何图形化程序的。</p><p><code>setterm -background white</code>可修改背景色，<code>-foreground</code>修改字体颜色。</p><p>如果要在GUI（图形化界面）访问CLI，可以使用终端仿真软件包。</p><h4 id="_2-3-通过图形化终端仿真访问cli" tabindex="-1"><a class="header-anchor" href="#_2-3-通过图形化终端仿真访问cli" aria-hidden="true">#</a> 2.3 通过图形化终端仿真访问CLI</h4><p>常用的有GNOME Terminial、Konsole Terminial和xterm。</p><h3 id="第3章-基本的bash-shell命令" tabindex="-1"><a class="header-anchor" href="#第3章-基本的bash-shell命令" aria-hidden="true">#</a> 第3章 基本的bash shell命令</h3><h4 id="_3-1-启动shell" tabindex="-1"><a class="header-anchor" href="#_3-1-启动shell" aria-hidden="true">#</a> 3.1 启动shell</h4><p><code>/etc/passwd</code>文件包含了所有系统用户账户列表以及每个用户的基本配置信息。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/EgsxT0.png" alt="EgsxT0"></p><h4 id="_3-2-shell提示符" tabindex="-1"><a class="header-anchor" href="#_3-2-shell提示符" aria-hidden="true">#</a> 3.2 shell提示符</h4><p>默认bash shell提示符是美元符号（<code>$</code>），这个符号表明shell在等待用户输入。</p><h4 id="_3-3-bash手册" tabindex="-1"><a class="header-anchor" href="#_3-3-bash手册" aria-hidden="true">#</a> 3.3 bash手册</h4><p><code>man</code>命令用来访问存储在Linux系统上的手册页面。<code>man xxx</code>。</p><blockquote><p><code>man -k terminal</code>查找与终端相关的命令。</p></blockquote><p>还有一种叫做info页面的信息，输入<code>info xxx</code>查看info页面的相关内容。</p><p>也可以查看帮助信息，通过<code>-help</code>或者<code>--help</code>选项。</p><h4 id="_3-4-浏览文件系统" tabindex="-1"><a class="header-anchor" href="#_3-4-浏览文件系统" aria-hidden="true">#</a> 3.4 浏览文件系统</h4><h5 id="_3-4-1-linux文件系统" tabindex="-1"><a class="header-anchor" href="#_3-4-1-linux文件系统" aria-hidden="true">#</a> 3.4.1 Linux文件系统</h5><p>Linux将文件存储在单个目录结构中，这个目录被称为虚拟目录（virtual directory）。虚拟目录将安装在PC上的所有存储设备的文件纳入单个目录结构中。Linux虚拟目录结构只包含一个称为根（root）目录的基础目录。</p><blockquote><p>在Linux中，反斜线（\）用来标识转义字符，文件路径用斜线（/)表示。</p></blockquote><p>在Linux上安装的第一块硬盘称为<strong>根驱动器</strong>。根驱动器包含了虚拟目录的核心，其他目录都是从那里开始构建的。Linux会在根驱动器上创建一些特别的目录，称为<strong>挂载点</strong>（mount point）。挂载点是虚拟目录中用于分配额外存储设备的目录。虚拟目录会让文件和目录出现在这些挂载点目录中，然而实际上它们却存储在另外一个驱动器中。</p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/IMG_5663.jpg" alt="IMG_5663" style="zoom:33%;"><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/IMG_5664.jpg" alt="IMG_5664" style="zoom:33%;"><h4 id="_3-5-文件和目录列表" tabindex="-1"><a class="header-anchor" href="#_3-5-文件和目录列表" aria-hidden="true">#</a> 3.5 文件和目录列表</h4><h5 id="_3-5-1-基本列表功能" tabindex="-1"><a class="header-anchor" href="#_3-5-1-基本列表功能" aria-hidden="true">#</a> 3.5.1 基本列表功能</h5><p><code>ls</code>查看当前目录的文件列表。</p><p><code>-F</code>用来区分文件和目录。</p><p><code>-R</code>表示递归选项，可以显示目录的子目录中的文件。</p><h5 id="_3-5-1-显示长列表" tabindex="-1"><a class="header-anchor" href="#_3-5-1-显示长列表" aria-hidden="true">#</a> 3.5.1 显示长列表</h5><p><code>-l</code>显示长列表。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/oJR35q.png" alt="oJR35q"></p><p>每一行都包含了关于文件（或目录的）的下述信息：</p><ul><li>文件类型，比如目录（d）、文件（-）、字符型文件（c）或块设备（b）；</li><li>文件的权限；</li><li>文件的硬链接总数；</li><li>文件属主的用户名；</li><li>文件属组的组名；</li><li>文件的大小（字节）；</li><li>文件的上次修改时间；</li><li>文件名或目录名。</li></ul><h5 id="_3-5-3-过滤输出列表" tabindex="-1"><a class="header-anchor" href="#_3-5-3-过滤输出列表" aria-hidden="true">#</a> 3.5.3 过滤输出列表</h5><p>在命令行参数之后添加过滤参数，比如<code>ls -l my_script</code>。</p><p>通配符（正则）匹配：</p><ul><li><code>?</code>代表一个字符。</li><li><code>*</code>代表零个或多个字符。</li></ul><p><code>ls -l f[a-i]ll</code>。</p><h4 id="_3-6-处理文件" tabindex="-1"><a class="header-anchor" href="#_3-6-处理文件" aria-hidden="true">#</a> 3.6 处理文件</h4><h5 id="_3-6-1-创建文件" tabindex="-1"><a class="header-anchor" href="#_3-6-1-创建文件" aria-hidden="true">#</a> 3.6.1 创建文件</h5><p><code>touch</code>用于创建空文件。</p><h5 id="_3-6-2-复制文件" tabindex="-1"><a class="header-anchor" href="#_3-6-2-复制文件" aria-hidden="true">#</a> 3.6.2 复制文件</h5><p><code>cp soure destination</code>用于复制文件。</p><p><code>-i</code>，强制shell咨询是否需要覆盖已有文件。</p><p><code>-R</code>递归地复制整个目录的内容。</p><p><code>cp * Document/</code>将所有文件和目录复制到Document目录下。</p><h5 id="_3-6-4-链接文件" tabindex="-1"><a class="header-anchor" href="#_3-6-4-链接文件" aria-hidden="true">#</a> 3.6.4 链接文件</h5><p>如需要在系统上维护同一文件的两份或多份副本，除了保存多份单独的物理文件副本之外，还可以采用保存一份物理文件副本和多个虚拟副本的方法，这种虚拟的副本就称为链接。链接是目录中指向文件真实位置的占位符。</p><p>在Linux中有两种不同类型的文件链接：1.符号链接（软链接） 2.硬链接。</p><p>**符号链接（软链接）**就是一个实实在在的文件，它指向存放在虚拟目录结构中某个地方的另一个文件。</p><p>使用<code>ln -s xxx xxx</code>为一个文件创建符号链接，原始文件必须事先存在。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/zHvost.png" alt="zHvost"></p><p><code>111.txt</code>和<code>11.txt</code>是两个不同的文件，他们的大小不一样，另一种证明链接文件是独立文件的方法是查看inode编号。inode编号是一个用于标识文件或目录是唯一的数字，使用<code>ls -i</code>查看。</p><p><strong>硬链接</strong>会创建独立的虚拟文件，其中包含了原始文件的信息及位置。但是它们从根本上而言是同一个文件。引用硬链接文件等同于引用了源文件。<code>ln xxx xxx</code>创建硬链接文件。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/6qpl6U.png" alt="6qpl6U"></p><h5 id="_3-6-5-重命名文件" tabindex="-1"><a class="header-anchor" href="#_3-6-5-重命名文件" aria-hidden="true">#</a> 3.6.5 重命名文件</h5><p>重命名文件称为移动（moving）。<code>mv</code>命令可以将文件和目录结构移动到另一个位置或者重命名。<code>mv xxx xxxx</code>。</p><p>移动文件的inode编号和时间戳不会改变。</p><h5 id="_3-6-5-删除文件" tabindex="-1"><a class="header-anchor" href="#_3-6-5-删除文件" aria-hidden="true">#</a> 3.6.5 删除文件</h5><p><code>rm -i xxx</code>提示并删除文件。</p><p>bash shell中没有回收站，文件一旦删除，就无法再找回。</p><p>可以通过通配符删除成组的文件。<code>rm -i f?ll</code>。</p><p>谨慎使用<code>-f</code>选项进行强制删除。</p><h4 id="_3-7-处理目录" tabindex="-1"><a class="header-anchor" href="#_3-7-处理目录" aria-hidden="true">#</a> 3.7 处理目录</h4><h5 id="_3-7-1-创建目录" tabindex="-1"><a class="header-anchor" href="#_3-7-1-创建目录" aria-hidden="true">#</a> 3.7.1 创建目录</h5><p><code>mkdir xxx</code>创建目录。</p><p><code>mkdir -p xx/xxx/xxxx</code>创建多个目录和子目录。</p><h5 id="_3-7-2-删除目录" tabindex="-1"><a class="header-anchor" href="#_3-7-2-删除目录" aria-hidden="true">#</a> 3.7.2 删除目录</h5><p><code>rmdir xxx</code>默认只能删除空目录。</p><p><code>rm -rf xxx</code>删除目录及其所有内容，<code>-r</code>代表递归，<code>-f</code>代表强制删除。</p><h4 id="_3-8-查看文件内容" tabindex="-1"><a class="header-anchor" href="#_3-8-查看文件内容" aria-hidden="true">#</a> 3.8 查看文件内容</h4><h5 id="_3-8-1-查看文件类型" tabindex="-1"><a class="header-anchor" href="#_3-8-1-查看文件类型" aria-hidden="true">#</a> 3.8.1 查看文件类型</h5><p><code>file xxx</code> 可以查看文件的类型。</p><p>在 Linux 和 Unix 系统中，有多种不同的文件类型，常见的有：</p><ul><li><strong>常规文件</strong>（REG）：普通的文本或二进制文件，如 .txt、.pdf、.jpg 等。</li><li><strong>目录</strong>（DIR）：文件夹，用于存储文件和其他目录。</li><li><strong>字符设备</strong>（CHR）：字符设备文件，如终端设备、串口、普通文件等。</li><li><strong>块设备</strong>（BLK）：块设备文件，如磁盘、硬盘、光驱等。</li><li><strong>命名管道</strong>（FIFO）：FIFO 文件，用于在不同进程间进行通信。</li><li><strong>符号链接</strong>（LNK）：符号链接，用于指向其他文件或目录。</li><li><strong>套接字</strong>（SOCK）：套接字文件，用于在不同主机之间进行网络通信。</li><li><strong>共享内存</strong>（SHM）：共享内存文件，用于在不同进程间共享数据。</li></ul><p>还有其他文件类型如:</p><ul><li><strong>路径名</strong>（DOOR）：用于在不同进程间通信</li><li><strong>事件通知</strong>（EVENT）：用于进程间的事件通知</li><li><strong>半双工管道</strong>（PIPE）：用于半双工通信</li></ul><p>这些文件类型只是部分, 具体取决于操作系统的版本和实现。</p><h5 id="_3-8-2-查看整个文件" tabindex="-1"><a class="header-anchor" href="#_3-8-2-查看整个文件" aria-hidden="true">#</a> 3.8.2 查看整个文件</h5><h6 id="_1-cat命令" tabindex="-1"><a class="header-anchor" href="#_1-cat命令" aria-hidden="true">#</a> <strong>1. <code>cat</code>命令</strong></h6><p><code>cat xxx</code>。</p><p><code>-n</code>选项给所有的行加上序号。</p><p><code>-b</code>选项给有文本的行加上行号。</p><p><code>-T</code>选项不让制表符出现。</p><h6 id="_2-more命令" tabindex="-1"><a class="header-anchor" href="#_2-more命令" aria-hidden="true">#</a> <strong>2. <code>more</code>命令</strong></h6><p><code>cat</code>命令的缺陷是一旦运行，就无法控制后面的操作。<code>more</code>命令用于解决这个问题。</p><p><code>more xxx</code>，<code>more</code>命令会在显示每页数据之后停下来。</p><h6 id="_3-less命令" tabindex="-1"><a class="header-anchor" href="#_3-less命令" aria-hidden="true">#</a> <strong>3. <code>less</code>命令</strong></h6><p><code>less</code>命令是<code>more</code>的升级版。能够在文本文件前后翻动，还有一些高级搜索功能。</p><h5 id="_3-8-3-查看部分文件" tabindex="-1"><a class="header-anchor" href="#_3-8-3-查看部分文件" aria-hidden="true">#</a> 3.8.3 查看部分文件</h5><p>使用<code>cat</code>或<code>more</code>加载大型文件需要加载完整个才能看到，这不利于查看大型文件。</p><h6 id="_1-tail命令" tabindex="-1"><a class="header-anchor" href="#_1-tail命令" aria-hidden="true">#</a> 1.<code>tail</code>命令</h6><p><code>tail</code>命令会显示文件最后几行的内容。</p><p><code>-n</code>选项修改所显示的行数，例如<code>tail -n 20 xxx</code>显示20行。</p><h6 id="_2-head命令" tabindex="-1"><a class="header-anchor" href="#_2-head命令" aria-hidden="true">#</a> 2.<code>head</code>命令</h6><p><code>head</code>命令显示文件开头的那些行的内容。</p><p><code>-n</code>选项修改所显示的行数。</p><h3 id="第4章-更多的bash-shell命令" tabindex="-1"><a class="header-anchor" href="#第4章-更多的bash-shell命令" aria-hidden="true">#</a> 第4章 更多的bash shell命令</h3><h4 id="_4-1-监测程序" tabindex="-1"><a class="header-anchor" href="#_4-1-监测程序" aria-hidden="true">#</a> 4.1 监测程序</h4><h5 id="_4-1-1-探查进程" tabindex="-1"><a class="header-anchor" href="#_4-1-1-探查进程" aria-hidden="true">#</a> 4.1.1 探查进程</h5><p>程序运行在系统上时，称之为<strong>进程</strong>（process）。</p><p><code>ps</code>命令查看进程信息，默认只显示运行在当前控制台下的属于当前用户的进程。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/vKwTbN.png" alt="vKwTbN"></p><p><code>ps</code>命令支持3种不同类型的命令行参数：</p><ul><li>Unix风格的参数，前面加单破折号；</li><li>BSD风格的参数，前面不加破折号；</li><li>GNU风格的参数，前面加双破折号。</li></ul><p><code>ps</code>命令的参数非常多，记住全部是不太现实的，一般是记住最有用的参数即可。</p><p><code>-ef</code>参数查看系统上运行的所有进程，<code>-e</code>显示所有进程，<code>-f</code>扩展了输出内容。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/p6B98I.png" alt="p6B98I"></p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/c3xwdQ.png" alt="c3xwdQ"></p><ul><li>UID：启动这些进程的用户。</li><li>PID：进程ID。</li><li>PPID：父进程的进程号（如果该进程是由另一个进程启动的）。</li><li>C：进程生命周期中的CPU利用率。</li><li>STIME：进程启动时的系统时间。</li><li>TTY：进程启动时的终端设备。</li><li>TIME：运行进程需要的累计CPU时间。</li><li>CMD：启动的进程名称。</li></ul><h5 id="_4-1-2-实时监测进程" tabindex="-1"><a class="header-anchor" href="#_4-1-2-实时监测进程" aria-hidden="true">#</a> 4.1.2 实时监测进程</h5><p><code>ps</code>命令只能显示某个特定事件点的信息。</p><p><code>top</code>命令实时显示进程信息。</p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/v9MijK.png" alt="v9MijK" style="zoom:33%;"><p>输出的第一部分显示的是系统的概况：第一行显示了当前时间、系统运行时间、登录的用户数以及系统的平均负载（load average）。</p><p>平均负载有3个值，最近1分钟的、最近5分钟的和最近15分钟的。值越大说明系统的负载越高。</p><blockquote><p>通常系统的负载值超过2，说明系统比较繁忙了。</p></blockquote><p>第二行显示进程的概要信息——<code>top</code>命令的输出中将进程叫做任务（task）：运行、休眠、停止或者僵化状态。</p><p>第三行是CPU的概要信息。其后两行是系统内存的状态，第一行是物理内存，第二行是系统交换内存。</p><ul><li>PID：进程的ID。</li><li>USER：进程属主的名字。</li><li>PR：进程的优先级。</li><li>NI：进程的谦让度值。</li><li>VIRT：进程占用的虚拟内存总量。</li><li>RES：进程占用的物理内存总量。</li><li>SHR：进程和其他进程共享的内存总量。</li><li>S：进程的状态。</li><li>%CPU：进程使用的CPU时间比例。</li><li>%MEN：进程使用的内存占可用内存的比例。</li><li>TIME+：自进程启动到目前位置的CPU时间总量。</li><li>COMMAND：进程所对应的命令行名称</li></ul><p>在<code>top</code>命令运行时，键入<code>d</code>修改轮询间隔，键入<code>f</code>对输出进行排序的字段，键入<code>q</code>退出top。</p><h5 id="_4-1-3-结束进程" tabindex="-1"><a class="header-anchor" href="#_4-1-3-结束进程" aria-hidden="true">#</a> 4.1.3 结束进程</h5><p>在Linux中，进程之间通过信号来通信。</p><table><thead><tr><th>信号</th><th>名称</th><th>描述</th></tr></thead><tbody><tr><td>1</td><td>HUP</td><td>挂起</td></tr><tr><td>2</td><td>INT</td><td>中断</td></tr><tr><td>3</td><td>QUIT</td><td>结束运行</td></tr><tr><td>9</td><td>KILL</td><td>无条件终止</td></tr><tr><td>11</td><td>SEGV</td><td>段错误</td></tr><tr><td>15</td><td>TERM</td><td>尽可能终止</td></tr><tr><td>17</td><td>STOP</td><td>无条件停止运行，但不终止</td></tr><tr><td>18</td><td>TSTP</td><td>停止或暂停，但继续在后台运行</td></tr><tr><td>19</td><td>CONT</td><td>在STOP或TSTP之后恢复执行</td></tr></tbody></table><p>有两个命令可以向运行中的进程发出进程信号。</p><h6 id="_1-kill命令" tabindex="-1"><a class="header-anchor" href="#_1-kill命令" aria-hidden="true">#</a> 1.<code>kill</code>命令</h6><p><code>kill PID</code>关闭进程。</p><p>要发送进程信号，必须是进程的属主或登录为root用户。</p><p><code>-s</code>参数支持指定其他信号。</p><h6 id="_2-killall命令" tabindex="-1"><a class="header-anchor" href="#_2-killall命令" aria-hidden="true">#</a> 2.<code>killall</code>命令</h6><p><code>killall</code>支持通过进程名而不是PID来结束进程，也支持通配符，这在系统因负载过大而变得很慢时很有用。</p><p><code>killall http*</code>结束所有以http开头的进程。</p><h4 id="_4-2-监测磁盘空间" tabindex="-1"><a class="header-anchor" href="#_4-2-监测磁盘空间" aria-hidden="true">#</a> 4.2 监测磁盘空间</h4><h5 id="_4-2-1-挂载存储媒体" tabindex="-1"><a class="header-anchor" href="#_4-2-1-挂载存储媒体" aria-hidden="true">#</a> 4.2.1 挂载存储媒体</h5><p>在使用新的存储媒体之前，需要把它放到虚拟目录下，这个过程称为<strong>挂载</strong>（mounting）。在图形化桌面环境里，大多数Linux发行版都支持自动挂载特定类型的可移动存储媒体。</p><h6 id="_1-mount命令" tabindex="-1"><a class="header-anchor" href="#_1-mount命令" aria-hidden="true">#</a> 1.<code>mount</code>命令</h6><p><code>mount</code>命令输出当前系统上挂载的设备列表。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/019o33.png" alt="019o33"></p><p>提供了四部分信息：</p><ul><li>媒体的设备文件名</li><li>媒体挂载到虚拟目录的挂载点</li><li>文件系统类型</li><li>已挂载媒体的访问状态</li></ul><p><code>mount -t vfat /dev/sbd1 /media/disk</code>将U盘/dev/sbd1挂载到/media/disk。</p><h6 id="_2-umount命令" tabindex="-1"><a class="header-anchor" href="#_2-umount命令" aria-hidden="true">#</a> 2.<code>umount</code>命令</h6><p><code>umount [directory | device]</code>卸载设备。</p><h5 id="_4-2-2-使用df命令" tabindex="-1"><a class="header-anchor" href="#_4-2-2-使用df命令" aria-hidden="true">#</a> 4.2.2 使用<code>df</code>命令</h5><p><code>df</code>查看所有已挂载磁盘的使用情况，显示每个有数据的已挂载文件系统。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/vXEAEw.png" alt="vXEAEw"></p><ul><li>设备的设备文件位置；</li><li>能容纳多少个1024字节大小的块；</li><li>已用了多少个1024字节大小的块；</li><li>还有多少个1024字节大小的块可用；</li><li>已用空间所占的比例；</li><li>设备挂载到了哪个挂载点。</li></ul><p><code>-h</code>输出按照用户易读的方式显示。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/hKrq4m.png" alt="hKrq4m"></p><h5 id="_4-2-3-使用du命令" tabindex="-1"><a class="header-anchor" href="#_4-2-3-使用du命令" aria-hidden="true">#</a> 4.2.3 使用<code>du</code>命令</h5><p><code>du</code>显示某个特定目录（默认是当前目录）的磁盘使用情况，可用来快速判断系统上某个目录下是否有大文件。<code>du</code>不加参数用处不大。</p><ul><li><code>-c</code>显示所有已列出文件总的大小。</li><li><code>-h</code>易读的方式输出。</li><li><code>-s</code>显示每个输出参数的总计。</li></ul><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/mDLFvV.png" alt="mDLFvV"></p><h4 id="_4-3-处理数据文件" tabindex="-1"><a class="header-anchor" href="#_4-3-处理数据文件" aria-hidden="true">#</a> 4.3 处理数据文件</h4><h5 id="_4-3-1-排序数据" tabindex="-1"><a class="header-anchor" href="#_4-3-1-排序数据" aria-hidden="true">#</a> 4.3.1 排序数据</h5><p><code>sort</code>命令对数据进行排序，默认按照会话指定的默认语言的排序规则对文本文件中的数据进行排序。</p><blockquote><p><code>-n</code>告诉sort命令把数字识别成数字而不是字符。</p><p><code>-M</code>按月排序。</p><p><code>-r</code>降序排序。</p></blockquote><h5 id="_4-3-2-搜索数据" tabindex="-1"><a class="header-anchor" href="#_4-3-2-搜索数据" aria-hidden="true">#</a> 4.3.2 搜索数据</h5><p><code>grep</code>命令查找数据，<code>grep [options] pattern [file]</code>。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/eraJpt.png" alt="eraJpt"></p><blockquote><p><code>-n</code>加入行显示。</p><p><code>-v</code>反向搜索。</p><p><code>-c</code>有多少行匹配。</p><p><code>-e</code>多个匹配模式，<code>grep -e aaa -e bbb xxx</code>。</p></blockquote><h5 id="_4-3-3-压缩数据" tabindex="-1"><a class="header-anchor" href="#_4-3-3-压缩数据" aria-hidden="true">#</a> 4.3.3 压缩数据</h5><p>Linux文件压缩工具</p><table><thead><tr><th>工具</th><th>文件扩展名</th><th>描述</th></tr></thead><tbody><tr><td>bzip2</td><td>.bz2</td><td>采用Burrows-Wheeler块排序文本压缩算法和霍夫曼编码</td></tr><tr><td>compress</td><td>.Z</td><td>最初的Unix文件压缩工具，已经快没人用了</td></tr><tr><td>gzip（最流行）</td><td>.gz</td><td>GNU压缩工具，用Lempel-Ziv编码</td></tr><tr><td>zip</td><td>.zip</td><td>Windows 上PKZIP工具的Unix实现</td></tr></tbody></table><ul><li><code>gzip xxx</code>用来压缩文件。</li><li><code>zcat</code>查看压缩过的文本文件的内容。</li><li><code>gunzip</code>解压文件。</li></ul><h5 id="_4-3-4-归档数据" tabindex="-1"><a class="header-anchor" href="#_4-3-4-归档数据" aria-hidden="true">#</a> 4.3.4 归档数据</h5><p>zip命令只能压缩和归档单个文件。</p><p>使用<code>tar</code>命令进行文件归档。<code>tar function [options] object1 object2 ...</code>。</p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/IMG_5765.jpg" alt="IMG_5765" style="zoom:33%;"><p>例：<code>tar -cvf test.tar test/ test2/ 11.txt</code>创建test.tar的归档文件，<code>tar -xvf test.tar</code>提取内容。</p><blockquote><p>以<code>.tgz</code>结尾的文件，是通过gzip压缩过的tar文件，可以用<code>tar -zxvf filename.tgz</code>来解压。</p></blockquote><h3 id="第5章-理解shell" tabindex="-1"><a class="header-anchor" href="#第5章-理解shell" aria-hidden="true">#</a> 第5章 理解shell</h3><p>shell是一个时刻都在运行的复杂交互式程序。</p><h4 id="_5-1-shell的类型" tabindex="-1"><a class="header-anchor" href="#_5-1-shell的类型" aria-hidden="true">#</a> 5.1 shell的类型</h4><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/zRbHB5.png" alt="zRbHB5"></p><p>只要用户登录到某个虚拟控制台终端或是在GUI中启动终端仿真器，默认的shell程序就会开始运行。</p><p>有两种shell，一个是默认shell，一个是交互shell，默认shell是**/bin/sh**，用于那些需要在启动时使用的系统shell脚本。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/IJ5Y3X.png" alt="IJ5Y3X"></p><p><code>/bin/dash</code>命令启动dash shell。<code>exit</code>命令退出dash shell。</p><h4 id="_5-2-shell的父子关系" tabindex="-1"><a class="header-anchor" href="#_5-2-shell的父子关系" aria-hidden="true">#</a> 5.2 shell的父子关系</h4><p>默认启动的交互shell是一个父shell，通过启动其他shell命令的新的shell程序，是一个子shell。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/mkzzbc.png" alt="mkzzbc"></p><p><code>exit</code>命令退出子shell。</p><h5 id="_5-2-1-进程列表" tabindex="-1"><a class="header-anchor" href="#_5-2-1-进程列表" aria-hidden="true">#</a> 5.2.1 进程列表</h5><p>将命令包含在括号里，命令列表变成了进程列表，生成了一个子shell来执行对应的命令。</p><p><code>(pwd ; ls ; cd /etc ; pwd; cd ; pwd ; ls)</code>。<code>echo $BASH_SUBSHELL</code>可以显示子shell的数量。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/M3niaj.png" alt="M3niaj"></p><h5 id="_5-2-2-子shell用法" tabindex="-1"><a class="header-anchor" href="#_5-2-2-子shell用法" aria-hidden="true">#</a> 5.2.2 子shell用法</h5><p>在交互式shell中，一个高效的子shell用法就是使用后台模式。</p><h6 id="_1-探索后台模式" tabindex="-1"><a class="header-anchor" href="#_1-探索后台模式" aria-hidden="true">#</a> 1.探索后台模式</h6><p><code>sleep sceonds</code>命令将进程等待（睡眠）多少秒。</p><p><code>&amp;</code>符号可以将命令置于后台运行。</p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2023_04_07_image-20220224073401412.png" alt="image-20220224073401412" style="zoom:33%;"><p><code>jobs</code>命令显示后台作业信息。</p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/LZo9ZS.png" alt="LZo9ZS" style="zoom:50%;"><h6 id="_2-将进程列表置入后台" tabindex="-1"><a class="header-anchor" href="#_2-将进程列表置入后台" aria-hidden="true">#</a> 2.将进程列表置入后台</h6><p><code>(sleep 2 ; echo $BASH_SUBSHELL ; sleep 2)&amp;</code>置于后台运行。</p><p>在CLI中运用子shell的创造性方法之一就是将进程列表置入后台模式。你既可以在子shell进行繁重的处理工作，同时也不会让子shell的I/O受制于终端。</p><h6 id="_3-协程" tabindex="-1"><a class="header-anchor" href="#_3-协程" aria-hidden="true">#</a> 3.协程</h6><p><code>coproc</code>命令创建协程，协程可以同时做两件事，在后台生成一个子shell，并在这个子shell中执行命令。</p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/L1rqRL.png" alt="L1rqRL" style="zoom:50%;"><p><code>coproc my_job { sleep 10; } </code>修改协程的名字，这对使用多个协程时非常有用。</p><p>生成子shell的成本不低，速度还慢，要用好子shell，必须理解子shell的行为方式。</p><h4 id="_5-3-理解shell的内建命令" tabindex="-1"><a class="header-anchor" href="#_5-3-理解shell的内建命令" aria-hidden="true">#</a> 5.3 理解shell的内建命令</h4><h5 id="_5-3-1-外部命令" tabindex="-1"><a class="header-anchor" href="#_5-3-1-外部命令" aria-hidden="true">#</a> 5.3.1 外部命令</h5><p>外部命令，也被称为<strong>文件系统命令</strong>，存在于bash shell之外的程序，它们并不是shell程序的一部分。外部命令程序通常位于/bin、/usr/bin、/sbin和/usr/sbin中。</p><p><code>ps</code>就是一个外部命令，可以使用<code>which</code>命令和<code>type</code>命令找到它。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_24_HGWqgH.png" alt="2022_02_24_HGWqgH"></p><p>当外部命令执行时，会创建一个子进程，这种操作被称为衍生（forking）。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_24_ESLkq0.png" alt="2022_02_24_ESLkq0"></p><p>当进程必须执行衍生操作时，它需要花费时间和精力来设置新子进程的环境，因此外部命多少是有代价的。</p><h5 id="_5-3-2-内建命令" tabindex="-1"><a class="header-anchor" href="#_5-3-2-内建命令" aria-hidden="true">#</a> 5.3.2 内建命令</h5><p>内建命令不需要使用子进程来执行，它们和shell编译成一体。</p><p><code>cd</code>和<code>exit</code>命令都内建于bash shell。</p><p><code>type</code>命令了解某个命令是否是内建的。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_24_WtIamz.png" alt="2022_02_24_WtIamz"></p><p>有些命令有多种实现，例如<code>echo</code>和<code>pwd</code>既有内建又有外部命令。<code>type -a xx</code>查看命令的不同实现。</p><p><code>which</code>命令只显示外部命令文件。</p><h6 id="_1-history命令" tabindex="-1"><a class="header-anchor" href="#_1-history命令" aria-hidden="true">#</a> 1. <code>history</code>命令</h6><p>这个命令会跟踪你用过的命令，查看最近用过的命令列表。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_24_msJ0Sv.png" alt="2022_02_24_msJ0Sv"></p><p><code>!!</code>命令可以唤出刚刚用过的那条命令来使用。</p><p>命令历史记录被保存在隐藏文件<code>.bash_history</code>中，位于用户的主目录中。</p><h6 id="_2-命名别名" tabindex="-1"><a class="header-anchor" href="#_2-命名别名" aria-hidden="true">#</a> 2.命名别名</h6><p><code>alias</code>命令可以为常用的命令（及其参数）创建另一个名称，从而将输入量减少到最低。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_25_ELxfKv.png" alt="2022_02_25_ELxfKv"></p><p>使用<code>alias xx=&#39;xxx&#39;</code>创建别名。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_25_BzD2ss.png" alt="2022_02_25_BzD2ss"></p><p>因为命令别名属于内部命令，一个别名仅在它所被定义的shell进程中才有效。</p><h3 id="第6章-使用linux环境变量" tabindex="-1"><a class="header-anchor" href="#第6章-使用linux环境变量" aria-hidden="true">#</a> 第6章 使用Linux环境变量</h3><h4 id="_6-1-什么是环境变量" tabindex="-1"><a class="header-anchor" href="#_6-1-什么是环境变量" aria-hidden="true">#</a> 6.1 什么是环境变量</h4><p>bash shell用一个叫做环境变量（environment variable）的特性来存储相关shell会话和工作环境的信息，这项特性允许你在内存中存储数据，以便程序或shell中运行的脚本能够轻松访问到它们。</p><p>环境变量分为<strong>全局变量</strong>和<strong>局部变量</strong>。</p><h5 id="全局环境变量" tabindex="-1"><a class="header-anchor" href="#全局环境变量" aria-hidden="true">#</a> 全局环境变量</h5><p>全局环境变量对于shell会话和所有生成的子shell都是可见的。局部变量则只对创建它们的shell可见。系统环境变量基本上使用大写字母，区别于普通用户的环境变量。</p><p><code>env</code>和<code>printenv</code>命令查看全局变量。</p><p><code>printenv 环境变量名</code>显示环境变量的值。也可以使用<code>echo $变量名</code>显示。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_25_riC4uk.png" alt="2022_02_25_riC4uk"></p><h5 id="局部变量" tabindex="-1"><a class="header-anchor" href="#局部变量" aria-hidden="true">#</a> 局部变量</h5><p>局部变量只能在定义它们的进程中可见。</p><p><code>set</code>命令显示全局变量、局部变量和用户定义变量。</p><h4 id="_6-2-设置用户定义变量" tabindex="-1"><a class="header-anchor" href="#_6-2-设置用户定义变量" aria-hidden="true">#</a> 6.2 设置用户定义变量</h4><h5 id="设置局部用户定义变量" tabindex="-1"><a class="header-anchor" href="#设置局部用户定义变量" aria-hidden="true">#</a> 设置局部用户定义变量</h5><p>通过等号=给环境变量赋值，值可以是数值或字符串。如果值包含空格，必须用双引号包裹住。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_25_52GhYZ.png" alt="2022_02_25_52GhYZ"></p><blockquote><p>全局环境变量名用大写字母，自己创建的变量或是shell脚本，使用小写字母。变量名区分大小写。</p></blockquote><h5 id="设置全局变量" tabindex="-1"><a class="header-anchor" href="#设置全局变量" aria-hidden="true">#</a> 设置全局变量</h5><p>先创建一个局部环境变量，然后再将它导出到全局环境中。</p><p><code>export</code>命令导出变量，将变量变成全局环境变量。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_25_ohyVMq.png" alt="2022_02_25_ohyVMq"></p><p>在子shell中修改全局环境变量不会影响到父shell中该变量的值。子shell无法使用<code>export</code>命令改变父shell中全局环境变量的值。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_25_BKNyA1.png" alt="2022_02_25_BKNyA1"></p><h4 id="_6-3-删除环境变量" tabindex="-1"><a class="header-anchor" href="#_6-3-删除环境变量" aria-hidden="true">#</a> 6.3 删除环境变量</h4><p><code>unset xxx</code>删除环境变量</p><blockquote><p>如果要用到变量，使用$；如果要操作变量，不使用$；</p></blockquote><p>当在子进程删除一个全局环境变量时，这只对子进程有效。该全局环境变量在父进程中依然可用。</p><h4 id="_6-4-默认的shell环境变量" tabindex="-1"><a class="header-anchor" href="#_6-4-默认的shell环境变量" aria-hidden="true">#</a> 6.4 默认的shell环境变量</h4><p>bash shell支持的Bourne变量</p><table><thead><tr><th>变量</th><th>描述</th></tr></thead><tbody><tr><td>CDPATH</td><td>冒号分隔的目录列表，作为cd命令的搜索路径</td></tr><tr><td>HOME</td><td>当前用户的主目录</td></tr><tr><td>IFS</td><td>shell用来分隔文本字符串的一列字符</td></tr><tr><td>MAIL</td><td>当前用户收件箱的文件名；bash shell会检查这个文件以查看是否有新邮件</td></tr><tr><td>MAILPATH</td><td>冒号分隔的当前用户收件箱的文件名列表；bash会检查列表中的每个文件以查看是否有新邮件</td></tr><tr><td>OPTARG</td><td>getopts命令处理的最后一个选项参数值</td></tr><tr><td>OPTIND</td><td>getopts命令处理的最后一个选项参数的索引号</td></tr><tr><td>PATH</td><td>冒号分隔符的shell查找命令的目录列表</td></tr><tr><td>PS1</td><td>shell命令行界面的主提示符</td></tr><tr><td>PS2</td><td>shell命令行界面的次提示符</td></tr></tbody></table><h4 id="_6-5-设置path环境变量" tabindex="-1"><a class="header-anchor" href="#_6-5-设置path环境变量" aria-hidden="true">#</a> 6.5 设置PATH环境变量</h4><p>PATH环境变量定义了用于进行命令和程序查找的目录。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_27_lZnV4R.png" alt="2022_02_27_lZnV4R"></p><p>如果命令或者程序的位置没有包括在PATH变量中，那么如果不适用绝对路径的话，shell是没法找到的，解决办法是保证PATH环境变量包含了所有存放应用程序的目录。可以把新的搜索目录添加到现有的PATH环境变量中，无需从头定义。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_27_2SiM1x.png" alt="2022_02_27_2SiM1x"></p><p>对<strong>PATH</strong>变量的修改只能持续到退出或者重启系统。</p><h4 id="_6-6-定位系统环境变量" tabindex="-1"><a class="header-anchor" href="#_6-6-定位系统环境变量" aria-hidden="true">#</a> 6.6 定位系统环境变量</h4><p>在登入Linux系统启动一个bash shell时，默认情况下bash会在几个文件中查找命令。这些文件叫做<strong>启动文件</strong>或<strong>环境文件</strong>。bash检查的启动文件取决于你启动bash shell的方式。启动bash shell有3种方式：</p><ul><li>登录时作为默认登录shell</li><li>作为非登录的交互式shell</li><li>作为运行脚本的非交互shell</li></ul><h5 id="登录shell" tabindex="-1"><a class="header-anchor" href="#登录shell" aria-hidden="true">#</a> 登录shell</h5><p>当登录Linux时，bash shell会作为登录shell启动。登录shell会在5个不同的启动文件里读取命令：</p><ul><li><code>/etc/profile</code></li><li><code>$HOME/.bash_profile</code></li><li><code>$HOME/.bashrc</code></li><li><code>$HOME/.bash_login</code></li><li><code>$HOME/.profile</code></li></ul><p><strong>1./etc/profile文件</strong></p><p><code>/etc/profile</code>文件是系统上默认的bash shell的主启动文件，系统上的每个用户登录时都会执行这个启动文件。</p><p>不同的Linux发行版在这个文件放了不同的命令，每个发行版的<code>/etc/profile</code>文件都有不同的设置和命令。</p><p><strong>2.$HOME目录下的启动文件</strong></p><p>剩下的启动文件都起着同一作用：提供一个用户专属的启动文件来定义该用户所用到的环境变量。大多数Linux发行版只用到一两个。</p><h5 id="交互式shell进程" tabindex="-1"><a class="header-anchor" href="#交互式shell进程" aria-hidden="true">#</a> 交互式shell进程</h5><p>如果bash shell不是登录系统时启动的（比如是在命令行提示符下敲下bash时启动），那么启动的shell叫做交互式shell。交互式shell不会访问<code>/etc/profile</code>文件，只会检查用户HOME目录中的<code>.bashrc</code>文件。</p><p><code>.bashrc</code>文件有两个作用：一是查看<code>/etc</code>目录下通用的bashrc文件，二是为用户提供一个定制自己的命令别名和私有脚本函数的地方。</p><h5 id="非交互式shell" tabindex="-1"><a class="header-anchor" href="#非交互式shell" aria-hidden="true">#</a> 非交互式shell</h5><p>系统执行shell脚本时用的就是这种shell。</p><p>bash shell提供了<code>BASH_ENV</code>环境变量，当shell启动一个非交互式shell程序时，它会检查这个环境变量来查看要执行的启动文件。如果有指定的文件，shell会执行该文件里的命令，这通常包括shell脚本变量设置。</p><h5 id="环境变量持久化" tabindex="-1"><a class="header-anchor" href="#环境变量持久化" aria-hidden="true">#</a> 环境变量持久化</h5><p>对全局环境变量来说（Linux系统中所有用户都需要使用的变量），可能更倾向于将新的或修改过的变量设置放在<code>/etc/profile</code>文件中，不过如果升级了所用的发行版，这个文件也会跟着更新，那么所定制过的变量设置就会不见了。最好是在<code>/etc/profile.d</code>目录中创建一个以<code>.sh</code>结尾的文件，把所有新的或修改过的全局环境变量设置放入这个文件中。</p><p>个人用户永久性bash shell变量是放在<code>$HOEM/.bashrc</code>文件。</p><h4 id="_6-7-数组变量" tabindex="-1"><a class="header-anchor" href="#_6-7-数组变量" aria-hidden="true">#</a> 6.7 数组变量</h4><p>环境变量可作为数组使用，数组能够存储多个值的变量，这些值可以单独引用，也可以作为整个数组来引用。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_28_ykrNls.png" alt="2022_02_28_ykrNls"></p><p><code>echo ${my_name[*]}</code>显示整个数组变量；</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_28_9j6umM.png" alt="2022_02_28_9j6umM"></p><h3 id="第7章-理解linux文件权限" tabindex="-1"><a class="header-anchor" href="#第7章-理解linux文件权限" aria-hidden="true">#</a> 第7章 理解Linux文件权限</h3><p>Linux沿用了Unix文件权限的办法，允许用户和组根据每个文件和目录的安全性设置来访问文件。</p><h4 id="_7-1-linux的安全性" tabindex="-1"><a class="header-anchor" href="#_7-1-linux的安全性" aria-hidden="true">#</a> 7.1 Linux的安全性</h4><p>Linux安全系统的核心是用户账户。用户对系统中各种对象的访问权限取决于他们登录系统时用的账户。</p><p>用户权限是通过创建用户时分配的用户ID（User ID，缩写为UID）来跟踪的。UID的数值，每个用户都有唯一的UID，但在登录系统时用的不是UID，而是登录名。登录名是用户用来登录系统的最长八字符的字符串，同时会关联一个对应的密码。</p><h5 id="etc-passwd文件" tabindex="-1"><a class="header-anchor" href="#etc-passwd文件" aria-hidden="true">#</a> /etc/passwd文件</h5><p><code>/etc/passwd</code>文件将用户的登录名匹配到对应的UID值，它包含了一些与用户有关的信息。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_28_nwfxrZ.png" alt="2022_02_28_nwfxrZ"></p><p>root用户账户是Linux系统的管理员，固定分配给它的UID是0。</p><p>Linux系统会为各种各样的功能创建不同的用户账户，而这些账户并不是真的用户。这些账户叫做<strong>系统账户</strong>，是系统上运行的各种服务进程访问资源用的特殊账户。所有运行在后台的服务都需要用一个系统用户账户登录到Linux系统上。</p><p>在安全成为一个大问题之前，这些服务经常会用root账户登录。但如果有非授权的用户攻陷了这些服务中的一个，他立刻就能作为root用户进入系统。为了防止这种情况发生，现在运行在Linux服务器后台的几乎所有的服务都是用自己的账户登录。</p><p>Linux为系统账户预留了500以下的UID值。为普通用户创建账户时，大多数Linux系统会从500开始。</p><p><code>/etc/passwd</code>文件的字段包含了如下信息：</p><ul><li>用户登录名</li><li>用户密码</li><li>用户账户的UID（数字形式）</li><li>用户账户的组ID（GID）（数字形式）</li><li>用户账户的文本描述（称为备注字段）</li><li>用户HOME目录的位置</li><li>用户的默认shell</li></ul><p><code>etc/passwd</code>文件中的密码字段都被设置成了x，在早期的Linux上，<code>etc/passwd</code>文件里有加密后的用户密码，但鉴于很多程序都需要访问<code>etc/passwd</code>文件获取用户信息，这就成了一个安全隐患。现在，绝大多数Linux系统都将用户密码保存在另一个单独的文件中(<code>/etc/shadow</code>)，只有特定的程序（比如登录程序）才能访问这个文件。</p><p><code>/etc/passwd</code>是一个标准的文本文件。你可以用任何文本编辑器在<code>etc/passwd</code>文件里直接手动进行用户管理（比如添加、修改或删除用户）。但这样做极其危险。如果<code>etc/passwd</code>文件出现损坏，系统将无法读取它的内容了，这样会导致用户无法正常登录（即便是root用户）。</p><h5 id="etc-shadow文件" tabindex="-1"><a class="header-anchor" href="#etc-shadow文件" aria-hidden="true">#</a> /etc/shadow文件</h5><p>只有root用户才能访问<code>/etc/shadow</code>文件。<code>/etc/shadow</code>文件为系统上的每个用户账户都保存了一条记录。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_28_jTOTt9.png" alt="2022_02_28_jTOTt9"></p><ul><li>与<code>/etc/passwd</code>文件中的登录名字段对应的登录名</li><li>加密后的密码</li><li>自上次修改密码后过去的天数密码（自1970年一月一号开始计算）</li><li>多少天后才能更改密码</li><li>多少天后必须更新密码</li><li>密码过期前提前多少天提醒用户更改密码</li><li>密码过期后多少天禁用用户账户</li><li>用户账户被禁用的日期（自1970年一月一号到当天的天数表示）</li><li>预留字段给将来使用</li></ul><p>shadow可以控制用户多久更改一次密码，以及什么时候禁用该用户账户，如果密码未更新的话。</p><h5 id="添加新用户" tabindex="-1"><a class="header-anchor" href="#添加新用户" aria-hidden="true">#</a> 添加新用户</h5><p><code>useradd</code>命令创建新用户账户及设置用户HOME目录结构。<code>useradd</code>命令使用系统的默认值以及命令行参数来设置用户账户。系统默认值被设置在<code>/etc/default/useradd</code>文件中。</p><p><code>-D</code>选项查看所用Linux系统中的这些默认值。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_28_3N5Bk0.png" alt="2022_02_28_3N5Bk0"></p><p>在创建新用户时，如果不指定具体的值，<code>useradd</code>命令会使用<code>-D</code>选项所显示的那些默认值。</p><ul><li>GID</li><li>HOME目录</li><li>账户密码在过期后不会被禁用</li><li>账户未被设置过期日期</li><li>将sh shell作为默认shell</li><li>将<code>/etc/skel</code>目录下的内容复制到用户的HOME目录下</li><li>不会为该用户账户在mail目录下创建一个用户接受邮件的文件</li></ul><p><code>useradd -m 用户名</code>使用默认配置创建用户。<code>-m</code>选项会是其创建HOME目录，默认不会创建。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_02_28_3KQ6m7.png" alt="2022_02_28_3KQ6m7"></p><table><thead><tr><th>参 数</th><th>描 述</th></tr></thead><tbody><tr><td>-c comment</td><td>给新用户添加备注</td></tr><tr><td>-d home_dir</td><td>为主目录指定一个名字（如果不想用登录名作为主目录名的话）</td></tr><tr><td>-e expire_date</td><td>用YYYY-MM-DD格式指定一个账户过期的日期</td></tr><tr><td>-f inactive_days</td><td>指定这个账户密码过期后多少天这个账户被禁用；0表示密码一过期就立即禁用，1表示禁用这个功能</td></tr><tr><td>-g initial_group</td><td>指定用户登录组的GID或组名</td></tr><tr><td>-G group …</td><td>指定用户除登录组之外所属的一个或多个附加组</td></tr><tr><td>-k</td><td>必须和-m一起使用，将/etc/skel目录的内容复制到用户的HOME目录</td></tr><tr><td>-m</td><td>创建用户的HOME目录</td></tr><tr><td>-M</td><td>不创建用户的HOME目录（当默认设置里要求创建时才使用这个选项）</td></tr><tr><td>-n</td><td>创建一个与用户登录名同名的新组</td></tr><tr><td>-r</td><td>创建系统账户</td></tr><tr><td>-p passwd</td><td>为用户账户指定默认密码</td></tr><tr><td>-s shell</td><td>指定默认的登录shell</td></tr><tr><td>-u uid</td><td>为账户指定唯一的UID</td></tr><tr><td>-b default_home</td><td>更改默认的创建用户HOME目录的位置</td></tr><tr><td>-e expiration_date</td><td>更改默认的新账户的过期日期</td></tr><tr><td>-f inactive</td><td>更改默认的新用户从密码过期到账户被禁用的天数</td></tr><tr><td>-g group</td><td>更改默认的组名称或GID</td></tr><tr><td>-s shell</td><td>更改默认的登录shell</td></tr></tbody></table><p><code>-D</code>选项后面跟上一个指定的值来修改系统默认的新用户设置。</p><h5 id="删除用户" tabindex="-1"><a class="header-anchor" href="#删除用户" aria-hidden="true">#</a> 删除用户</h5><p><code>userdel</code>删除用户，不过它只删除<code>/etc/passwd</code>文件中的用户信息，而不会删除系统中属于该账户的任何文件。</p><p><code>-r</code>选项删除用户的HOME目录以及邮件目录。</p><blockquote><p>在删除用户的HOME目录之前一定要检查清除！</p></blockquote><h5 id="修改用户" tabindex="-1"><a class="header-anchor" href="#修改用户" aria-hidden="true">#</a> 修改用户</h5><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td><code>usermod</code></td><td>修改用户账户的字段，还可以指定主要组以及附加组的所属关系</td></tr><tr><td><code>passwd</code></td><td>修改已有用户的密码</td></tr><tr><td><code>chpasswd</code></td><td>从文件中读取登录名密码对，并更新密码</td></tr><tr><td><code>chage</code></td><td>修改密码的过期日期</td></tr><tr><td><code>chfn</code></td><td>修改用户账户的备注信息</td></tr><tr><td><code>chsh</code></td><td>修改用户账户的默认登录shell</td></tr></tbody></table><p><strong>1.usermod</strong></p><p>能修改<code>/etc/passwd</code>文件中的大部分字段，只需用与想修改的字段对应的命令行参数就可以了。参数大部分跟<code>useradd</code>命令一样，除此之外，还有一些派的上用场的选项：</p><ul><li><code>-l</code>修改用户账户的登录名</li><li><code>-L</code>锁定账户，使用户无法登录</li><li><code>-p</code>修改账户的密码</li><li><code>U</code>解除锁定，使用户能够登录</li></ul><p><strong>2.passwd和chpasswd</strong></p><p><code>passwd</code>命令可以简便修改用户密码。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_03_01_D2CBhW.png" alt="2022_03_01_D2CBhW"></p><p><code>-e</code>选项能强制用户下次登录时修改密码。</p><p><code>chpasswd</code>命令可以为系统系统大量用户修改密码，它能从标准输入自动读取登录名和密码对（由冒号分割）列表，给密码加密，然后为用户账户设置。</p><p>例：<code>chpasswd &lt; users.txt</code>。</p><p><strong>3.chsh、chfn和chage</strong></p><p><code>chsh</code>、<code>chfn</code>和<code>chage</code>工具专门用来修改特定的账户信息。</p><p><code>chsh</code>命令用来快速修改默认的用户登录shell。<code>chsh -s /bin/csh test</code>。</p><p><code>chfn</code>命令 提供了在<code>/etc/passwd</code>文件的备注字段中存储信息的标准方法。</p><p>**<code>finger</code>**命令可以方便的查看Linux系统上的用户信息。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_03_01_XDADHF.png" alt="2022_03_01_XDADHF"></p><h4 id="_7-2-使用linux组" tabindex="-1"><a class="header-anchor" href="#_7-2-使用linux组" aria-hidden="true">#</a> 7.2 使用Linux组</h4><p>组权限允许多个用户对系统中的对象（比如文件、目录或设备等）共享一组共用的权限。</p><h5 id="etc-group文件" tabindex="-1"><a class="header-anchor" href="#etc-group文件" aria-hidden="true">#</a> /etc/group文件</h5><p><code>/etc/group</code>文件包含系统上用到的每个组的信息。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_03_02_ZQa3jf.png" alt="2022_03_02_ZQa3jf"></p><p>系统账户用的组通常会分配低于500的GID值。<code>/etc/group</code>有以下4个字段：</p><ul><li>组名</li><li>组密码</li><li>GID</li><li>属于该组的用户</li></ul><p>组密码允许非组内成员通过它临时成为该组成员。</p><h5 id="创建新组" tabindex="-1"><a class="header-anchor" href="#创建新组" aria-hidden="true">#</a> 创建新组</h5><p><code>groupadd xxx</code>命令可在系统上创建新组。</p><p>可以使用<code>usermod</code>将用户移入某个组。<code>usermod -G 组名 用户名</code>。</p><blockquote><p>为用户账户分配组如果使用<code>-g</code>则会替换掉该账户的默认组，<code>-G</code>则将该组添加到用户的属组的列表里，不会影响默认组。</p></blockquote><h5 id="修改组" tabindex="-1"><a class="header-anchor" href="#修改组" aria-hidden="true">#</a> 修改组</h5><p><code>groupmod</code>命令修改已有组的GID（<code>-g</code>）或组名（<code>-n</code>）。</p><h4 id="_7-3-理解文件权限" tabindex="-1"><a class="header-anchor" href="#_7-3-理解文件权限" aria-hidden="true">#</a> 7.3 理解文件权限</h4><h5 id="使用文件权限符" tabindex="-1"><a class="header-anchor" href="#使用文件权限符" aria-hidden="true">#</a> 使用文件权限符</h5><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_03_02_e1N7T0.png" alt="2022_03_02_e1N7T0"></p><p>输出结果第一个字段是描述文件和目录权限的编码。第一个字符代表对象的类型：</p><ul><li><code>-</code>代表文件</li><li><code>l</code>代表链接</li><li><code>d</code>代表目录</li><li><code>c</code>代表字符型设备</li><li><code>b</code>代表块设备</li><li><code>n</code>代表网络设备</li></ul><p>之后有3组三字符。每一组定义了3种权限：</p><ul><li><code>r</code>代表可读</li><li><code>w</code>代表可写</li><li><code>x</code>代表可执行</li></ul><p>若没有某种权限，在该权限会出现<code>-</code>。这3组权限分别对应对象的3个安全级别：</p><ul><li>对象的属主</li><li>对象的属组</li><li>系统其他用户</li></ul><h5 id="默认文件权限" tabindex="-1"><a class="header-anchor" href="#默认文件权限" aria-hidden="true">#</a> 默认文件权限</h5><p><code>umask</code>命令用来设置创建文件和目录的<strong>默认权限</strong>。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_03_02_MoI41r.png" alt="2022_03_02_MoI41r"></p><p>第一位代表一项特别的安全特性，叫做粘着位（sticky bit）。后面3位表示文件或目录对应的umask八进制值。</p><p>八进制模式的安全性设置先获取这3个rwx权限的值，然后转换成3位二进制，用一个八进制位来表示。</p><table><thead><tr><th>权限</th><th>二进制值</th><th>八进制值</th><th>描述</th></tr></thead><tbody><tr><td>---</td><td>000</td><td>0</td><td>没有任何权限</td></tr><tr><td>--x</td><td>001</td><td>1</td><td>只有执行权限</td></tr><tr><td>-w-</td><td>010</td><td>2</td><td>只有写入权限</td></tr><tr><td>-wx</td><td>011</td><td>3</td><td>写入和执行权限</td></tr><tr><td>r--</td><td>100</td><td>4</td><td>读权限</td></tr><tr><td>r-x</td><td>101</td><td>5</td><td>读和执行权限</td></tr><tr><td>rw-</td><td>110</td><td>6</td><td>读和写入权限</td></tr><tr><td>rwx</td><td>111</td><td>7</td><td>全部权限</td></tr></tbody></table><p>八进制模式先取得权限的八进制值，然后再把这三组安全级别（属主、属组和其他用户）的八进制值顺序列出。</p><p><code>umask</code>值只是一个掩码，它会屏蔽掉不想授予该安全级别的权限，要把<code>umask</code>值从对象的全权值中减掉。对文件来说，全权限的值是666（所有用户都有读和写的权限）；而目录的全权限值是777（读写执行）。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_03_02_i1PT8k.png" alt="2022_03_02_i1PT8k"></p><h4 id="_7-4-改变安全性设置" tabindex="-1"><a class="header-anchor" href="#_7-4-改变安全性设置" aria-hidden="true">#</a> 7.4 改变安全性设置</h4><h5 id="改变权限" tabindex="-1"><a class="header-anchor" href="#改变权限" aria-hidden="true">#</a> 改变权限</h5><p><code>chmod</code>命令用来改变文件和目录的安全性设置。<code>chmod options mode file</code>。</p><p>mode参数使用<strong>八进制模式</strong>或<strong>符号模式</strong>进行安全性设置。</p><p>符号模式<code>[ugoa...][[+-=][rwxXstugo...]]</code>。</p><p>第一组字符定义权限作用的对象：</p><ul><li><code>u</code>代表用户</li><li><code>g</code>代表组</li><li><code>o</code>代表其他</li><li><code>a</code>代表上述所有</li></ul><p>后面跟着的符号表示：</p><ul><li><code>+</code>增加权限</li><li><code>-</code>移除权限</li><li><code>=</code>将权限设置成后面的值</li></ul><p>第三个符号代表作用到设置上的权限：</p><ul><li><code>x</code>如果对象是目录或者它已有执行权限，赋予执行能力</li><li><code>s</code>运行时重新设置UID或GID</li><li><code>t</code>保留文件或目录</li><li><code>u</code>设置属主权限</li><li><code>g</code>设置属组权限</li><li><code>o</code>设置其他用户权限</li></ul><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_03_03_fPXi0e.png" alt="2022_03_03_fPXi0e"></p><p><code>-R</code>选项可以让权限的改变递归地作用到文件和子目录。</p><h5 id="改变所属关系" tabindex="-1"><a class="header-anchor" href="#改变所属关系" aria-hidden="true">#</a> 改变所属关系</h5><p><code>chown</code>命令改变文件的属主；<code>chown options owner[.group] file</code>。</p><p><code>chgrp</code>命令改变文件的默认属组。</p><blockquote><p>只有root用户才能改变文件的属主。任何属主都可以改变文件的属组，但前提是属主必须是原属组和目标属组的成员。</p></blockquote><h4 id="_7-5-共享文件" tabindex="-1"><a class="header-anchor" href="#_7-5-共享文件" aria-hidden="true">#</a> 7.5 共享文件</h4><p>Linux为每个文件和目录存储了3个额外的信息位。</p><ul><li>设置用户ID（SUID）：当文件被用户使用时，程序会以文件属主的权限运行。</li><li>设置组ID（SGID）：对文件来说，程序会以文件属组的权限运行；而目录中创建的新文件会以目录的默认属组作为默认属组。</li><li>粘着位：进程结束后文件还驻留在内存中。</li></ul><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_03_03_IMG_5779.jpg" alt="2022_03_03_IMG_5779"></p><h3 id="第8章-管理文件系统" tabindex="-1"><a class="header-anchor" href="#第8章-管理文件系统" aria-hidden="true">#</a> 第8章 管理文件系统</h3><h4 id="_8-1-探索linux文件系统" tabindex="-1"><a class="header-anchor" href="#_8-1-探索linux文件系统" aria-hidden="true">#</a> 8.1 探索Linux文件系统</h4><p>Linux支持多种类型的文件系统管理文件和目录。每种文件系统都在存储设备上实现了虚拟目录结构，仅特性略有不同。</p><h5 id="基本的linux文件系统" tabindex="-1"><a class="header-anchor" href="#基本的linux文件系统" aria-hidden="true">#</a> 基本的Linux文件系统</h5><p><strong>1.ext文件系统</strong></p><p>Linux操作系统中引入最早的文件系统叫做扩展文件系统（extended filesystem，简称ext）。它为Linux提供一个基本的类Unix文件系统：使用虚拟目录来操作硬件设备，在物理设备上按定长的块来存储数据。</p><p>ext文件系统采用<strong>索引节点</strong>的系统存放虚拟目录中所存储文件的信息。索引结点系统在每个物理设备中创建一个单独的表（索引结点表）来存储这些文件的信息。存储在虚拟目录中的每一个文件在索引结点表中都有一个条目。ext文件系统名称中extended部分来自其跟踪的每个文件的额外数据，包括：</p><ul><li>文件名</li><li>文件大小</li><li>文件的属主</li><li>文件的属组</li><li>文件的访问权限</li><li>指向存有文件数据的每个硬盘块的指针</li></ul><p>Linux通过唯一的数值来引用索引结点表中的每个索引结点，这个值在创建文件时由文件系统分配。文件系统通过索引结点而不是文件全名及路径来标识文件。</p><p><strong>2.ext2文件系统</strong></p><p>最早的ext文件系统有不少的限制，比如文件大小不得超过2GB。ext2文件系统是ext文件系统基本功能的一个扩展，但保持了同样的结构。ext2的索引节点表为文件添加了创建时间值、修改时间值和最后访问时间值来帮助系统管理员追踪文件的访问情况。ext2还运行最大文件大小增加到32TB，以容纳数据库服务器中常见的大文件。</p><p>保存文件时，ext的问题是存储数据用的块容易分散到整个设备中（碎片化），而ext2通过按组分配磁盘块来减轻碎片化。通过将数据块分组，文件系统在读取文件不需要为了数据块查找整个物理设备，加快查找和存储性能。</p><p>问题：ext文件系统的索引结点表虽然支持文件系统保存有关文件的更多信息，但会对系统造成致命的问题。文件系统每次存储或更新文件，它都要用新信息来更新索引节点表。问题在于这种操作并非总是一气呵成的。如果计算机在存储文件和更新索引节点表之间发生点什么，这两者的内容就无法同步了。</p><h5 id="日志文件系统" tabindex="-1"><a class="header-anchor" href="#日志文件系统" aria-hidden="true">#</a> 日志文件系统</h5><p>日志文件系统用来解决上述问题，它为Linux系统增加了一层安全性。它不再使用之前先将数据直接写入存储设备而更新索引节点表，而是将文件的更改写入到临时文件（称作日志，journal）中。在数据成功写到存储设备和索引节点表之后，再删除对应的日志条目。</p><p>如果系统的数据被写入存储设备之前崩溃或断掉了，日志文件系统下次会读取日志文件并处理上次留下的未写入的数据。</p><p>Linux中有3种广泛使用的日志方法：</p><table><thead><tr><th>方法</th><th>描述</th></tr></thead><tbody><tr><td>数据模式</td><td>索引节点和文件都会被写入日志，丢失数据风险低，但性能差。</td></tr><tr><td>有序模式</td><td>只有索引节点数据会被写入日志，但只有数据成功写入后才删除；在性能和安全性之间取得了良好的折中。</td></tr><tr><td>回写模式</td><td>只写入索引节点数据到日志，但不控制文件数据何时写入；丢失数据风险高，但仍比不用日志好。</td></tr></tbody></table><p><strong>1.ext3文件系统</strong></p><p>2001年，ext3文件系统被引入Linux内核中。它采用和ext2文件系统相同的索引节点表结构，但给每个存储设备增加一个日志文件，将准备写入存储设备的数据先记入日志。</p><p>默认情况下，ext3文件系统用<strong>有序模式</strong>的日志功能。</p><p>问题：ext3文件系统无法恢复误删的文件；没有任何内建的数据压缩功能；不支持加密文件。</p><p><strong>2.ext4文件系统</strong></p><p>ext4文件系统在2008年受到Linux内核官方支持。除了支持数据压缩和加密，ext4系统还支持一个称作<strong>区段</strong>（extent）的特性。区段在存储设备上按块分配空间，但在索引节点表中只保存起始块的位置。由于无需列出所有用来存储文件中数据的数据块，它可以在索引节点表中节省一些空间。</p><p>ext4还引入了<strong>块预分配技术</strong>（block preallocation）。可以为即将变大的文件预留空间。</p><p><strong>3.Reiser文件系统</strong></p><p>ReiserFS文件系统是2001年由Hans Reiser编写的，它支持回写日志模式，因此也称为Linux上最快的日志文件系统之一。</p><p>ReiserFS有两个有趣的特性：在线调整已有文件系统的大小；尾部压缩（tailpacking）的技术。</p><p><strong>4.JFS文件系统</strong></p><p>JFS（Journaled File System，日志化文件系统）是IBM在1990年为其Unix衍生版AIX开发的。JSF文件系统采用有序日志方法。采用基于区段的文件分配。</p><p><strong>5.XFS文件系统</strong></p><p>XFS日志文件系统是最初用于商业Unix系统，采用回写模式的日志。</p><h5 id="写时复制文件系统" tabindex="-1"><a class="header-anchor" href="#写时复制文件系统" aria-hidden="true">#</a> 写时复制文件系统</h5><p>采用日志式技术，你就必须在安全性和性能之间做出选择。</p><p>日志式的另一种选择是一种叫作<strong>写时复制</strong>（copy-on-write，COW）的技术。COW利用快照兼顾了安全性和性能。修改数据时，会使用克隆或可写快照。修改过的数据并不会直接覆盖当前数据，而是被放入文件系统的另一个位置上。即便是数据修改已经完成，之前的旧数据也不会被重写。</p><p><strong>1.ZFS文件系统</strong></p><p>ZFS由Sun公司于2005年研发，用于OpenSolaris操作系统，在2012年投入Linux产品的使用。</p><p>ZFS是一个稳定的文件系统，与Resier4、Btrfs和ext4势均力敌。</p><p><strong>2.Btrf文件系统</strong></p><p>Btrfs被称为B树文件系统。它是由Oracle公司于2007年开始研发的。Btrfs在Reiser4的诸多特性的基础上改进了可靠性。</p><h4 id="_8-2-操作文件系统" tabindex="-1"><a class="header-anchor" href="#_8-2-操作文件系统" aria-hidden="true">#</a> 8.2 操作文件系统</h4><h5 id="创建分区" tabindex="-1"><a class="header-anchor" href="#创建分区" aria-hidden="true">#</a> 创建分区</h5><p>一开始，你必须在存储设备上创建分区来容纳文件系统。分区可以是整个硬盘，也可以是部分硬盘，以容纳虚拟目录的一部分</p><p><code>fdisk</code>工具用来帮助管理安装在系统上的任何存储设备上的分区。<code>fdisk 设备名</code>。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_03_03_ZojVkp.png" alt="2022_03_03_ZojVkp"></p><table><thead><tr><th>命令</th><th>描述</th></tr></thead><tbody><tr><td>d</td><td>删除分区</td></tr><tr><td>l</td><td>显示可用的分区类型</td></tr><tr><td>m</td><td>显示命令选项</td></tr><tr><td>n</td><td>创建一个新分区</td></tr><tr><td>p</td><td>显示当前分区表</td></tr><tr><td>t</td><td>修改分区的系统ID</td></tr><tr><td>q</td><td>退出，不保存更改</td></tr><tr><td>w</td><td>将分区表写入磁盘</td></tr></tbody></table><h5 id="创建文件系统" tabindex="-1"><a class="header-anchor" href="#创建文件系统" aria-hidden="true">#</a> 创建文件系统</h5><p>在将数据存储到分区之前，必须用某种文件系统对其进行格式化，这样Linux才能使用它。每种文件系统类型都用自己的命令行程序来格式化分区。</p><table><thead><tr><th>工具</th><th>用途</th></tr></thead><tbody><tr><td>mkefs</td><td>创建一个ext文件系统</td></tr><tr><td>mke2fs</td><td>创建一个ext2文件系统</td></tr><tr><td>mkfs.ext3</td><td>创建一个ext3文件系统</td></tr><tr><td>mkfs.ext4</td><td>创建一个ext4文件系统</td></tr><tr><td>mkreiserfs</td><td>创建一个ReiserFS文件系统</td></tr><tr><td>jfs_mkfs</td><td>创建一个JFS文件系统</td></tr><tr><td>mkfs.xfs</td><td>创建一个XFS文件系统</td></tr><tr><td>mkfs.zfs</td><td>创建一个ZFS文件系统</td></tr><tr><td>mkfs.btrfs</td><td>创建一个Btrfs文件系统</td></tr></tbody></table><p>为分区创建了文件系统系统之后，下一步是将它挂载到虚拟目录下的某个挂载点，这样就可以将数据存储在新文件系统中了。</p><h5 id="文件系统的检查与修复" tabindex="-1"><a class="header-anchor" href="#文件系统的检查与修复" aria-hidden="true">#</a> 文件系统的检查与修复</h5><p><code>fask</code>目录能够检查和修复大部分类型的Linux文件系统。<code>fsck options filesystem</code>。</p><h4 id="_8-3-逻辑卷管理" tabindex="-1"><a class="header-anchor" href="#_8-3-逻辑卷管理" aria-hidden="true">#</a> 8.3 逻辑卷管理</h4><p>在存储设备分区上直接创建文件系统的一个限制因素是，如果硬盘空间用完了，你无法轻易地改变文件系统的大小。将另外一个硬盘上的分区加入已有文件系统，动态地添加存储空间，Linux逻辑卷管理器（logical volume manager，LVM）软件包可以用来做这个。</p><h5 id="逻辑卷管理布局" tabindex="-1"><a class="header-anchor" href="#逻辑卷管理布局" aria-hidden="true">#</a> 逻辑卷管理布局</h5><p>在逻辑卷管理的世界里，硬盘分区称作物理卷（physical volume，PV）。每个物理卷都会映射到硬盘上特定的物理分区。多个物理卷集合在一起可以形成一个卷组（volume group，VG）。逻辑卷管理系统将多个卷组视为一个物理硬盘，卷组可能是由分布在多个物理硬盘上的多个物理分区组成的。卷组提供了一个创建逻辑分区的平台，而这些逻辑分区则包含了文件系统。</p><p>整个结构中的最后一层是逻辑卷（logical volume，LV）。逻辑卷为Linux提供了创建文件系统的分区环境。Linux将逻辑卷视为物理分区。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_03_03_IMG_5780.jpg" alt="2022_03_03_IMG_5780"></p><h5 id="linux中的lvm" tabindex="-1"><a class="header-anchor" href="#linux中的lvm" aria-hidden="true">#</a> Linux中的LVM</h5><p>Linux LVM有两个可用的版本：</p><ul><li>LVM1：与1998年发布，只能用于Linux内核2.4。仅提供了基本的逻辑卷管理功能。</li><li>LVM2：可用于Linux内核2.6。在标准的LVM1功能外提供了额外的功能。</li></ul><p><strong>1.快照</strong></p><p>在逻辑卷在线的状态下将其复制到另一个设备，这个功能叫做快照。</p><p><strong>2.条带化</strong></p><p>条带化，可跨多个物理设备创建逻辑卷。有助于提高硬盘的性能。</p><p><strong>3.镜像</strong></p><p>镜像是一个实时更新的逻辑卷的完整副本。</p><h2 id="第9章-安装软件程序" tabindex="-1"><a class="header-anchor" href="#第9章-安装软件程序" aria-hidden="true">#</a> 第9章 安装软件程序</h2><h4 id="_9-1-包管理基础" tabindex="-1"><a class="header-anchor" href="#_9-1-包管理基础" aria-hidden="true">#</a> 9.1 包管理基础</h4><p>PMS（package management system，包管理器）利用一个数据库来记录各种相关内容：Linux系统上已经安装了什么软件包；每个包安装了什么文件；每个已安装软件包的版本。</p><p>软件包存储在服务器（仓库（respository））上，可以用PMS来搜索并安装或更新新的软件包。软件包通常会依赖其他的包，PMS会检测这些依赖关系，并自动安装所有额外的软件包。</p><p>Linux主要使用PMS基础工具是<code>dpkg</code>（基于Debian）和<code>rpm</code>（基于Red Hat）。</p><h4 id="_9-2-基于debian的系统" tabindex="-1"><a class="header-anchor" href="#_9-2-基于debian的系统" aria-hidden="true">#</a> 9.2 基于Debian的系统</h4><p><code>dpkg</code>命令是基于Debian系PMS工具的核心。包含在这个PMS中的其他工具有：</p><ul><li><code>apt-get</code></li><li><code>apt-cache</code></li><li><code>aptitude</code></li></ul><p>最常用的命令行工具是<code>aptitude</code>，<code>aptitude</code>工具本质上是<code>apt</code>工具和<code>dpkg</code>的前端。<code>dpkg</code>是软件包管理系统工具，而<code>aptitude</code>则是完整的软件包管理系统。</p><h5 id="用aptitude管理软件包" tabindex="-1"><a class="header-anchor" href="#用aptitude管理软件包" aria-hidden="true">#</a> 用<code>aptitude</code>管理软件包</h5><p><code>aptitude</code>命令进入全屏模式。<code>aptitude show 包名</code>可以显示某个包的详细信息。</p><p><code>dpkg -L package_name</code>可以显示所有跟某个特定软件包相关的所有文件的列表。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_03_04_mriuoX.png" alt="2022_03_04_mriuoX"></p><h5 id="用aptitude安装软件包" tabindex="-1"><a class="header-anchor" href="#用aptitude安装软件包" aria-hidden="true">#</a> 用aptitude安装软件包</h5><p><code>aptitude search package_name</code>查找某个包名。</p><p><code>aptitude install package_name</code>安装包。</p><h5 id="用aptitude更新软件" tabindex="-1"><a class="header-anchor" href="#用aptitude更新软件" aria-hidden="true">#</a> 用aptitude更新软件</h5><p><code>aptitude safe-upgrade</code>将所有已安装的包更新到最新版本。</p><h5 id="用aptitude卸载软件" tabindex="-1"><a class="header-anchor" href="#用aptitude卸载软件" aria-hidden="true">#</a> 用aptitude卸载软件</h5><p>要想只删除软件包而不删除数据和配置文件，可以使用<code>aptitude remove</code>。要删除软件包和相关的数据和配置文件，使用<code>purge</code>选项。</p><h5 id="aptitude仓库" tabindex="-1"><a class="header-anchor" href="#aptitude仓库" aria-hidden="true">#</a> aptitude仓库</h5><p><code>aptitude</code>默认的软件仓库位置是存储在<code>/etc/apt/sources.list</code>中。如果你需要为你的PMS添加一些额外的软件仓库，就在这个文件中设置。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_03_04_g6nHFx.png" alt="2022_03_04_g6nHFx"></p><p>使用下面的结构来指定仓库源。<code>deb or (deb-src) address distribution_name package_type_list</code>。</p><ul><li>deb或deb-srd表明软件包的类型。deb表示这是一个已编译程序源，deb-src表示这是一个源代码的源。</li><li>address表示软件仓库的Web地址。</li><li>distribution_name是这个特定软件仓库的发行版版本的名称。</li><li>package_type_list表明仓库里面有什么类型的包。</li></ul><h4 id="_9-3-基于red-hat-的系统" tabindex="-1"><a class="header-anchor" href="#_9-3-基于red-hat-的系统" aria-hidden="true">#</a> 9.3 基于Red Hat 的系统</h4><ul><li><code>yum</code></li><li><code>urpm</code></li><li><code>zypper</code></li></ul><p>删除软件包可以选择</p><ul><li>只删除软件包而保留配置文件和数据文件</li><li>全部删除</li></ul><h5 id="处理损坏的包依赖关系" tabindex="-1"><a class="header-anchor" href="#处理损坏的包依赖关系" aria-hidden="true">#</a> 处理损坏的包依赖关系</h5><p>有时候在安装多个软件包时，某个包的软件依赖关系会被另一个包的安装覆盖掉。</p><p><code>yum repolist</code>显示当前使用的仓库。</p><h4 id="_9-4-从源码安装" tabindex="-1"><a class="header-anchor" href="#_9-4-从源码安装" aria-hidden="true">#</a> 9.4 从源码安装</h4><p>去包的官方站点下载包，文件名是xxx.tar.gz，之后进行解包，使用<code>tar</code>命令进行解压，之后进入目录，阅读README文件，<code>make</code>命令用来构建各种二进制文件，编译源码，<code>make</code>步骤结束后，可运行程序就生成了，但从那个目录下运行程序不是很方便，如果想安装到系统，那就必须以root身份运行<code>make install</code>。</p><h3 id="第10章-使用编辑器" tabindex="-1"><a class="header-anchor" href="#第10章-使用编辑器" aria-hidden="true">#</a> 第10章 使用编辑器</h3><h4 id="_10-1-vim编辑器" tabindex="-1"><a class="header-anchor" href="#_10-1-vim编辑器" aria-hidden="true">#</a> 10.1 vim编辑器</h4><p><code>vi</code>实际上引用的是<code>vim</code>。</p><p>vim编辑器有两种操作模式：</p><ul><li>普通模式（也称命令行模式）（默认）</li><li>插入模式</li></ul><h5 id="命令行模式" tabindex="-1"><a class="header-anchor" href="#命令行模式" aria-hidden="true">#</a> 命令行模式</h5><p><strong>移动光标</strong></p><ul><li><code>h</code>：左移</li><li><code>l</code>：右移</li><li><code>j</code>：下移</li><li><code>k</code>：上移</li></ul><p><strong>快速移动</strong></p><ul><li><code>PageDown(Ctrl+F)</code>：下翻一页</li><li><code>PageUp(Ctrl+B)</code>：上翻一页</li><li><code>G</code>：移动到缓冲区的最后一行</li><li><code>num G</code>：移动到缓冲区的第num行</li><li><code>gg</code>：移动到第一行</li></ul><p><strong>退出</strong></p><ul><li><code>q</code>：如果未修改缓冲区数据，退出</li><li><code>q!</code>：取消所有对缓冲区数据的修改并退出</li><li><code>w filename</code>：将文件保存到另一个文件中</li><li><code>wq</code>：将缓冲区数据保存到文件中并退出</li></ul><p><strong>编辑数据</strong></p><ul><li><code>x</code>：删除当前光标所在位置的字符</li><li><code>dd</code>：删除当前光标所在行</li><li><code>dw</code>：删除当前光标所在位置的单词</li><li><code>d$</code>：删除当前光标所在位置至行尾的内容</li><li><code>J</code>：删除当前光标所在行行尾的换行符</li><li><code>u</code>：撤销前一编辑命令</li><li><code>a</code>：在当前光标后追加数据</li><li><code>A</code>：在当前光标所在行行尾追加数据</li><li><code>r char</code>：用char替换当前光标所在位置的单个字符</li><li><code>R text</code>：用text覆盖当前光标所在位置的数据，直到按下ESC</li></ul><p><strong>复制和粘贴</strong></p><ul><li><code>y</code>：复制文本，<code>yw</code>复制一个单词，<code>y$</code>复制到行尾</li><li><code>p</code>：粘贴</li></ul><p><strong>可视模式</strong></p><ul><li><code>v</code>：进入可视模式</li></ul><p><strong>查找和替换</strong></p><ul><li><code>/</code>：查找</li><li><code>n</code>：查找下一个</li><li><code>:s/old/new/g:</code>：一行命令替换所有old</li><li><code>:n,ms/old/new/g:</code>：替换行号n和m之间的所有old</li><li><code>:%s/old/new/g:</code>：替换整个文件中的所有old</li><li><code>:%s/old/new/gc:</code>：替换整个文件中的所有old，但在每次出现时提示</li></ul><h4 id="_10-2-nano编辑器" tabindex="-1"><a class="header-anchor" href="#_10-2-nano编辑器" aria-hidden="true">#</a> 10.2 nano编辑器</h4><p><strong>nano</strong>是一款简单易用的控制台模式文本编辑器。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_04_14_YBqpUk.png" alt="2022_04_14_YBqpUk"></p><p>脱字符<code>^</code>表示<code>Ctrl</code>键。</p><h4 id="_10-3-emacs编辑器" tabindex="-1"><a class="header-anchor" href="#_10-3-emacs编辑器" aria-hidden="true">#</a> 10.3 emacs编辑器</h4><p>emacs默认选装，一般需要自行安装。</p><h4 id="_10-4-kde系编辑器" tabindex="-1"><a class="header-anchor" href="#_10-4-kde系编辑器" aria-hidden="true">#</a> 10.4 KDE系编辑器</h4><p>KDE桌面官方支持的两款文本编辑器：</p><ul><li>KWrite</li><li>Kate</li></ul><h4 id="_10-5-gnome编辑器" tabindex="-1"><a class="header-anchor" href="#_10-5-gnome编辑器" aria-hidden="true">#</a> 10.5 GNOME编辑器</h4><p>GNOME或Unity桌面环境自带的图形化文本编辑器</p><ul><li>gedit</li></ul><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_04_15_6iNGfJ.png" alt="2022_04_15_6iNGfJ"></p><h2 id="第二部分-shell脚本编程基础" tabindex="-1"><a class="header-anchor" href="#第二部分-shell脚本编程基础" aria-hidden="true">#</a> 第二部分 shell脚本编程基础</h2><h3 id="第11章-构建基本脚本" tabindex="-1"><a class="header-anchor" href="#第11章-构建基本脚本" aria-hidden="true">#</a> 第11章 构建基本脚本</h3><h4 id="_11-1-使用多个命令" tabindex="-1"><a class="header-anchor" href="#_11-1-使用多个命令" aria-hidden="true">#</a> 11.1 使用多个命令</h4><p>使用<code>;</code>对命令进行分隔 <code>date;who</code>。</p><h4 id="_11-2-创建shell脚本文件" tabindex="-1"><a class="header-anchor" href="#_11-2-创建shell脚本文件" aria-hidden="true">#</a> 11.2 创建shell脚本文件</h4><p>创建shell脚本文件，必须在文件的第一行指定要使用的shell。格式为：<code>#!/bin/bash</code>。</p><p>bash shell通过<code>$PATH</code>环境变量来查找命令，如果不再该环境变量下，有两种做法：</p><ul><li>将shell脚本文件所处的目录添加到PATH环境变量中。</li><li>在提示符中用绝对或相对文件路径来引用shell脚本文件</li></ul><p>shell脚本文件必须具备有可运行的权限。</p><h4 id="_11-3-显示消息" tabindex="-1"><a class="header-anchor" href="#_11-3-显示消息" aria-hidden="true">#</a> 11.3 显示消息</h4><p><code>echo</code>命令打印文本。</p><h4 id="_11-4-使用变量" tabindex="-1"><a class="header-anchor" href="#_11-4-使用变量" aria-hidden="true">#</a> 11.4 使用变量</h4><p><strong>环境变量</strong></p><p><code>$xx</code>或<code>${xx}</code>访问环境变量。</p><p><strong>用户变量</strong></p><p>用户变量由字母、数字或下划线组成的文本字符串，长度不超过<strong>20</strong>个，区分大小写，赋值时，在变量、等号和值之间不能出现空格。</p><h5 id="命令替换" tabindex="-1"><a class="header-anchor" href="#命令替换" aria-hidden="true">#</a> 命令替换</h5><p>将命令输出赋给变量</p><ul><li>反引号字符（<strong>`</strong>）</li><li>**<code>$()</code>**格式</li></ul><p>例：testing=`date`</p><h4 id="_11-5-重定向输入和输出" tabindex="-1"><a class="header-anchor" href="#_11-5-重定向输入和输出" aria-hidden="true">#</a> 11.5 重定向输入和输出</h4><h5 id="输出重定向" tabindex="-1"><a class="header-anchor" href="#输出重定向" aria-hidden="true">#</a> 输出重定向</h5><blockquote><p><code>command &gt; outputfile</code></p></blockquote><p>例：<code>date &gt; test5</code>将date命令输出的值输出到test5文件</p><p>如果之前输出的文件存在，重定向操作符会用新的文件覆盖旧的文件。</p><p>使用<code>&gt;&gt;</code>来追加数据，例：<code>who &gt;&gt; test5</code>。</p><h5 id="输入重定向" tabindex="-1"><a class="header-anchor" href="#输入重定向" aria-hidden="true">#</a> 输入重定向</h5><p>输入重定向将文件的内容重定向到命令。</p><blockquote><p><code>command &lt; inputfile</code></p></blockquote><p>一个简单的记忆方法：<strong>命令总是在左侧，而重定向符号“指向”数据流动的方向</strong>。</p><p>例：<code>wc &lt; test5</code>。</p><p><code>wc</code>命令对数据中的文本进行计数，默认会输出3个值：</p><ul><li>文本的行数</li><li>文本的词数</li><li>文本的字节数</li></ul><p>内联输入重定向：<code>command &lt;&lt; marker</code>。</p><p>例：<code>wc &lt;&lt; EOF test string 1 test string 2 test string 3 EOF</code></p><h4 id="_11-6-管道" tabindex="-1"><a class="header-anchor" href="#_11-6-管道" aria-hidden="true">#</a> 11.6 管道</h4><p>将一个命令的输出作为另一个命令的输入。</p><p><code>command1 | command2</code>，</p><p>Linux系统实际上会同时运行这两个命令，在系统内部将它们连接起来，在第一个命令产生输出的同时，输出会立即送给第二个命令。</p><h4 id="_11-7-执行数学运算" tabindex="-1"><a class="header-anchor" href="#_11-7-执行数学运算" aria-hidden="true">#</a> 11.7 执行数学运算</h4><h5 id="expr命令" tabindex="-1"><a class="header-anchor" href="#expr命令" aria-hidden="true">#</a> expr命令</h5><p>expr能识别少数的数字和字符串操作，例：<code>expr 1 + 5</code>、<code>expr 2 \* 10</code>。</p><h5 id="使用方括号" tabindex="-1"><a class="header-anchor" href="#使用方括号" aria-hidden="true">#</a> 使用方括号</h5><p>**<code>$[]</code>**将数学运算结果赋值给变量。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">var1=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">1 + 5</span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 6</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">var2=$</span><span style="color:#ECEFF4;">[</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;"> 2</span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var2</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 12</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>bash shell数学运算符只支持整数运算</p></blockquote><h5 id="浮点解决方案" tabindex="-1"><a class="header-anchor" href="#浮点解决方案" aria-hidden="true">#</a> 浮点解决方案</h5><p>使用bash的内建计算器，<code>bc</code>。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">parallels:</span><span style="color:#81A1C1;">~</span><span style="color:#D8DEE9FF;">/Desktop/demo$ bc</span></span>
<span class="line"><span style="color:#D8DEE9FF;">bc 1.07.1</span></span>
<span class="line"><span style="color:#D8DEE9FF;">Copyright 1991-1994, 1997, 1998, 2000, 2004, 2006, 2008, 2012-2017 Free Software Foundation, Inc.</span></span>
<span class="line"><span style="color:#D8DEE9FF;">This is free software with ABSOLUTELY NO WARRANTY.</span></span>
<span class="line"><span style="color:#D8DEE9FF;">For details </span><span style="color:#88C0D0;">type</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">warranty</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">. </span></span>
<span class="line"><span style="color:#A3BE8C;">scale=2 # 使用scale进行浮点运算，默认=0</span></span>
<span class="line"><span style="color:#A3BE8C;">1 / 0.3</span></span>
<span class="line"><span style="color:#A3BE8C;">3.33</span></span>
<span class="line"><span style="color:#A3BE8C;">quit</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在脚本中使用<code>bc</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">var1=20</span></span>
<span class="line"><span style="color:#D8DEE9FF;">var2=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">echo </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">scale=2; </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var1</span><span style="color:#A3BE8C;"> / 3</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> </span><span style="color:#81A1C1;">|</span><span style="color:#A3BE8C;"> bc</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var2</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 6.66</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>使用输入重定向</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">parallels:</span><span style="color:#81A1C1;">~</span><span style="color:#D8DEE9FF;">/Desktop/demo$ variable=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">bc </span><span style="color:#81A1C1;">&lt;&lt;</span><span style="color:#A3BE8C;"> </span><span style="color:#81A1C1;">EOF</span></span>
<span class="line"><span style="color:#A3BE8C;">scale=2</span></span>
<span class="line"><span style="color:#A3BE8C;">1 / 0.3</span></span>
<span class="line"><span style="color:#81A1C1;">EOF</span></span>
<span class="line"><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#616E88;"># variable=3.33</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_11-8-退出脚本" tabindex="-1"><a class="header-anchor" href="#_11-8-退出脚本" aria-hidden="true">#</a> 11.8 退出脚本</h4><p>shell中运行的每个命令都使用退出状态码（exit status）告诉shell它已经运行完毕。退出状态码是一个0~255的整数值，在命令结束运行时由命令传给shell。</p><h5 id="查看退出状态码" tabindex="-1"><a class="header-anchor" href="#查看退出状态码" aria-hidden="true">#</a> 查看退出状态码</h5><p><code>$?</code>变量保存上个已执行命令的退出状态码。</p><p>成功结束的命令的状态码是0，结束时有错误的命令状态码是127。</p><p>Linux退出状态码</p><table><thead><tr><th>状态码</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>命令成功结束</td></tr><tr><td>1</td><td>一般性未知错误</td></tr><tr><td>2</td><td>不适合的shell命令</td></tr><tr><td>126</td><td>命令不可执行</td></tr><tr><td>127</td><td>没找到命令</td></tr><tr><td>128</td><td>无效的退出参数</td></tr><tr><td>128+x</td><td>与Linux信号x相关的严重错误</td></tr><tr><td>130</td><td>通过Ctrl+C终止的命令</td></tr><tr><td>255</td><td>正常范围之外的退出状态码</td></tr></tbody></table><h5 id="exit命令" tabindex="-1"><a class="header-anchor" href="#exit命令" aria-hidden="true">#</a> exit命令</h5><p>exit可以定义自己的退出状态码。</p><h3 id="第12章-使用结构化命令" tabindex="-1"><a class="header-anchor" href="#第12章-使用结构化命令" aria-hidden="true">#</a> 第12章 使用结构化命令</h3><h4 id="_12-1-if-then语句" tabindex="-1"><a class="header-anchor" href="#_12-1-if-then语句" aria-hidden="true">#</a> 12.1 if-then语句</h4><p>格式：</p><blockquote><p><code>if command then commands fi</code></p></blockquote><p>bash shell的if语句会执行if后面的命令，如果该命令的退出状态码是0，则位于<code>then</code>部分的命令就会执行，如果该命令的退出状态码是其他值，<code>then</code>部分的命令就不会被执行。</p><h4 id="_12-2-if-then-else语句" tabindex="-1"><a class="header-anchor" href="#_12-2-if-then-else语句" aria-hidden="true">#</a> 12.2 if-then-else语句</h4><blockquote><p><code>if command then commands else commands fi</code></p></blockquote><h4 id="_12-3-嵌套if" tabindex="-1"><a class="header-anchor" href="#_12-3-嵌套if" aria-hidden="true">#</a> 12.3 嵌套if</h4><blockquote><p><code>if command1 then commands elif command2 then commands else commands fi</code></p></blockquote><blockquote><p>在<code>elif</code>语句中，紧跟其后的<code>else</code>语句属于<code>elif</code>代码块，它们不属于之前<code>if-then</code>代码块。</p></blockquote><h4 id="_12-4-test命令" tabindex="-1"><a class="header-anchor" href="#_12-4-test命令" aria-hidden="true">#</a> 12.4 test命令</h4><p><code>test</code>命令如果列出的条件成立，就会返回退出状态码0。</p><blockquote><p><code>test condition</code></p></blockquote><p>bash shell提供了另一种条件测试方法，无须在if-then语句中声明test命令</p><p>方括号之间必须加空格，否则会报错。test命令可以判断三类条件：</p><ul><li>数值比较</li><li>字符串比较</li><li>文件比较</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> condition </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">then</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  commands</span></span>
<span class="line"><span style="color:#81A1C1;">fi</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="数值比较" tabindex="-1"><a class="header-anchor" href="#数值比较" aria-hidden="true">#</a> 数值比较</h5><table><thead><tr><th>比较</th><th>描述</th></tr></thead><tbody><tr><td>n1 -eq n2</td><td>相等==</td></tr><tr><td>n1 -ge n2</td><td>大于或等于&gt;=</td></tr><tr><td>n1 -gt n2</td><td>大于&gt;</td></tr><tr><td>n1 -le n2</td><td>小于或等于&lt;=</td></tr><tr><td>n1 -lt n2</td><td>小于&lt;</td></tr><tr><td>n1 -ne n2</td><td>不相等!=</td></tr></tbody></table><blockquote><p>在bash shell中不能比较浮点数</p></blockquote><h5 id="字符串比较" tabindex="-1"><a class="header-anchor" href="#字符串比较" aria-hidden="true">#</a> 字符串比较</h5><table><thead><tr><th>比较</th><th>描述</th></tr></thead><tbody><tr><td>str1 = str2</td><td>相同</td></tr><tr><td>str1 != str2</td><td>不相同</td></tr><tr><td>str1 &lt; str2</td><td>小于</td></tr><tr><td>str1 &gt; str2</td><td>大于</td></tr><tr><td>-n str1</td><td>检查st1的长度是否非0</td></tr><tr><td>-z str1</td><td>str1的长度是否为0</td></tr></tbody></table><h5 id="文件比较" tabindex="-1"><a class="header-anchor" href="#文件比较" aria-hidden="true">#</a> 文件比较</h5><table><thead><tr><th>比较</th><th>描述</th></tr></thead><tbody><tr><td>-d file</td><td>检查file是否存在并是一个目录</td></tr><tr><td>-e file</td><td>检查file是否存在</td></tr><tr><td>-f file</td><td>检查file是否存在并是一个文件</td></tr><tr><td>-r file</td><td>检查file是否存在并可读</td></tr><tr><td>-s file</td><td>检查file是否存在并非空</td></tr><tr><td>-w file</td><td>检查file是否存在并可写</td></tr><tr><td>-x file</td><td>检查file是否存在并执行</td></tr><tr><td>-O file</td><td>检查file是否存在并属当前用户所有</td></tr><tr><td>-G file</td><td>检查file是否存在并且默认组与当前用户相同</td></tr><tr><td>file1 -nt file2</td><td>检查file1是否比file2新</td></tr><tr><td>file2 -ot file2</td><td>检查file1是否比file2旧</td></tr></tbody></table><h4 id="_12-5-复合条件测试" tabindex="-1"><a class="header-anchor" href="#_12-5-复合条件测试" aria-hidden="true">#</a> 12.5 复合条件测试</h4><ul><li><code>[ condition1 ] &amp;&amp; [ condition2 ]</code></li><li><code>[ condition1 ] || [ condition2 ]</code></li></ul><h4 id="_12-6-if-then的高级特性" tabindex="-1"><a class="header-anchor" href="#_12-6-if-then的高级特性" aria-hidden="true">#</a> 12.6 if-then的高级特性</h4><h5 id="使用双括号" tabindex="-1"><a class="header-anchor" href="#使用双括号" aria-hidden="true">#</a> 使用双括号</h5><p>双括号用于数学表达式，<code>(( expression ))</code></p><p>expression可以是任意的数学赋值或比较表达式</p><table><thead><tr><th>符号</th><th>描述</th></tr></thead><tbody><tr><td>val++</td><td>后增</td></tr><tr><td>val--</td><td>后减</td></tr><tr><td>++val</td><td>先增</td></tr><tr><td>--val</td><td>先减</td></tr><tr><td>!</td><td>逻辑求反</td></tr><tr><td>~</td><td>位求反</td></tr><tr><td>**</td><td>幂运算</td></tr><tr><td>&lt;&lt;</td><td>左位移</td></tr><tr><td>&gt;&gt;</td><td>右位移</td></tr><tr><td>&amp;</td><td>位布尔和</td></tr><tr><td>|</td><td>位布尔或</td></tr><tr><td>&amp;&amp;</td><td>逻辑和</td></tr><tr><td>||</td><td>逻辑或</td></tr></tbody></table><h4 id="_12-7-case命令" tabindex="-1"><a class="header-anchor" href="#_12-7-case命令" aria-hidden="true">#</a> 12.7 case命令</h4><blockquote><p><code>case variable in pattern1 | pattern2) commands1;; pattern3) commands2;; *) default commands;; esac</code></p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;"># demo</span></span>
<span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">case</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">USER</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span></span>
<span class="line"><span style="color:#D8DEE9FF;">par </span><span style="color:#ECEFF4;">|</span><span style="color:#D8DEE9FF;"> ppp</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">pppp</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">parallels</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> weclome </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">USER</span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#81A1C1;">*</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">hhh</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#81A1C1;">esac</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="第13章-更多的结构化命令" tabindex="-1"><a class="header-anchor" href="#第13章-更多的结构化命令" aria-hidden="true">#</a> 第13章 更多的结构化命令</h3><h4 id="_13-1-for命令" tabindex="-1"><a class="header-anchor" href="#_13-1-for命令" aria-hidden="true">#</a> 13.1 for命令</h4><blockquote><p><code>for var in list do commands done</code></p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># basic for command</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">test</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;"> Alabama Alaska Arizona Arkansas California Colorado</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> The next state is </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">test</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>读取复杂值</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># an example of how to properly define values</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">test</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;"> Nevada </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">New Hampshire</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">New Mexico</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">New York</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Now going to </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">test</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>从命令读取值</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># reading values from a file</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">file=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">states</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">state</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">cat </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Visit beautiful </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">state</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="更改字段分隔符" tabindex="-1"><a class="header-anchor" href="#更改字段分隔符" aria-hidden="true">#</a> 更改字段分隔符</h5><p>环境变量IFS，叫做内部字段分隔符，IFS定义bash shell用作字段分隔符的一系列字符</p><p>默认情况下，bash shell会将下列字符当作字段分隔符：</p><ul><li>空格</li><li>制表符</li><li>换行符</li></ul><p><code>IFS=$\n:;</code>这个赋值会将换行符、分号、冒号作为字段分隔符。</p><h5 id="通配符读取目录" tabindex="-1"><a class="header-anchor" href="#通配符读取目录" aria-hidden="true">#</a> 通配符读取目录</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># iterate through all the files in a directory</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">file</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;"> /home/rich/test/</span><span style="color:#81A1C1;">*</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-d</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">then</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file</span><span style="color:#A3BE8C;"> is a directory</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">elif</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-f</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">then</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file</span><span style="color:#A3BE8C;"> is a file</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">fi</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_13-2-c语言风格的for命令" tabindex="-1"><a class="header-anchor" href="#_13-2-c语言风格的for命令" aria-hidden="true">#</a> 13.2 C语言风格的for命令</h4><p><code>for (( variable assignment ; condition ; iteration process ))</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">((</span><span style="color:#A3BE8C;"> i </span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">1</span><span style="color:#A3BE8C;">; i </span><span style="color:#81A1C1;">&lt;=</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">10</span><span style="color:#A3BE8C;">; i</span><span style="color:#81A1C1;">++</span><span style="color:#A3BE8C;"> </span><span style="color:#ECEFF4;">))</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The next number is </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">i</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># multiple variables</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">((</span><span style="color:#A3BE8C;"> a</span><span style="color:#81A1C1;">=</span><span style="color:#B48EAD;">1</span><span style="color:#81A1C1;">,</span><span style="color:#A3BE8C;"> b</span><span style="color:#81A1C1;">=</span><span style="color:#B48EAD;">10</span><span style="color:#A3BE8C;">; a </span><span style="color:#81A1C1;">&lt;=</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">10</span><span style="color:#A3BE8C;">; a</span><span style="color:#81A1C1;">++,</span><span style="color:#A3BE8C;"> b</span><span style="color:#81A1C1;">--</span><span style="color:#A3BE8C;"> </span><span style="color:#ECEFF4;">))</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">a</span><span style="color:#A3BE8C;"> - </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">b</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_13-3-while命令" tabindex="-1"><a class="header-anchor" href="#_13-3-while命令" aria-hidden="true">#</a> 13.3 while命令</h4><blockquote><p><code>while test command do other commands done</code></p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">var1=10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-gt</span><span style="color:#D8DEE9FF;"> 0 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var1</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  var1=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var1</span><span style="color:#D8DEE9FF;"> - 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_13-4-until命令" tabindex="-1"><a class="header-anchor" href="#_13-4-until命令" aria-hidden="true">#</a> 13.4 until命令</h4><p><code>until</code>命令和<code>while</code>命令的工作方式完全相反，它要求返回非零退出状态码。</p><blockquote><p><code>until test commands do other commands done</code></p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># using the until command</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">var1=100</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#81A1C1;">until</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-eq</span><span style="color:#D8DEE9FF;"> 0 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var1</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   var1=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var1</span><span style="color:#D8DEE9FF;"> - 25 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_13-5-嵌套循环" tabindex="-1"><a class="header-anchor" href="#_13-5-嵌套循环" aria-hidden="true">#</a> 13.5 嵌套循环</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># nesting for loops</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">((</span><span style="color:#A3BE8C;"> a </span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">1</span><span style="color:#A3BE8C;">; a </span><span style="color:#81A1C1;">&lt;=</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">3</span><span style="color:#A3BE8C;">; a</span><span style="color:#81A1C1;">++</span><span style="color:#A3BE8C;"> </span><span style="color:#ECEFF4;">))</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Starting loop </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">a</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">((</span><span style="color:#A3BE8C;"> b </span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">1</span><span style="color:#A3BE8C;">; b </span><span style="color:#81A1C1;">&lt;=</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">3</span><span style="color:#A3BE8C;">; b</span><span style="color:#81A1C1;">++</span><span style="color:#A3BE8C;"> </span><span style="color:#ECEFF4;">))</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">   Inside loop: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">b</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">done</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_13-6-循环处理文件数据" tabindex="-1"><a class="header-anchor" href="#_13-6-循环处理文件数据" aria-hidden="true">#</a> 13.6 循环处理文件数据</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;"># 保存原先的IFS，如果恢复可以使用IFS=$IFS.OLD</span></span>
<span class="line"><span style="color:#D8DEE9FF;">IFS.OLD=</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">IFS</span></span>
<span class="line"><span style="color:#D8DEE9FF;">IFS=</span><span style="color:#ECEFF4;">$&#39;</span><span style="color:#EBCB8B;">\n</span><span style="color:#ECEFF4;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">entry</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">cat /etc/passwd</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Valus in </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">entry</span><span style="color:#A3BE8C;"> -</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  IFS=:</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">value</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">entry</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">	</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">done</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_13-7-控制循环" tabindex="-1"><a class="header-anchor" href="#_13-7-控制循环" aria-hidden="true">#</a> 13.7 控制循环</h4><p>控制循环内部的两个命令</p><ul><li><code>break</code>退出循环</li><li><code>continue</code>中止某次循环</li></ul><h5 id="break命令" tabindex="-1"><a class="header-anchor" href="#break命令" aria-hidden="true">#</a> break命令</h5><blockquote><p><code>break n</code></p><p>要跳出的循环层级，默认n=1</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># breaking out of a for loop</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">var1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;"> 1 2 3 4 5 6 7 8 9 10</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-eq</span><span style="color:#D8DEE9FF;"> 5 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">then</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">break</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">fi</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Iteration number: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var1</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The for loop is completed</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># breaking out of an outer loop</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">((</span><span style="color:#A3BE8C;"> a </span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">1</span><span style="color:#A3BE8C;">; a </span><span style="color:#81A1C1;">&lt;</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">4</span><span style="color:#A3BE8C;">; a</span><span style="color:#81A1C1;">++</span><span style="color:#A3BE8C;"> </span><span style="color:#ECEFF4;">))</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Outer loop: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">((</span><span style="color:#A3BE8C;"> b </span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">1</span><span style="color:#A3BE8C;">; b </span><span style="color:#81A1C1;">&lt;</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">100</span><span style="color:#A3BE8C;">; b</span><span style="color:#81A1C1;">++</span><span style="color:#A3BE8C;"> </span><span style="color:#ECEFF4;">))</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">b</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-gt</span><span style="color:#D8DEE9FF;"> 4 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#81A1C1;">then</span></span>
<span class="line"><span style="color:#D8DEE9FF;">         </span><span style="color:#88C0D0;">break</span><span style="color:#D8DEE9FF;"> 2 </span><span style="color:#616E88;"># 跳出2层循环</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#81A1C1;">fi</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">   Inner loop: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">b</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">done</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="continue命令" tabindex="-1"><a class="header-anchor" href="#continue命令" aria-hidden="true">#</a> continue命令</h5><blockquote><p><code>continue n</code></p><p>中止某次循环的层级</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># using the continue command</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">((</span><span style="color:#A3BE8C;"> var</span><span style="color:#B48EAD;">1</span><span style="color:#A3BE8C;"> </span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">1</span><span style="color:#A3BE8C;">; var</span><span style="color:#B48EAD;">1</span><span style="color:#A3BE8C;"> </span><span style="color:#81A1C1;">&lt;</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">15</span><span style="color:#A3BE8C;">; var</span><span style="color:#B48EAD;">1</span><span style="color:#81A1C1;">++</span><span style="color:#A3BE8C;"> </span><span style="color:#ECEFF4;">))</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-gt</span><span style="color:#D8DEE9FF;"> 5 </span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">&amp;&amp;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-lt</span><span style="color:#D8DEE9FF;"> 10 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">then</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#81A1C1;">continue</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">fi</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Iteration number: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">var1</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_13-8-处理循环的输出" tabindex="-1"><a class="header-anchor" href="#_13-8-处理循环的输出" aria-hidden="true">#</a> 13.8 处理循环的输出</h4><p>可以对循环的输出使用管道或重定向，在<code>done</code>命令之后添加一个处理命令来实现。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># redirecting the for output to a file</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">((</span><span style="color:#A3BE8C;"> a </span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">1</span><span style="color:#A3BE8C;">; a </span><span style="color:#81A1C1;">&lt;</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">10</span><span style="color:#A3BE8C;">; a</span><span style="color:#81A1C1;">++</span><span style="color:#A3BE8C;"> </span><span style="color:#ECEFF4;">))</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The number is </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">a</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">done</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;"> test23.txt</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The command is finished.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_13-9-实例" tabindex="-1"><a class="header-anchor" href="#_13-9-实例" aria-hidden="true">#</a> 13.9 实例</h4><h5 id="查找可执行文件" tabindex="-1"><a class="header-anchor" href="#查找可执行文件" aria-hidden="true">#</a> 查找可执行文件</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">IFS=:</span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">folder</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">PATH</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">folder</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">file</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">folder</span><span style="color:#D8DEE9FF;">/</span><span style="color:#81A1C1;">*</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-x</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">then</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">  </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">fi</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">done</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h5 id="创建多个用户账户" tabindex="-1"><a class="header-anchor" href="#创建多个用户账户" aria-hidden="true">#</a> 创建多个用户账户</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># process new user accounts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">input=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">users.csv</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> IFS=</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> -r userid name</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">adding </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">userid</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  useradd -c </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> -m </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">userid</span></span>
<span class="line"><span style="color:#81A1C1;">done</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">&lt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">input</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 重定向输入</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="第14章-处理用户输入" tabindex="-1"><a class="header-anchor" href="#第14章-处理用户输入" aria-hidden="true">#</a> 第14章 处理用户输入</h3><h4 id="_14-1-命令行参数" tabindex="-1"><a class="header-anchor" href="#_14-1-命令行参数" aria-hidden="true">#</a> 14.1 命令行参数</h4><p>命令行参数允许在运行脚本时向命令行添加数据。</p><h5 id="读取参数" tabindex="-1"><a class="header-anchor" href="#读取参数" aria-hidden="true">#</a> 读取参数</h5><p>bash shell会将一些称为位置参数（positional parameter）的特殊变量分配给输入到命令行中的所有参数。位置参数变量是标准的数字：<strong><code>$0</code>是程序名</strong>，<code>$1</code>是第一个参数，<code>$2</code>是第二个参数，以此类推。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">factorial=1</span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">((</span><span style="color:#A3BE8C;"> number </span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">1</span><span style="color:#A3BE8C;">; number </span><span style="color:#81A1C1;">&lt;=</span><span style="color:#A3BE8C;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#A3BE8C;">; number</span><span style="color:#81A1C1;">++</span><span style="color:#A3BE8C;"> </span><span style="color:#ECEFF4;">))</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># $1表示第一个参数</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  factorial=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">factorial</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">number</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> The factorial of </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#D8DEE9FF;"> is </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">factorial</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>每个参数都是用空格分隔，如果要在参数值中包含空格，必须要用引号（单引号或双引号均可）。</p></blockquote><p><code>basename</code>命令会返回不包含路径的脚本名。</p><h5 id="测试参数" tabindex="-1"><a class="header-anchor" href="#测试参数" aria-hidden="true">#</a> 测试参数</h5><p>在使用参数前一定要检查其中是否存在数据</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-n</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">then</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> Hello </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#D8DEE9FF;">, glad to meet you.</span></span>
<span class="line"><span style="color:#81A1C1;">else</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Sorry, you did not identify yourself.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">fi</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_14-2-特殊参数变量" tabindex="-1"><a class="header-anchor" href="#_14-2-特殊参数变量" aria-hidden="true">#</a> 14.2 特殊参数变量</h4><h5 id="参数统计" tabindex="-1"><a class="header-anchor" href="#参数统计" aria-hidden="true">#</a> 参数统计</h5><p><code>$#</code>变量含有脚本运行时携带的参数的个数统计。</p><h5 id="抓取所有的数据" tabindex="-1"><a class="header-anchor" href="#抓取所有的数据" aria-hidden="true">#</a> 抓取所有的数据</h5><p><code>$*</code>和<code>$@</code>变量可以用来轻松访问所有的参数。</p><ul><li><code>$*</code>将所有参数当做一个单词保存</li><li><code>$@</code>将这些参数视为一个整体，可以使用for循环</li></ul><h4 id="_14-3-移动变量" tabindex="-1"><a class="header-anchor" href="#_14-3-移动变量" aria-hidden="true">#</a> 14.3 移动变量</h4><p><code>shift</code>命令能够用来操作命令行参数。</p><p>在使用<code>shift</code>命令时，默认情况下它会将每个参数变量向左移动一个位置，变量<code>$3</code>的值会移到<code>$2</code>中，变量<code>$2</code>的值会移到<code>$1</code>中。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">count=1</span></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-n</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Parameter #</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#A3BE8C;"> = </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  coun=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> + 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">shift</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_14-4-处理选项" tabindex="-1"><a class="header-anchor" href="#_14-4-处理选项" aria-hidden="true">#</a> 14.4 处理选项</h4><h5 id="查找选项" tabindex="-1"><a class="header-anchor" href="#查找选项" aria-hidden="true">#</a> 查找选项</h5><p><strong>1.处理简单选项</strong></p><p>用<code>case</code>语句来判断某个参数是否为选项，比如<code>-a</code>、<code>-b</code>等。</p><p><strong>2.分离参数和选项</strong></p><p>双破折号（--）用来表明选项列表结束。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-n</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">case</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    -a</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Found the -a option</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    -b</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Found the -b option</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    -c</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Found the -c option</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    --</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">shift</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 匹配到--就break退出循环</span></span>
<span class="line"><span style="color:#D8DEE9FF;">       </span><span style="color:#88C0D0;">break</span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">*</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#A3BE8C;"> is not an option</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">esac</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">shift</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">count=1</span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">param</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">@</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Paramter #</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#A3BE8C;">: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">param</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  count=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> + 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><strong>3.处理带值的参数</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-n</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">case</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    -a</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Found the -a option</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    -b</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> param=</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">2</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Found the -b option, with parameter value </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">param</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 获取指定选项后获取参数</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">shift</span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    --</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">shift</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">break</span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">*</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#A3BE8C;"> is not an option</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">esac</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">shift</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">count=1</span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">param</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">@</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Parameter #</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#A3BE8C;">: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">param</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  count=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> + 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h5 id="使用getopt命令" tabindex="-1"><a class="header-anchor" href="#使用getopt命令" aria-hidden="true">#</a> 使用getopt命令</h5><p><code>getopt</code>命令是一个在处理命令行选项和参数时非常方便的工具，它能够识别命令行参数。</p><blockquote><p><code>getopt optstring parameters</code></p></blockquote><p>在optstring中列出脚本中要用到的命令行选项字符，在需要用到参数的选项字符后面加一个冒号:。</p><p>例：<code>getopt ab:cd -a -b test1 -cd1 test2 test3</code>打印<code>-a -b test1 -c -d -- test2 test3</code>。</p><p>在脚本中使用getopt</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">set</span><span style="color:#D8DEE9FF;"> -- </span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">getopt -q ab:cd </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">@</span><span style="color:#ECEFF4;">&quot;)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 将getopt输出到set</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-n</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">...</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="更高级的getopts" tabindex="-1"><a class="header-anchor" href="#更高级的getopts" aria-hidden="true">#</a> 更高级的getopts</h5><blockquote><p><code>getopts optstring variable</code></p></blockquote><p>每次调用，只处理命令行上检测到的一个参数，处理完所有的参数之后退出并返回一个大于0的退出状态码。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">getopts</span><span style="color:#D8DEE9FF;"> :ab:c opt</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">case</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">opt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    a</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Found the -a option</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    b</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Found the -b option, width value </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">OPTARG</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    c</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Found the -c option</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">    </span><span style="color:#81A1C1;">*</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Unknown option: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">opt</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">esac</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#88C0D0;">shift</span><span style="color:#D8DEE9FF;"> $</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">OPTING</span><span style="color:#D8DEE9FF;"> - 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">count=1</span></span>
<span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">param</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">@</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Parameter </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#A3BE8C;">: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">param</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  count=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> + 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"><span style="color:#616E88;"># 这是一个能在所有shell脚本中使用的全功能命令行选项和参数处理工具</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p><code>getopts</code>命令支持参数值包含空格，支持选项字母和参数值放在一起使用，将未定义的选项统一输出成问号。</p><h4 id="_14-5-将选项标准化" tabindex="-1"><a class="header-anchor" href="#_14-5-将选项标准化" aria-hidden="true">#</a> 14.5 将选项标准化</h4><p>Linux中常用的标准化命令行选项的含义</p><table><thead><tr><th>选项</th><th>描述</th></tr></thead><tbody><tr><td>-a</td><td>显示所有对象</td></tr><tr><td>-c</td><td>生成一个计数</td></tr><tr><td>-d</td><td>指定一个目录</td></tr><tr><td>-e</td><td>扩展一个对象</td></tr><tr><td>-f</td><td>指定读入数据的文件</td></tr><tr><td>-h</td><td>显示命令的帮助信息</td></tr><tr><td>-i</td><td>忽略文本大小写</td></tr><tr><td>-l</td><td>产生输出的长格式版本</td></tr><tr><td>-n</td><td>使用非交互模式（批处理）</td></tr><tr><td>-o</td><td>将所有输出重定向到的指定的输出文件</td></tr><tr><td>-q</td><td>以安静模式运行</td></tr><tr><td>-r</td><td>递归地处理目录和文件</td></tr><tr><td>-s</td><td>以安静模式运行</td></tr><tr><td>-v</td><td>生成详细输出</td></tr><tr><td>-x</td><td>排除某个对象</td></tr><tr><td>-y</td><td>对所有问题回答yes</td></tr></tbody></table><h4 id="_14-6-获取用户的输入" tabindex="-1"><a class="header-anchor" href="#_14-6-获取用户的输入" aria-hidden="true">#</a> 14.6 获取用户的输入</h4><p><code>read</code>命令从标准输入（键盘）或另一个文件描述符中接受输入。</p><h5 id="基本的读取" tabindex="-1"><a class="header-anchor" href="#基本的读取" aria-hidden="true">#</a> 基本的读取</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> -n </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Enter your name:</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> name</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如果不指定变量，read命令接受到的任何数据都会放进特殊环境变量<code>REPLY</code>中。</p><table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>-p</td><td>指定提示符</td></tr><tr><td>-t</td><td>指定超时器</td></tr><tr><td>-n</td><td>指定字符数</td></tr><tr><td>-s</td><td>隐藏数据</td></tr></tbody></table><h5 id="超时" tabindex="-1"><a class="header-anchor" href="#超时" aria-hidden="true">#</a> 超时</h5><p>当计时器超时，<code>read</code>命令会返回一个非零退出状态码。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> -t 5 -p </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Please enter your name: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> name</span></span>
<span class="line"><span style="color:#81A1C1;">then</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">name</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">else</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Sorry, too slow!</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">fi</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="从文件中读取" tabindex="-1"><a class="header-anchor" href="#从文件中读取" aria-hidden="true">#</a> 从文件中读取</h5><p><code>read</code>命令可以读取文件，每次读取一行，当文件没有内容时会退出并返回非零状态码。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">count=1</span></span>
<span class="line"><span style="color:#D8DEE9FF;">cat test.txt </span><span style="color:#81A1C1;">|</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> line</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Line </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#A3BE8C;">: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">line</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  count=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> + 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="第15章-呈现数据" tabindex="-1"><a class="header-anchor" href="#第15章-呈现数据" aria-hidden="true">#</a> 第15章 呈现数据</h3><h4 id="_15-1-理解输入和输出" tabindex="-1"><a class="header-anchor" href="#_15-1-理解输入和输出" aria-hidden="true">#</a> 15.1 理解输入和输出</h4><h5 id="标准文件描述符" tabindex="-1"><a class="header-anchor" href="#标准文件描述符" aria-hidden="true">#</a> 标准文件描述符</h5><p>Linux系统将每个对象当作文件处理，包括输入和输出进程。Linux用文件描述符（file descriptor）来标识每个文件对象。文件描述符是一个非负整数，可以唯一标识会话中打开的文件。每个进程一次最多可以有9个文件描述符。出于特殊目的，bash shell保留了前三个文件描述符（0、1和2）。</p><table><thead><tr><th>文件描述符</th><th>缩写</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>STDIN</td><td>标准输入</td></tr><tr><td>1</td><td>STDOUT</td><td>标准输出</td></tr><tr><td>2</td><td>STDERR</td><td>标准错误</td></tr></tbody></table><p><strong>1.STDIN</strong></p><p>STDIN文件描述符代表shell的标准输入。对终端界面来说，标准输入是键盘。shell从STDIN文件描述符对应的键盘获得输入，在用户输入时处理每个字符。</p><p>许多bash命令能接受STDIN的输入，尤其是没有在命令行上指定文件的话，比如<code>cat</code>命令。</p><p><strong>2.STDOUT</strong></p><p>STDOUT文件描述符代表shell的标准输出。在终端界面上，标准输出就是终端显示器。shell的所有输出（包括shell中运行的程序和脚本）会被定向到标准输出中，也就是显示器。</p><p>默认情况下，大多数bash命令会将输出导向STDOUT文件描述符。</p><p>shell对错误消息的处理和普通输出是分开的。</p><p><strong>3.STDERR</strong></p><p>shell通过特殊的STDERR文件描述符来处理错误消息。STDERR文件描述符代表shell的标准错误输出。shell或shell中运行的程序和脚本出错时生成的错误消息都会发送到这个位置。</p><p>默认情况下，STDERR和STDOUT都会输出到显示器输出中。</p><h5 id="重定向错误" tabindex="-1"><a class="header-anchor" href="#重定向错误" aria-hidden="true">#</a> 重定向错误</h5><p><strong>1.只重定向错误</strong></p><p>将文件描述符值放在重定向符号前，可以设置重定向的文件描述符。</p><p><code>ls -al badfile 2&gt; test</code>；将错误消息重定向到test文件。</p><p><strong>2.重定向错误和数据</strong></p><p>如果想重定向错误和正常输出，必须用两个重定向符号。</p><p><code>ls -al test test2 test3 badtest 2&gt; test3 1&gt; test4</code></p><p><code>&amp;&gt;</code>符号支持将STDERR和STDOUT的输出重定向到同一个输出文件。<code>ls -al test test2 test3 badtest &amp;&gt; test5</code>。</p><h4 id="_15-2-在脚本重定向输出" tabindex="-1"><a class="header-anchor" href="#_15-2-在脚本重定向输出" aria-hidden="true">#</a> 15.2 在脚本重定向输出</h4><h5 id="临时重定向" tabindex="-1"><a class="header-anchor" href="#临时重定向" aria-hidden="true">#</a> 临时重定向</h5><p>将单独的一行输出到STDERR，使用输出重定向将输出信息重定向到STDERR文件描述符，记得在文件描述符数字之前加一个<code>&amp;</code>符号。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is an error</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">&gt;&amp;2</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 这一行会被当做STDERR处理</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">this is normal output</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="永久重定向" tabindex="-1"><a class="header-anchor" href="#永久重定向" aria-hidden="true">#</a> 永久重定向</h5><p><code>exec</code>命令告诉shell在脚本执行期间重定向某个特定文件描述符。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">1&gt;</span><span style="color:#D8DEE9FF;"> testout </span><span style="color:#616E88;"># 脚本中发给STDOUT的所有输出会被重定向到testout文件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is a test of redirecting all out</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">from a script to another file.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">without having to redirect every individual line</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_15-3-在脚本中重定向输入" tabindex="-1"><a class="header-anchor" href="#_15-3-在脚本中重定向输入" aria-hidden="true">#</a> 15.3 在脚本中重定向输入</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">0&lt;</span><span style="color:#D8DEE9FF;"> testfile </span><span style="color:#616E88;"># 告诉shell应该从文件tesfile中获得输入，而不是STDIN。</span></span>
<span class="line"><span style="color:#D8DEE9FF;">count=1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> line</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Line #</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#A3BE8C;">: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">line</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  count=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> + 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>这是在脚本中从待处理的文件中读取数据的绝妙方法。</p><h4 id="_15-4-创建自己的重定向" tabindex="-1"><a class="header-anchor" href="#_15-4-创建自己的重定向" aria-hidden="true">#</a> 15.4 创建自己的重定向</h4><p>在shell中最多有9个打开的文件描述符，其他6个均可用作输入或输出重定向。可以将这些文件描述符中的任意一个分配给文件，然后在脚本中使用它们。</p><h5 id="创建输出文件描述符" tabindex="-1"><a class="header-anchor" href="#创建输出文件描述符" aria-hidden="true">#</a> 创建输出文件描述符</h5><p>使用<code>exec</code>命令给输出分配文件描述符。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">3&gt;</span><span style="color:#D8DEE9FF;">test13out</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">this should display on the monitor</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">and this should be stored in the file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">&gt;&amp;3</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 这句会输出到test13out</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Then this should be back on the monitor</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="重定向文件描述符" tabindex="-1"><a class="header-anchor" href="#重定向文件描述符" aria-hidden="true">#</a> 重定向文件描述符</h5><p>通过分配另外一个文件描述符给标准文件描述符，可以恢复已重定向的文件描述符。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">3&gt;&amp;1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 将3文件描述符重定向到1标准输出文件描述符</span></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">1&gt;</span><span style="color:#D8DEE9FF;">test12out</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This should store in the output file</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">alone with this line</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">1&gt;&amp;3</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Now things should be back to normal</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="创建输入文件描述符" tabindex="-1"><a class="header-anchor" href="#创建输入文件描述符" aria-hidden="true">#</a> 创建输入文件描述符</h5><p>在重定向到文件之前，先将STDIN文件描述符保存到另外一个文件描述符，然后在读取完文件之后再将STDIN恢复到它原来的位置。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">6&lt;&amp;</span><span style="color:#D8DEE9FF;">0 </span><span style="color:#616E88;"># 将0重定向到6</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">0&lt;</span><span style="color:#D8DEE9FF;"> testfile </span><span style="color:#616E88;"># 将testfile的输出重定向到0文件描述符</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">count=1</span></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> line</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Line #</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#A3BE8C;">: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">line</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  count=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> + 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">0&lt;&amp;</span><span style="color:#D8DEE9FF;">6</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> -p </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Are you done now?</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> answer</span></span>
<span class="line"><span style="color:#81A1C1;">case</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">answer</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span></span>
<span class="line"><span style="color:#D8DEE9FF;">Y</span><span style="color:#ECEFF4;">|</span><span style="color:#D8DEE9FF;">y</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Goodbye</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">N</span><span style="color:#ECEFF4;">|</span><span style="color:#D8DEE9FF;">n</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Sorry, this is then end.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#81A1C1;">esac</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h5 id="关闭文件描述符" tabindex="-1"><a class="header-anchor" href="#关闭文件描述符" aria-hidden="true">#</a> 关闭文件描述符</h5><p>要关闭文件描述符，将它重定向到特殊符号<code>&amp;-</code>。</p><p>一旦关闭了文件描述符，就不能在脚本中向它写入任何数据，否则会生成错误信息。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">3&gt;</span><span style="color:#D8DEE9FF;"> test17file</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is a test line of data</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">&gt;&amp;3</span></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">3&gt;&amp;</span><span style="color:#D8DEE9FF;">-</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">cat test17file</span></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">3&gt;</span><span style="color:#D8DEE9FF;"> test17file </span><span style="color:#616E88;"># 关闭文件描述符之后再重新打开会覆盖原来的输出文件</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This&#39;ll be bad</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">&gt;&amp;3</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_15-5-列出打开的文件描述符" tabindex="-1"><a class="header-anchor" href="#_15-5-列出打开的文件描述符" aria-hidden="true">#</a> 15.5 列出打开的文件描述符</h4><p>**<code>lsof</code>**命令会列出整个Linux系统打开的所有文件描述符。</p><p><code>-p</code>选项指定进程ID，<code>-d</code>选项指定要显示的文件描述符编号，<code>-a</code>选项对其他两个选项的结果执行布尔AND运算，<code>-i:port</code>显示端口号对应的程序。</p><blockquote><p>环境变量<code>$$</code>可以知道当前的进程PID。</p></blockquote><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_04_25_LBeAPf.png" alt="2022_04_25_LBeAPf"></p><ul><li><strong>COMMAND</strong>：进程的名称。</li><li><strong>PID</strong>：进程的 ID。</li><li><strong>USER</strong>：进程所属的用户。</li><li><strong>FD</strong>：文件描述符，表示进程打开文件时使用的文件描述符。</li><li><strong>TYPE</strong>：文件类型，如 REG（常规文件）、DIR（目录）、CHR（字符设备）、FIFO（命名管道）、IPv4（IPv4 套接字）等。</li><li><strong>DEVICE</strong>：设备名称。</li><li><strong>SIZE/OFF</strong>：文件的大小或文件读/写指针的偏移量。</li><li><strong>NODE</strong>：文件的节点号。</li><li><strong>NAME</strong>：文件的名称。</li></ul><h4 id="_15-6-阻止命令输出" tabindex="-1"><a class="header-anchor" href="#_15-6-阻止命令输出" aria-hidden="true">#</a> 15.6 阻止命令输出</h4><p>不想显示脚本的输出，可以将STDERR重定向到一个叫做<strong>null</strong>文件的特殊文件，shell输出到<strong>null</strong>文件的任何数据都不会保存，全部都被丢弃。<strong>null</strong>放在<code>/dev/null</code>下。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">$ ls -al </span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;"> /dev/null</span></span>
<span class="line"><span style="color:#D8DEE9FF;">$ cat /dev/null </span><span style="color:#616E88;"># 没有任何输出</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>使用<code>cat /dev/null &gt; testfile</code>清除文件内容。</p><h4 id="_15-7-创建临时文件" tabindex="-1"><a class="header-anchor" href="#_15-7-创建临时文件" aria-hidden="true">#</a> 15.7 创建临时文件</h4><p>Linux提供了<code>/tmp</code>目录用于专门存放临时文件，一般在Linux启动时会自动删除<code>/tmp</code>目录下的所有文件。</p><p>**<code>mktemp</code>**命令可以在<code>/tmp</code>目录下创建一个唯一的临时文件，它会将文件的读写分配给文件的属主。</p><h5 id="创建本地临时文件" tabindex="-1"><a class="header-anchor" href="#创建本地临时文件" aria-hidden="true">#</a> 创建本地临时文件</h5><p>使用<code>mktemp</code>命令加上指定文件名模板，就可以在本地目录中创建一个文件。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">$ mktemp testing.XXXXXX </span><span style="color:#616E88;"># 创建的每个文件都是唯一的</span></span>
<span class="line"><span style="color:#D8DEE9FF;">$ ls -al testing</span><span style="color:#81A1C1;">*</span></span>
<span class="line"><span style="color:#D8DEE9FF;">-rw------- 1 parallels parallels 0 Apr 25 07:47 testing.z6tpko</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="在-tmp目录创建临时文件" tabindex="-1"><a class="header-anchor" href="#在-tmp目录创建临时文件" aria-hidden="true">#</a> 在/tmp目录创建临时文件</h5><p><code>-t</code>选项在<code>/tmp</code>目录下创建文件。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">$ mktemp -t test.XXXXXX</span></span>
<span class="line"><span style="color:#D8DEE9FF;">/tmp/test.HMuGj7</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="创建临时目录" tabindex="-1"><a class="header-anchor" href="#创建临时目录" aria-hidden="true">#</a> 创建临时目录</h5><p><code>-d</code>选项创建一个临时目录。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">$ mktemp -d dir.XXXXXX</span></span>
<span class="line"><span style="color:#D8DEE9FF;">dir.9Wdgh8</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># using a temporary directory</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">tempdir=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">mktemp -d dir.XXXXXX</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">tempdir</span></span>
<span class="line"><span style="color:#D8DEE9FF;">tempfile1=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">mktemp temp.XXXXXX</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">tempfile2=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">mktemp temp.XXXXXX</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">7&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">tempfile1</span></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">8&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">tempfile2</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Sending data to directory </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">tempdir</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is a test line of data for </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">tempfile1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">&gt;&amp;7</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is a test line of data for </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">tempfile2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">&gt;&amp;8</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_15-8-记录消息" tabindex="-1"><a class="header-anchor" href="#_15-8-记录消息" aria-hidden="true">#</a> 15.8 记录消息</h4><p>使用**<code>tee</code>**命令将输出同时发送到显示器和日志文件。tee相当于管道的一个T型接口，将STDIN输入的数据同时发往STDOUT和tee命令所指定的文件名。</p><blockquote><p><code>tee filename</code></p></blockquote><p>默认情况下，tee命令会覆盖输出的文件内容。</p><p><code>-a</code>选项将数据追加到文件中。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># using the tee command for logging</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">tempfile=test22file</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is the start of the test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">|</span><span style="color:#D8DEE9FF;"> tee </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">tempfile</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is the second line of the test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">|</span><span style="color:#D8DEE9FF;"> tee -a </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">tempfile</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is the end of the test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">|</span><span style="color:#D8DEE9FF;"> tee -a </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">tempfile</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_15-9-实例" tabindex="-1"><a class="header-anchor" href="#_15-9-实例" aria-hidden="true">#</a> 15.9 实例</h4><p>文件重定向常见于脚本需要读入文件和输出文件时。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># read file and create INSERT statements for MySQL</span></span>
<span class="line"><span style="color:#616E88;"># 这个脚本使用重定向读取csv并将内容写入数据库</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">outfile=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">members.sql</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">IFS=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> lname fname address city state zip</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   cat </span><span style="color:#81A1C1;">&gt;&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">outfile</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">&lt;&lt;</span><span style="color:#A3BE8C;"> </span><span style="color:#81A1C1;">EOF</span></span>
<span class="line"><span style="color:#A3BE8C;">   INSERT INTO members (lname,fname,address,city,state,zip) VALUES (&quot;$lname&quot;, &quot;$fname&quot;, &quot;$address&quot;, &quot;$city&quot;, &quot;$state&quot;, &quot;$zip&quot;);</span></span>
<span class="line"><span style="color:#81A1C1;">EOF</span></span>
<span class="line"><span style="color:#81A1C1;">done</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">&lt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">1</span><span style="color:#81A1C1;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="第16章-控制脚本" tabindex="-1"><a class="header-anchor" href="#第16章-控制脚本" aria-hidden="true">#</a> 第16章 控制脚本</h3><h4 id="_16-1-处理信号" tabindex="-1"><a class="header-anchor" href="#_16-1-处理信号" aria-hidden="true">#</a> 16.1 处理信号</h4><p>Linux利用信号与运行在系统中的进程进行通信。</p><p>当shell接受到信号时，会将信号传给所有由它启动的进程，以此告知出现的状况。</p><p>shell脚本默认情况下会忽略这些信号，这可能会导致不利于脚本的运行，可以通过在脚本中加入识别信号的代码解决这个问题。</p><h5 id="生成信号" tabindex="-1"><a class="header-anchor" href="#生成信号" aria-hidden="true">#</a> 生成信号</h5><ul><li>SIGHUP (1)：当终端连接断开时发送该信号。</li><li>SIGINT (2)：当用户在终端上按下CTRL-C时发送该信号。</li><li>SIGQUIT (3)：当用户在终端上按下CTRL-\时发送该信号。</li><li>SIGILL (4)：当进程执行了非法指令时发送该信号。</li><li>SIGABRT (6)：当进程调用abort函数时发送该信号。</li><li>SIGFPE (8)：当进程执行了非法算术操作时发送该信号。</li><li>SIGKILL (9)：强制终止进程。</li><li>SIGSEGV (11)：当进程试图访问不属于自己的内存时发送该信号。</li><li>SIGPIPE (13)：当进程向一个没有读端的管道写数据时发送该信号。</li><li>SIGALRM (14)：当alarm函数设置的时间到达时发送该信号。</li><li>SIGTERM (15)：请求终止进程。</li></ul><p><strong>1.中断进程</strong></p><p><code>Ctrl+C</code>组合键会生成SIGINT信号，停止shell中当前运行的进程。</p><p><strong>2.暂停进程</strong></p><p><code>Ctrl+Z</code>组合键会生成SIGTSTP信号，停止shell中运行的任何进程。停止进程会让程序继续保留在内存中，并能从上次停止的位置继续运行。</p><p>shell中<strong>运行的每个进程</strong>被称为<strong>作业</strong>，shell会为每个作业分配唯一的作业号。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_04_26_dCGATH.png" alt="2022_04_26_dCGATH"></p><p>当终止作业（使用kill命令终止进程）时，最开始不会得到任何回应，当你做了能产生shell提示符的操作（比如按回车键），就会看到一条显示作业被终止的消息。</p><h5 id="捕获信号" tabindex="-1"><a class="header-anchor" href="#捕获信号" aria-hidden="true">#</a> 捕获信号</h5><p>**<code>trap</code>**命令指定shell脚本要监看并从shell中拦截的Linux信号。</p><blockquote><p><code>trap commands signals</code></p><p>commands代表shell要执行的命令，signals代表要捕获的信号。</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">trap</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">echo &#39;Sorry! I have trapped Ctrl+c&#39;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> SIGINT </span><span style="color:#616E88;"># 捕获SIGNIT信号</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> This is a </span><span style="color:#88C0D0;">test</span><span style="color:#D8DEE9FF;"> script</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">count=1</span></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-le</span><span style="color:#D8DEE9FF;"> 10 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Loop #</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  sleep 1</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  count=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> + 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is the end of the test script</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_04_26_oMGr09.png" alt="2022_04_26_oMGr09" style="zoom:33%;"><h5 id="捕获脚本退出" tabindex="-1"><a class="header-anchor" href="#捕获脚本退出" aria-hidden="true">#</a> 捕获脚本退出</h5><p>要捕获脚本退出，只需在<code>trap</code>命令后面加上EXIT信号。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">trap</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">echo Goodbye...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> EXIT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">sleep 2</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="修改或移除捕获" tabindex="-1"><a class="header-anchor" href="#修改或移除捕获" aria-hidden="true">#</a> 修改或移除捕获</h5><p>要想在脚本中的不同位置进行不同的捕获处理，只需重新使用带有新选项的trap命令。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">trap</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">echo &#39; Sorry... Ctrl-C is trapped.&#39;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> SIGINT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">count=1</span></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-le</span><span style="color:#D8DEE9FF;"> 5 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Loop #</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  sleep 1</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  count=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> + 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">trap</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">echo &#39; I modified the trap!&#39;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> SIGINT</span></span>
<span class="line"><span style="color:#D8DEE9FF;">count=1</span></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-le</span><span style="color:#D8DEE9FF;"> 5 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Loop #</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  sleep 1</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  count=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> + 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_04_26_wAgGOd.png" alt="2022_04_26_wAgGOd"></p><p>也可以删除已设置好的捕获，只需在trap命令加上两个破折号即可，<code>trap -- SIGINT</code>。</p><h4 id="_16-2-以后台模式运行脚本" tabindex="-1"><a class="header-anchor" href="#_16-2-以后台模式运行脚本" aria-hidden="true">#</a> 16.2 以后台模式运行脚本</h4><p>所有的进程不会都显示在终端显示器上，这种进程被称为后台（background）运行进程。在后台模式中，进程运行时不会和终端会话上的STDIN、STDOUT以及STDERR关联。</p><h5 id="后台运行脚本" tabindex="-1"><a class="header-anchor" href="#后台运行脚本" aria-hidden="true">#</a> 后台运行脚本</h5><p>在运行脚本后面加个<code>&amp;</code>符号，就可以以后台模式运行脚本。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_04_26_A6f2VR.png" alt="2022_04_26_A6f2VR"></p><p>方括号中的数字是指后台进程的作业号，下一个数是PID。</p><p>当进程以后台模式运行时，它仍会使用终端显示器来显示STDOUT和STDERR消息，这会导致显示信息错乱，最后使用重定向处理STDOUT和STDERR。</p><h5 id="运行多个后台作业" tabindex="-1"><a class="header-anchor" href="#运行多个后台作业" aria-hidden="true">#</a> 运行多个后台作业</h5><p>在终端运行多个作业，如果终端退出，那么后台进程随之也会跟着退出。</p><h4 id="_16-3-在非控制台下运行脚本" tabindex="-1"><a class="header-anchor" href="#_16-3-在非控制台下运行脚本" aria-hidden="true">#</a> 16.3 在非控制台下运行脚本</h4><p>**<code>nohup</code>**命令运行另外一个命令来阻断所有发送给该进程的SIGHUP信号，从而达到阻止进程退出。</p><p>由于nohup命令解除终端与进程的关联，进程不会与STDOUT和STDERR联系在一起，它会将STDOUT和STDERR消息重定向到一个名为<code>nohup.out</code>的文件中。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_04_26_iOSXw5.png" alt="2022_04_26_iOSXw5"></p><h4 id="_16-4-作业控制" tabindex="-1"><a class="header-anchor" href="#_16-4-作业控制" aria-hidden="true">#</a> 16.4 作业控制</h4><p>可以向停止的进程发送一个SIGCONT信号让其重启。</p><p>启动、停止、终止以及恢复作业的这些功能统称为<strong>作业控制</strong>。</p><h5 id="查看作业" tabindex="-1"><a class="header-anchor" href="#查看作业" aria-hidden="true">#</a> 查看作业</h5><p>**<code>jobs</code>**命令查看正在处理的作业。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_04_27_lldNRK.png" alt="2022_04_27_lldNRK"></p><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>-l</td><td>列出进程的PID以及作业号</td></tr><tr><td>-n</td><td>只列出上次shell发出的通知后改变了状态的作业</td></tr><tr><td>-p</td><td>只列出作业的PID</td></tr><tr><td>-r</td><td>只列出运行中的作业</td></tr><tr><td>-s</td><td>只列出已停止的作业</td></tr></tbody></table><p>上面显示的+加号会被当做默认作业。在使用作业控制命令时，如果未在命令行指定任何作业号，该作业会被当成作业控制命令的操作对象。</p><p>当前的默认作业完成处理后，带减号-的作业称为下一个默认作业。任何时候都只有一个带加号的作业和一个带减号的作业，不管shell中有多少个正在运行的作业。</p><h5 id="重启停止的作业" tabindex="-1"><a class="header-anchor" href="#重启停止的作业" aria-hidden="true">#</a> 重启停止的作业</h5><p>可以将已停止的作业作为前台进程或后台进程重启。</p><p>**<code>bg</code>**命令以后台模式重启作业。</p><p>如果有多个作业，在bg命令后加上<strong>作业号</strong>。</p><p>**<code>fg</code>**命令以前台模式重启作业。</p><h4 id="_16-5-调整谦让度" tabindex="-1"><a class="header-anchor" href="#_16-5-调整谦让度" aria-hidden="true">#</a> 16.5 调整谦让度</h4><p>在多任务操作系统（如Linux）中，内核负责将CPU时间分配给系统上运行的每个进程。调度优先级（scheduling priority）是内核分配给进程的CPU时间。在Linux中，由shell启动的所有进程的调度优先级默认相同。</p><p>调度优先级是个整数，从-20（最高优先级）到+19（最低优先级）。默认情况下，bash shell以优先级0来启动所有进程。</p><h5 id="nice命令" tabindex="-1"><a class="header-anchor" href="#nice命令" aria-hidden="true">#</a> nice命令</h5><p>**<code>nice</code>**命令设置启动时的调度优先级。</p><p><code>-n</code>选项指定优先级级别运行。</p><p>nice命令阻止普通系统用户来提高命令的优先级。提高优先优先级时，-n选项不是必须的。</p><h5 id="renice命令" tabindex="-1"><a class="header-anchor" href="#renice命令" aria-hidden="true">#</a> renice命令</h5><p>**<code>renice</code>**命令可以改变已运行进程的优先级。</p><p>例：<code>renice -n 10 -p 15961</code>将PID为15961的进程的优先级调整为-10。</p><p><strong>限制：</strong></p><ul><li>只能对属于你的进程执行renice；</li><li>只能通过renice降低进程的优先级；</li><li>root用户可以通过renice来任意调整进程的优先级。</li></ul><h4 id="_16-6-定时运行作业" tabindex="-1"><a class="header-anchor" href="#_16-6-定时运行作业" aria-hidden="true">#</a> 16.6 定时运行作业</h4><h5 id="用at命令来计划执行作业" tabindex="-1"><a class="header-anchor" href="#用at命令来计划执行作业" aria-hidden="true">#</a> 用at命令来计划执行作业</h5><p>**<code>at</code>**命令允许指定何时运行脚本。at命令会将作业提交到队列中，指定shell何时运行该作业。at的守护进程atd会以后台模式运行，检查作业队列来运行作业。</p><p>atd守护进程会检查系统上的一个特殊目录（通常位于/var/spool/at）来获取用at命令提交的作业。默认情况下，atd守护进程会每<strong>60</strong>秒检查一下这个目录。</p><p><strong>1.at命令的格式</strong></p><blockquote><p><code>at [-f filename] time</code></p></blockquote><p>默认情况下，at命令会将STDIN的输入放到队列中。</p><p>time参数的时间格式：</p><ul><li>标准的小时和分钟格式，比如10:15。</li><li>AM/PM指示符，比如10:15 PM。</li><li>特定可命名时间，比如now、noon、midnight或者teatime（4PM）。</li><li>标准日期格式，比如MMDDYY、MM/DD/YY或DD.MM.YY。</li><li>文本日期，比如Jul 4或Dec 25。</li><li>时间增量 <ul><li>当前时间+25min</li><li>明天10:15 PM</li><li>10:15+7天</li></ul></li></ul><p>当使用at命令时，该作业会被提交到作业队列（job queue）。针对不同优先级，存在26中不同的作业队列，作业队列通常用小写字母a~z和大写字母A~Z来指代。作业队列的字母排序越高，作业运行的优先级越<strong>低</strong>。默认情况下作业会被提交到<strong>a</strong>作业队列中。</p><p><code>-q</code>选择指定不同的队列字母。</p><p><code>-f</code>选项指定使用哪个脚本文件。</p><p><strong>2.获取作业的输出</strong></p><p>at命令默认使用sendmail应用程序来将STDOUT和STDERR的输出发送到邮件。</p><p>使用at命令建议将STDOUT和STDERR进行重定向处理。</p><p><code>-M</code>选项屏蔽作业产生的输出信息。</p><p><strong>3.列出等待的作业</strong></p><p>**<code>atq</code>**命令查看系统中有哪些作业在等待。</p><p><strong>4.删除作业</strong></p><p>**<code>atrm</code>**命令删除等待中的作业。</p><h5 id="安排需要定期执行的脚本" tabindex="-1"><a class="header-anchor" href="#安排需要定期执行的脚本" aria-hidden="true">#</a> 安排需要定期执行的脚本</h5><p>Linux系统使用<strong>cron</strong>程序来安排要定期执行的作业。cron程序会在后台运行并检查一个特殊的表（cron时间表），以获知已安排执行的作业。</p><p><strong>1.cron时间表</strong></p><p>cron时间表采用一种特别的格式来指定作业何时运行：</p><p><code>min hour dayofmonth month dayofweek command</code></p><p>cron时间表允许你用特定值、取值范围（比如1~5）或者是通配符来指定条目。</p><p>例：<code>15 10 * * * command</code> 每天的10:15运行一个命令。</p><p><strong>2.构建cron时间表</strong></p><p>每个系统用户（包括root用户）都可以用自己的cron时间表来运行安排好的任务。</p><p>**<code>crontab</code>**命令处理cron时间表。</p><p><code>-l</code>选项列出已有的时间表。</p><p>用户的cron时间表文件默认不存在，可以通过<code>-e</code>选项为cron时间表添加条目，crontab命令会启动一个文本编辑器，输入相应的格式。</p><p><strong>3.浏览cron目录</strong></p><p>如果创建的脚本对精确的执行时间要求不高，用预配置的cron脚本目录会更方便。有4个基本目录：hourly、daily、monthly和weekly。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/2022_04_27_sww3ij.png" alt="2022_04_27_sww3ij"></p><p>如果脚本需要每天运行一次，只要将脚本复制到daily目录，cron就会每天执行它。</p><p><strong>4.anacron程序</strong></p><p>cron程序的唯一问题是它假定Linux系统是7×24小时运行的。</p><p>如果某个作业在cron时间表中安排运行的时间已到，但这时候Linux系统处于关机状态，那么这个作业不会被执行，当系统开机时，cron程序不会再去执行那些错过的作业。<code>anacron</code>程序可以解决这个问题。</p><p>如果<code>anacron</code>知道某个作业错过了执行时间，它会尽快运行该作业。这个功能常用于进行常规日志维护的脚本。</p><p><code>anacron</code>只会处理位于cron目录的程序，比如/etc/cron.monthly。它用时间戳来决定作业是否在正确的计划间隔内运行。每个cron目录都有个时间戳文件，该文件位于/var/spool/anacron。</p><p><code>anacron</code>程序使用自己的时间表（/etc/anacrontab）来检查作业目录。格式：<code>period delay identifier command</code>。<code>anacron</code>不会运行小于一天的脚本。</p><h5 id="使用新shell启动脚本" tabindex="-1"><a class="header-anchor" href="#使用新shell启动脚本" aria-hidden="true">#</a> 使用新shell启动脚本</h5><p>每次启动一个新shell时，bash shell都会运行.bashrc文件。</p><p>如果你需要一个脚本在两个时刻都得以运行，可以把这个脚本放进该文件中。</p><h2 id="第三部分-高级shell脚本编程" tabindex="-1"><a class="header-anchor" href="#第三部分-高级shell脚本编程" aria-hidden="true">#</a> 第三部分 高级shell脚本编程</h2><h3 id="第17章-创建函数" tabindex="-1"><a class="header-anchor" href="#第17章-创建函数" aria-hidden="true">#</a> 第17章 创建函数</h3><h4 id="_17-1-基本的脚本函数" tabindex="-1"><a class="header-anchor" href="#_17-1-基本的脚本函数" aria-hidden="true">#</a> 17.1 基本的脚本函数</h4><h5 id="创建函数" tabindex="-1"><a class="header-anchor" href="#创建函数" aria-hidden="true">#</a> 创建函数</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;"># 第一种定义方式</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">name</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">	commands</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;"># 第二种定义方式</span></span>
<span class="line"><span style="color:#88C0D0;">name</span><span style="color:#ECEFF4;">()</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">	commands</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="使用函数" tabindex="-1"><a class="header-anchor" href="#使用函数" aria-hidden="true">#</a> 使用函数</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">func1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is an example of a funtion</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">count=1</span></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-le</span><span style="color:#D8DEE9FF;"> 5 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  func1 </span><span style="color:#616E88;"># 函数调用</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  count=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">count</span><span style="color:#D8DEE9FF;"> + 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">This is the end of the loop</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">func1</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Now this is the end of the script</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_17-2-返回值" tabindex="-1"><a class="header-anchor" href="#_17-2-返回值" aria-hidden="true">#</a> 17.2 返回值</h4><p>bash shell会把函数当作一个小型脚本，运行结束时会返回一个退出状态码，有3种不同的方法来为函数生成退出状态码。</p><h5 id="默认退出状态码" tabindex="-1"><a class="header-anchor" href="#默认退出状态码" aria-hidden="true">#</a> 默认退出状态码</h5><p>默认情况下，函数的退出状态码是函数中最后一条命令返回的退出状态码。在函数执行结束后，可以用标准变量<code>$?</code>来确定函数的退出状态码。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">func1</span><span style="color:#ECEFF4;">()</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">trying to display a none-existent file</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  ls -l directory</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">testing the function:</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">func1</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The exit status is: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">?</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#616E88;"># testing the function:</span></span>
<span class="line"><span style="color:#616E88;"># trying to display a none-existent file</span></span>
<span class="line"><span style="color:#616E88;"># ls: cannot access &#39;badfile&#39;: No such file or directory</span></span>
<span class="line"><span style="color:#616E88;"># The exit status is: 2</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h5 id="使用return命令" tabindex="-1"><a class="header-anchor" href="#使用return命令" aria-hidden="true">#</a> 使用return命令</h5><p>**<code>return</code>**命令指定一个整数值来定义函数的退出状态码。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">db1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> -p </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Enter a value: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> value</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">doubling the value</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">return</span><span style="color:#D8DEE9FF;"> $</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;"> 2 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">db1</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The new value is </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">?</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>函数一结束就取返回值；</li><li>退出状态码必须是0~255。</li></ul><p><code>$?</code>变量会返回执行的最后一条命令的退出状态码。</p><h5 id="使用函数输出" tabindex="-1"><a class="header-anchor" href="#使用函数输出" aria-hidden="true">#</a> 使用函数输出</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">db1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> -p </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Enter a value: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> value</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> $</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;"> 2 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">result=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">db1</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 将函数输出赋值给$result</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The new value is </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">result</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><p>通过这种方式，你还可以返回浮点值和字符串值，这是一种获取函数返回值的强大方法。</p></blockquote><h4 id="_17-3-在函数中使用变量" tabindex="-1"><a class="header-anchor" href="#_17-3-在函数中使用变量" aria-hidden="true">#</a> 17.3 在函数中使用变量</h4><h5 id="向函数传递参数" tabindex="-1"><a class="header-anchor" href="#向函数传递参数" aria-hidden="true">#</a> 向函数传递参数</h5><p>函数使用标准的参数环境变量来表示命令行上传给函数的参数（$1、$2...）。</p><p><code>func1 $value1 10</code>通过将参数和函数放在同一行进行函数传参。</p><h5 id="在函数中处理变量" tabindex="-1"><a class="header-anchor" href="#在函数中处理变量" aria-hidden="true">#</a> 在函数中处理变量</h5><p>函数分为<strong>全局变量</strong>和<strong>局部变量</strong>。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">dbl</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  value=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;"> 2 </span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 全局变量值会被改变</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> -p </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Enter a value: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> value</span></span>
<span class="line"><span style="color:#D8DEE9FF;">dbl</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The new value is: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>局部变量</strong></p><p>在变量声明前面加上<code>local</code>关键字可实现局部变量。<code>local temp</code>。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">func1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#81A1C1;">local</span><span style="color:#D8DEE9FF;"> temp=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value</span><span style="color:#D8DEE9FF;"> + 5 </span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 局部变量</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  result=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">temp</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;"> 2 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">temp=4</span></span>
<span class="line"><span style="color:#D8DEE9FF;">value=6</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">func1</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The result is </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">result</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">temp</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-gt</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#81A1C1;">then</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">temp is larger</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#81A1C1;">else</span></span>
<span class="line"><span style="color:#D8DEE9FF;">  </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">temp is smaller</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 打印这句</span></span>
<span class="line"><span style="color:#81A1C1;">fi</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="_17-4-数组变量和函数" tabindex="-1"><a class="header-anchor" href="#_17-4-数组变量和函数" aria-hidden="true">#</a> 17.4 数组变量和函数</h4><h5 id="向函数传数组参数" tabindex="-1"><a class="header-anchor" href="#向函数传数组参数" aria-hidden="true">#</a> 向函数传数组参数</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">addarray</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">	</span><span style="color:#81A1C1;">local</span><span style="color:#D8DEE9FF;"> sum=0</span></span>
<span class="line"><span style="color:#D8DEE9FF;">	</span><span style="color:#81A1C1;">local</span><span style="color:#D8DEE9FF;"> newarray</span></span>
<span class="line"><span style="color:#D8DEE9FF;">	newarray=</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">echo </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">@</span><span style="color:#ECEFF4;">&quot;)</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 通过特殊变量还原数组值</span></span>
<span class="line"><span style="color:#D8DEE9FF;">	</span><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#D8DEE9;">value</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">newarray</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9;">*</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">	</span><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">	  sum=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">sum</span><span style="color:#D8DEE9FF;"> + </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">	</span><span style="color:#81A1C1;">done</span></span>
<span class="line"><span style="color:#D8DEE9FF;">	</span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">sum</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">myarray=</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">1 2 3 4 5</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The original array is: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">myarray</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9;">*</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">arg1=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">echo </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">myarray</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9;">*</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">result=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">addarray </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">arg1</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># arg1保存数组值 1 2 3 4 5</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The result is </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">result</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h5 id="从函数返回数组" tabindex="-1"><a class="header-anchor" href="#从函数返回数组" aria-hidden="true">#</a> 从函数返回数组</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># returning an array value</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">arraydblr</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">local</span><span style="color:#D8DEE9FF;"> origarray</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">local</span><span style="color:#D8DEE9FF;"> newarray</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">local</span><span style="color:#D8DEE9FF;"> elements</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">local</span><span style="color:#D8DEE9FF;"> i</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   origarray=</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">echo </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">@</span><span style="color:#ECEFF4;">&quot;)</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   newarray=</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">echo </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">@</span><span style="color:#ECEFF4;">&quot;)</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   elements=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">#</span><span style="color:#D8DEE9FF;"> - 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">((</span><span style="color:#A3BE8C;"> i </span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;"> </span><span style="color:#B48EAD;">0</span><span style="color:#A3BE8C;">; i </span><span style="color:#81A1C1;">&lt;=</span><span style="color:#A3BE8C;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">elements</span><span style="color:#A3BE8C;">; i</span><span style="color:#81A1C1;">++</span><span style="color:#A3BE8C;"> </span><span style="color:#ECEFF4;">))</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      newarray</span><span style="color:#ECEFF4;">[</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">i</span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">origarray</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9;">$i</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">}</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;"> 2 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">newarray</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9;">*</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">}</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;"># 生成数组输出</span></span>
<span class="line"><span style="color:#D8DEE9FF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">myarray=</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">1 2 3 4 5</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The original array is: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">myarray</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9;">*</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">arg1=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">echo </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">myarray</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9;">*</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">result=</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">arraydblr </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">arg1</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The new array is: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">result</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9;">*</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="_17-5-函数递归" tabindex="-1"><a class="header-anchor" href="#_17-5-函数递归" aria-hidden="true">#</a> 17.5 函数递归</h4><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;"># using recursion</span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">factorial</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-eq</span><span style="color:#D8DEE9FF;"> 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">then</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> 1</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">else</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#81A1C1;">local</span><span style="color:#D8DEE9FF;"> temp=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#D8DEE9FF;"> - 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#81A1C1;">local</span><span style="color:#D8DEE9FF;"> result=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">factorial </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">temp</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">      </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> $</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">result</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">   </span><span style="color:#81A1C1;">fi</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span></span>
<span class="line"><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> -p </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Enter value: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> value</span></span>
<span class="line"><span style="color:#D8DEE9FF;">result=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">factorial </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The factorial of </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value</span><span style="color:#A3BE8C;"> is: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">result</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_17-6-创建库" tabindex="-1"><a class="header-anchor" href="#_17-6-创建库" aria-hidden="true">#</a> 17.6 创建库</h4><p>bash shell允许创建函数库文件，在多个脚本中引用该库文件。默认情况下，脚本运行会创建新的shell，会造成当前shell无法使用脚本的变量。</p><p>**<code>source</code>**命令使脚本在当前shell上下文中执行，从而达到可以使用脚本变量的效果。它有个快捷的别名，点操作符（dot operator），比如：<code>. ./myfuncs</code>。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88C0D0;">source</span><span style="color:#D8DEE9FF;"> ./myfuncs.sh </span><span style="color:#616E88;"># 该脚本的函数都可以在当前上下文下使用</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D8DEE9FF;">value1=10</span></span>
<span class="line"><span style="color:#D8DEE9FF;">value2=5</span></span>
<span class="line"><span style="color:#D8DEE9FF;">result1=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">addem </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value1</span><span style="color:#A3BE8C;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value2</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">result2=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">multem </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value1</span><span style="color:#A3BE8C;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value2</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">result3=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">divem </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value1</span><span style="color:#A3BE8C;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">value2</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The result of adding them is: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">result1</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The result of multiplying them is: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">result2</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">The result of dividing them is: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">result3</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_17-7-在命令行上使用函数" tabindex="-1"><a class="header-anchor" href="#_17-7-在命令行上使用函数" aria-hidden="true">#</a> 17.7 在命令行上使用函数</h4><h5 id="在命令行上创建函数" tabindex="-1"><a class="header-anchor" href="#在命令行上创建函数" aria-hidden="true">#</a> 在命令行上创建函数</h5><p>shell会解释用户输入的命令，因此可以直接在命令行上定义一个函数。</p><h5 id="在-bashrc文件中定义函数" tabindex="-1"><a class="header-anchor" href="#在-bashrc文件中定义函数" aria-hidden="true">#</a> 在.bashrc文件中定义函数</h5><p>在命令行上直接定义shell函数的缺点是一旦退出shell函数就消失了。</p><p><code>.bashrc</code>在每次bash shell启动时都会运行它，直接在<code>.bashrc</code>文件中定义好函数，下次启动shell或者使用<code>source</code>命令就可以直接使用了。</p><h4 id="_17-8-实例" tabindex="-1"><a class="header-anchor" href="#_17-8-实例" aria-hidden="true">#</a> 17.8 实例</h4><p><code>shtool</code>库提供了一些简单的shell脚本函数，可以用来完成日常的shell功能，例如处理临时文件和目录或者格式化输出显示。</p><h5 id="下载及安装" tabindex="-1"><a class="header-anchor" href="#下载及安装" aria-hidden="true">#</a> 下载及安装</h5><p>下载.tar.gz文件并在主目录使用<code>tar</code>命令提取。</p><h5 id="构建库" tabindex="-1"><a class="header-anchor" href="#构建库" aria-hidden="true">#</a> 构建库</h5><p>shtool文件必须针对特定的Linux环境进行配置。配置工作使用标准的<code>configure</code>和<code>make</code>命令。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#D8DEE9FF;">$ ./configure</span></span>
<span class="line"><span style="color:#D8DEE9FF;">$ make</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>configure</code>命令去检查构建shtool库文件所必须的软件，一旦发现所需的工具，会使用工具路径修改配置文件。</p><p><code>make</code>命令负责构建shtool库文件。直接输入<code>make</code>会测试这个库文件中所有的函数，测试通过之后，使用<code>sudo make install</code>将库安装到全局下。</p><h5 id="shtool库函数" tabindex="-1"><a class="header-anchor" href="#shtool库函数" aria-hidden="true">#</a> shtool库函数</h5><p>具体函数可去官网查。</p><p>使用格式：<code>shtool [options] [function [options] [args]]</code></p><h2 id="第四部分-创建实用的脚本" tabindex="-1"><a class="header-anchor" href="#第四部分-创建实用的脚本" aria-hidden="true">#</a> 第四部分 创建实用的脚本</h2><h3 id="第24章-编写简单的脚本实用工具" tabindex="-1"><a class="header-anchor" href="#第24章-编写简单的脚本实用工具" aria-hidden="true">#</a> 第24章 编写简单的脚本实用工具</h3><h4 id="_24-1-归档" tabindex="-1"><a class="header-anchor" href="#_24-1-归档" aria-hidden="true">#</a> 24.1 归档</h4><p>为了防止数据丢失，最好定时进行备份（归档）。</p><h5 id="归档数据文件" tabindex="-1"><a class="header-anchor" href="#归档数据文件" aria-hidden="true">#</a> 归档数据文件</h5><p>使用<code>tar</code>命令创建工作目录归档文件。<code>tar -zcf xxx.tar.gz xx/xxx/*.*</code>将xx/xxx目录下的所有文件归档到一个文件中并只用gzip压缩。</p><p>按小时归档数据：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;"># Hourly_Archive - Every hour create an archive</span></span>
<span class="line"><span style="color:#616E88;">#########################################################</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;"># Set Configuration File</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">config_file=/archive/hourly/Files_To_Backup.txt</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;"># Set Base Archive Destination Location</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">basedest=/archive/hourly</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;"># Gather Current Day, Month &amp; Time</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">day=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">date +%d</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">month=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">date +%m</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">time=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">date +%H%M</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;"># Create Archive Destination Directory</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">mkdir -p </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">basedest</span><span style="color:#D8DEE9FF;">/</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">month</span><span style="color:#D8DEE9FF;">/</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">day</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;"># Build Archive Destination File Name</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">destination=</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">basedest</span><span style="color:#D8DEE9FF;">/</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">month</span><span style="color:#D8DEE9FF;">/</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">day</span><span style="color:#D8DEE9FF;">/archive</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">time</span><span style="color:#D8DEE9FF;">.tar.gz</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;">######### Main Script #########################</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;"># Check Backup Config file exists</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-f</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">config_file</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">   </span><span style="color:#616E88;"># Make sure the config file still exists.</span></span>
<span class="line"><span style="color:#81A1C1;">then</span><span style="color:#D8DEE9FF;">                </span><span style="color:#616E88;"># If it exists, do nothing but continue on.</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#81A1C1;">else</span><span style="color:#D8DEE9FF;">                </span><span style="color:#616E88;"># If it doesn&#39;t exist, issue error &amp; exit script.</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">config_file</span><span style="color:#A3BE8C;"> does not exist.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Backup not completed due to missing Configuration File</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">exit</span></span>
<span class="line"><span style="color:#81A1C1;">fi</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;"># Build the names of all the files to backup</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">file_no=1               </span><span style="color:#616E88;"># Start on Line 1 of Config File.</span></span>
<span class="line"><span style="color:#88C0D0;">exec</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">&lt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">config_file</span><span style="color:#D8DEE9FF;">     </span><span style="color:#616E88;"># Redirect Std Input to name of Config File</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> file_name          </span><span style="color:#616E88;"># Read 1st record</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">?</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-eq</span><span style="color:#D8DEE9FF;"> 0 </span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">      </span><span style="color:#616E88;"># Create list of files to backup.</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#ECEFF4;">        </span><span style="color:#616E88;"># Make sure the file or directory exists.</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-f</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file_name</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-o</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-d</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file_name</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">then</span></span>
<span class="line"><span style="color:#ECEFF4;">          </span><span style="color:#616E88;"># If file exists, add its name to the list.</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          file_list=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file_list</span><span style="color:#A3BE8C;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file_name</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">else</span></span>
<span class="line"><span style="color:#ECEFF4;">          </span><span style="color:#616E88;"># If file doesn&#39;t exist, issue warning</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file_name</span><span style="color:#A3BE8C;">, does not exist.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Obviously, I will not include it in this archive.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">It is listed on line </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file_no</span><span style="color:#A3BE8C;"> of the config file.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Continuing to build archive list...</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">fi</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     file_no=$</span><span style="color:#ECEFF4;">[</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file_no</span><span style="color:#D8DEE9FF;"> + 1</span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">  </span><span style="color:#616E88;"># Increase Line/File number by one.</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> file_name           </span><span style="color:#616E88;"># Read next record.</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;">#######################################</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;"># Backup the files and Compress Archive</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Starting archive...</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">tar -czf </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">destination</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">file_list</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">2&gt;</span><span style="color:#D8DEE9FF;"> /dev/null</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Archive completed</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Resulting archive file is: </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">destination</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#88C0D0;">exit</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br></div></div><h4 id="_24-2-管理用户账户" tabindex="-1"><a class="header-anchor" href="#_24-2-管理用户账户" aria-hidden="true">#</a> 24.2 管理用户账户</h4><h5 id="需要的功能" tabindex="-1"><a class="header-anchor" href="#需要的功能" aria-hidden="true">#</a> 需要的功能</h5><p>删除账户的所需的4个步骤：</p><ol><li>获取正确的待删除用户账户名；</li><li>杀死正在系统上运行的属于该账户的进程；</li><li>确认系统中属于该账户的所有文件；</li><li>删除该用户账户</li></ol><p>**<code>xargs</code>**命令可以构建并执行来自标准输入STDIN的命令，它非常适合用在管道的末尾处。</p><p>**<code>find</code>**命令查找文件系统的文件。</p><h5 id="脚本实现" tabindex="-1"><a class="header-anchor" href="#脚本实现" aria-hidden="true">#</a> 脚本实现</h5><div class="language-bash ext-sh line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#616E88;">#!/bin/bash</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;">#Delete_User - Automates the 4 steps to remove an account</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;">###############################################################</span></span>
<span class="line"><span style="color:#616E88;"># Define Functions</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;">#####################################################</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">get_answer</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#88C0D0;">unset</span><span style="color:#D8DEE9FF;"> answer</span></span>
<span class="line"><span style="color:#D8DEE9FF;">ask_count=0</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#81A1C1;">while</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-z</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">answer</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">    </span><span style="color:#616E88;">#While no answer is given, keep asking.</span></span>
<span class="line"><span style="color:#81A1C1;">do</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     ask_count=$</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">ask_count</span><span style="color:#D8DEE9FF;"> + 1 </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">case</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">ask_count</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;">   </span><span style="color:#616E88;">#If user gives no answer in time allotted</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     2</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Please answer the question.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     3</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">One last try...please answer the question.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     4</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Since you refuse to answer the question...</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">exiting program.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#ECEFF4;">          </span><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">exit</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">esac</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-n</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">line2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">]</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">then</span><span style="color:#D8DEE9FF;">               </span><span style="color:#616E88;">#Print 2 lines</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">line1</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> -e </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">line2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> \c</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">else</span><span style="color:#D8DEE9FF;">                    </span><span style="color:#616E88;">#Print 1 line</span></span>
<span class="line"><span style="color:#D8DEE9FF;">          </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> -e </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">line1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> \c</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">fi</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;">#     Allow 60 seconds to answer before time-out</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">read</span><span style="color:#D8DEE9FF;"> -t 60 answer</span></span>
<span class="line"><span style="color:#81A1C1;">done</span></span>
<span class="line"><span style="color:#616E88;"># Do a little variable clean-up</span></span>
<span class="line"><span style="color:#88C0D0;">unset</span><span style="color:#D8DEE9FF;"> line1</span></span>
<span class="line"><span style="color:#88C0D0;">unset</span><span style="color:#D8DEE9FF;"> line2</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;">  </span><span style="color:#616E88;">#End of get_answer function</span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#616E88;">#####################################################</span></span>
<span class="line"><span style="color:#81A1C1;">function</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">process_answer</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">{</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">answer=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">echo </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">answer</span><span style="color:#A3BE8C;"> </span><span style="color:#81A1C1;">|</span><span style="color:#A3BE8C;"> cut -c1</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#81A1C1;">case</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">answer</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span></span>
<span class="line"><span style="color:#D8DEE9FF;">y</span><span style="color:#ECEFF4;">|</span><span style="color:#D8DEE9FF;">Y</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#616E88;"># If user answers &quot;yes&quot;, do nothing. </span></span>
<span class="line"><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#81A1C1;">*</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;">                   </span></span>
<span class="line"><span style="color:#616E88;"># If user answers anything but &quot;yes&quot;, exit script </span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">exit_line1</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">exit_line2</span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">        </span><span style="color:#88C0D0;">exit</span></span>
<span class="line"><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#81A1C1;">esac</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;"># Do a little variable clean-up</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#88C0D0;">unset</span><span style="color:#D8DEE9FF;"> exit_line1</span></span>
<span class="line"><span style="color:#88C0D0;">unset</span><span style="color:#D8DEE9FF;"> exit_line2</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#ECEFF4;">}</span><span style="color:#D8DEE9FF;"> </span><span style="color:#616E88;">#End of process_answer function</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;">##############################################</span></span>
<span class="line"><span style="color:#616E88;"># End of Function Definitions</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;">############# Main Script ####################</span></span>
<span class="line"><span style="color:#616E88;"># Get name of User Account to check </span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Step #1 - Determine User Account name to Delete </span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">line1=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Please enter the username of the user </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">line2=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">account you wish to delete from system:</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">get_answer</span></span>
<span class="line"><span style="color:#D8DEE9FF;">user_account=</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">answer</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;"># Double check with script user that this is the correct User Account </span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#D8DEE9FF;">line1=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Is </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#A3BE8C;"> the user account </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">line2=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">you wish to delete from the system? [y/n]</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">get_answer</span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#616E88;"># Call process_answer funtion: </span></span>
<span class="line"><span style="color:#616E88;">#     if user answers anything but &quot;yes&quot;, exit script</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">exit_line1=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Because the account, </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#A3BE8C;">, is not </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">exit_line1=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">the one you wish to delete, we are leaving the script...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">  </span></span>
<span class="line"><span style="color:#D8DEE9FF;">process_answer</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;">################################################################</span></span>
<span class="line"><span style="color:#616E88;"># Check that user_account is really an account on the system </span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#D8DEE9FF;">user_account_record=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">cat /etc/passwd </span><span style="color:#81A1C1;">|</span><span style="color:#A3BE8C;"> grep -w </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#81A1C1;">if</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">?</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">-eq</span><span style="color:#D8DEE9FF;"> 1 </span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">          </span><span style="color:#616E88;"># If the account is not found, exit script </span></span>
<span class="line"><span style="color:#81A1C1;">then</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Account, </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#A3BE8C;">, not found. </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Leaving the script...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">exit</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#81A1C1;">fi</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">I found this record:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account_record</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#D8DEE9FF;">line1=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Is this the correct User Account? [y/n]</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">get_answer</span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#616E88;"># Call process_answer function: </span></span>
<span class="line"><span style="color:#616E88;">#       if user answers anything but &quot;yes&quot;, exit script</span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#D8DEE9FF;">exit_line1=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Because the account, </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#A3BE8C;">, is not </span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">exit_line2=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">the one you wish to delete, we are leaving the script...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">process_answer</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#616E88;">##################################################################</span></span>
<span class="line"><span style="color:#616E88;"># Search for any running processes that belong to the User Account </span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Step #2 - Find process on system belonging to user account</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#D8DEE9FF;">ps -u </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;"> /dev/null  </span><span style="color:#616E88;">#List user processes running.  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#81A1C1;">case</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">?</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">1</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;">     </span><span style="color:#616E88;"># No processes running for this User Account </span></span>
<span class="line"><span style="color:#ECEFF4;">        </span><span style="color:#616E88;">#  </span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">There are no processes for this account currently running.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#81A1C1;">;;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">0</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;">   </span><span style="color:#616E88;"># Processes running for this User Account. </span></span>
<span class="line"><span style="color:#ECEFF4;">     </span><span style="color:#616E88;"># Ask Script User if wants us to kill the processes. </span></span>
<span class="line"><span style="color:#ECEFF4;">     </span><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#A3BE8C;"> has the following process(es) running:</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     ps -u </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span></span>
<span class="line"><span style="color:#ECEFF4;">     </span><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     line1=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Would you like me to kill the process(es)? [y/n]</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">     get_answer </span></span>
<span class="line"><span style="color:#ECEFF4;">     </span><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#D8DEE9FF;">     answer=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">echo </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">answer</span><span style="color:#A3BE8C;"> </span><span style="color:#81A1C1;">|</span><span style="color:#A3BE8C;"> cut -c1</span><span style="color:#ECEFF4;">)</span></span>
<span class="line"><span style="color:#ECEFF4;">     </span><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">case</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">answer</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">in</span><span style="color:#D8DEE9FF;">                  </span></span>
<span class="line"><span style="color:#D8DEE9FF;">     y</span><span style="color:#ECEFF4;">|</span><span style="color:#D8DEE9FF;">Y</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;">   </span><span style="color:#616E88;"># If user answers &quot;yes&quot;, </span></span>
<span class="line"><span style="color:#ECEFF4;">            </span><span style="color:#616E88;"># kill User Account processes. </span></span>
<span class="line"><span style="color:#ECEFF4;">            </span><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Killing off process(es)...</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">            </span><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#ECEFF4;">            </span><span style="color:#616E88;"># List user process running code in command_1</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            command_1=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ps -u </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#A3BE8C;"> --no-heading</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">            </span><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#ECEFF4;">            </span><span style="color:#616E88;"># Create command_3 to kill processes in variable</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            command_3=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">xargs -d </span><span style="color:#EBCB8B;">\\</span><span style="color:#A3BE8C;">n /usr/bin/sudo /bin/kill -9</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#ECEFF4;">            </span><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#ECEFF4;">            </span><span style="color:#616E88;"># Kill processes via piping commands together</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">command_1</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">|</span><span style="color:#D8DEE9FF;"> gawk </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">{print $1}</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">|</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">command_3</span></span>
<span class="line"><span style="color:#ECEFF4;">            </span><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Process(es) killed.</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">*</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;">     </span><span style="color:#616E88;">#If user answers anything but &quot;yes&quot;, do not kill.</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#D8DEE9FF;">            </span><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Will not kill process(es).</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">     </span><span style="color:#81A1C1;">esac</span></span>
<span class="line"><span style="color:#81A1C1;">;;</span></span>
<span class="line"><span style="color:#81A1C1;">esac</span></span>
<span class="line"><span style="color:#616E88;">#################################################################</span></span>
<span class="line"><span style="color:#616E88;"># Create a report of all files owned by User Account </span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Step #3 - Find files on system belonging to user account</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Creating a report of all files owned by </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#A3BE8C;">.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">It is recommended that you backup/archive these files,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">and then do one of two things:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">  1) Delete the files</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">  2) Change the files&#39; ownership to a current user account.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Please wait. This may take a while...</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#D8DEE9FF;">report_date=</span><span style="color:#ECEFF4;">$(</span><span style="color:#A3BE8C;">date +%y%m%d</span><span style="color:#ECEFF4;">)</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#D8DEE9FF;">report_file=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">_Files_</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">report_date</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">.rpt </span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#D8DEE9FF;">find / -user </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">report_file</span><span style="color:#D8DEE9FF;"> </span><span style="color:#81A1C1;">2&gt;</span><span style="color:#D8DEE9FF;">/dev/null </span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Report is complete.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Name of report:      </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">report_file</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> -n </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Location of report: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;"> </span><span style="color:#88C0D0;">pwd</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#616E88;">####################################</span></span>
<span class="line"><span style="color:#616E88;">#  Remove User Account</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Step #4 - Remove user account</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#D8DEE9FF;">line1=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Do you wish to remove </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#A3BE8C;">&#39;s account from system? [y/n]</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">get_answer</span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#616E88;"># Call process_answer function: </span></span>
<span class="line"><span style="color:#616E88;">#       if user answers anything but &quot;yes&quot;, exit script</span></span>
<span class="line"><span style="color:#616E88;"># </span></span>
<span class="line"><span style="color:#D8DEE9FF;">exit_line1=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Since you do not wish to remove the user account,</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">exit_line2=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#A3BE8C;"> at this time, exiting the script...</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#D8DEE9FF;">process_answer</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#D8DEE9FF;">userdel </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#D8DEE9FF;">          </span><span style="color:#616E88;">#delete user account</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span><span style="color:#D8DEE9FF;"> </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">User account, </span><span style="color:#81A1C1;">$</span><span style="color:#D8DEE9;">user_account</span><span style="color:#A3BE8C;">, has been removed</span><span style="color:#ECEFF4;">&quot;</span></span>
<span class="line"><span style="color:#88C0D0;">echo</span></span>
<span class="line"><span style="color:#616E88;">#</span></span>
<span class="line"><span style="color:#88C0D0;">exit</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br></div></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: czl624824554@163.com">chenzilin</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog-site/assets/app.5b55431a.js" defer></script>
  </body>
</html>
