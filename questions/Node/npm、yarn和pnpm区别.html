<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/images/578220.jpg"><title>Leon Chen</title><meta name="description" content="">
    <link rel="modulepreload" href="/blog-site/assets/app.06e41ebd.js"><link rel="modulepreload" href="/blog-site/assets/npm、yarn和pnpm区别.html.425bac93.js"><link rel="modulepreload" href="/blog-site/assets/npm、yarn和pnpm区别.html.2b5862c1.js"><link rel="modulepreload" href="/blog-site/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/blog-site/assets/style.5c2fd74e.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog-site/" class=""><img class="logo" src="/blog-site/images/578220.jpg" alt="Leon Chen"><span class="site-name can-hide">Leon Chen</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog-site/program" class="" aria-label="编程"><!--[--><!--]--> 编程 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/promote" class="" aria-label="课外提升"><!--[--><!--]--> 课外提升 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/questions" class="router-link-active" aria-label="疑问清单"><!--[--><!--]--> 疑问清单 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog-site/program" class="" aria-label="编程"><!--[--><!--]--> 编程 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/promote" class="" aria-label="课外提升"><!--[--><!--]--> 课外提升 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog-site/questions" class="router-link-active" aria-label="疑问清单"><!--[--><!--]--> 疑问清单 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/questions/Node/npm%E3%80%81yarn%E5%92%8Cpnpm%E5%8C%BA%E5%88%AB.html#npm与yarn的区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="npm与yarn的区别"><!--[--><!--]--> npm与yarn的区别 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/questions/Node/npm%E3%80%81yarn%E5%92%8Cpnpm%E5%8C%BA%E5%88%AB.html#pnpm优点" class="router-link-active router-link-exact-active sidebar-item" aria-label="pnpm优点"><!--[--><!--]--> pnpm优点 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/questions/Node/npm%E3%80%81yarn%E5%92%8Cpnpm%E5%8C%BA%E5%88%AB.html#速度快" class="router-link-active router-link-exact-active sidebar-item" aria-label="速度快"><!--[--><!--]--> 速度快 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/questions/Node/npm%E3%80%81yarn%E5%92%8Cpnpm%E5%8C%BA%E5%88%AB.html#高效利用磁盘空间" class="router-link-active router-link-exact-active sidebar-item" aria-label="高效利用磁盘空间"><!--[--><!--]--> 高效利用磁盘空间 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/questions/Node/npm%E3%80%81yarn%E5%92%8Cpnpm%E5%8C%BA%E5%88%AB.html#支持monorepo" class="router-link-active router-link-exact-active sidebar-item" aria-label="支持monorepo"><!--[--><!--]--> 支持monorepo <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/questions/Node/npm%E3%80%81yarn%E5%92%8Cpnpm%E5%8C%BA%E5%88%AB.html#安全性高" class="router-link-active router-link-exact-active sidebar-item" aria-label="安全性高"><!--[--><!--]--> 安全性高 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/blog-site/questions/Node/npm%E3%80%81yarn%E5%92%8Cpnpm%E5%8C%BA%E5%88%AB.html#依赖管理" class="router-link-active router-link-exact-active sidebar-item" aria-label="依赖管理"><!--[--><!--]--> 依赖管理 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/blog-site/questions/Node/npm%E3%80%81yarn%E5%92%8Cpnpm%E5%8C%BA%E5%88%AB.html#yarn-npm-install原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="yarn/npm install原理"><!--[--><!--]--> yarn/npm install原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/blog-site/questions/Node/npm%E3%80%81yarn%E5%92%8Cpnpm%E5%8C%BA%E5%88%AB.html#pnpm依赖管理" class="router-link-active router-link-exact-active sidebar-item" aria-label="pnpm依赖管理"><!--[--><!--]--> pnpm依赖管理 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h2 id="npm与yarn的区别" tabindex="-1"><a class="header-anchor" href="#npm与yarn的区别" aria-hidden="true">#</a> npm与yarn的区别</h2><ul><li>npm基于队列install，而yarn是并行安装，所以在安装速度上，yarn更快。</li><li>npm安装的打印信息没有yarn整洁干净。</li></ul><h2 id="pnpm优点" tabindex="-1"><a class="header-anchor" href="#pnpm优点" aria-hidden="true">#</a> pnpm优点</h2><h3 id="速度快" tabindex="-1"><a class="header-anchor" href="#速度快" aria-hidden="true">#</a> 速度快</h3><p>pnpm的安装速度比yarn/npm快2-3倍，即使yarn有PnP（去掉node_modules，将依赖包内容写在磁盘，节省了node文件I/O的开销），但是pnpm还是更胜一筹。</p><h3 id="高效利用磁盘空间" tabindex="-1"><a class="header-anchor" href="#高效利用磁盘空间" aria-hidden="true">#</a> 高效利用磁盘空间</h3><p>pnpm内部使用<strong>基于内容寻址</strong>的文件系统来存储磁盘上所有的文件，它的优点在于：</p><p>所有文件都会存储在硬盘上的某一位置。 当软件包被被安装时，包里的文件会<strong>硬链接</strong>到这一位置，而不会占用额外的磁盘空间。 这允许你跨项目地共享同一版本的依赖。</p><p>不会重复安装同一个包。用 npm/yarn 的时候，如果 100 个项目都依赖 lodash，那么 lodash 很可能就被安装了 100 次，磁盘中就有 100 个地方写入了这部分代码。但在使用 pnpm 只会安装一次，磁盘中只有一个地方写入，后面再次使用都会直接使用 <code>hardlink</code>硬链接。</p><p>即使一个包的不同版本，pnpm也会极大地复用之前版本的代码，比如更新版本之后多了一个文件，pnpm会仅仅写入那一个新增的文件。</p><h3 id="支持monorepo" tabindex="-1"><a class="header-anchor" href="#支持monorepo" aria-hidden="true">#</a> 支持monorepo</h3><p>pnpm 与 npm/yarn 另外一个很大的不同就是支持了 monorepo（用一个git仓库来管理多个子项目），体现在各个子命令的功能上，比如在根目录下 <code>pnpm add A -r</code>, 那么所有的 package 中都会被添加 A 这个依赖，当然也支持 <code>--filter</code>字段来对 package 进行过滤。</p><h3 id="安全性高" tabindex="-1"><a class="header-anchor" href="#安全性高" aria-hidden="true">#</a> 安全性高</h3><p>之前在使用 npm/yarn 的时候，由于 node_module 的扁平结构，如果 A 依赖 B， B 依赖 C，那么 A 当中是可以直接使用 C 的，但问题是 A 当中并没有声明 C 这个依赖。因此会出现这种非法访问的情况。但 pnpm 脑洞特别大，自创了一套依赖管理方式，很好地解决了这个问题，保证了安全性，具体怎么体现<code>安全</code>、规避非法访问依赖的<code>风险</code>。</p><h2 id="依赖管理" tabindex="-1"><a class="header-anchor" href="#依赖管理" aria-hidden="true">#</a> 依赖管理</h2><h3 id="yarn-npm-install原理" tabindex="-1"><a class="header-anchor" href="#yarn-npm-install原理" aria-hidden="true">#</a> yarn/npm install原理</h3><p>在npm3之前，使用的是依赖嵌套。</p><div class="language-text ext-text line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#d8dee9ff;">node_modules</span></span>
<span class="line"><span style="color:#d8dee9ff;">└─ foo</span></span>
<span class="line"><span style="color:#d8dee9ff;">   ├─ index.js</span></span>
<span class="line"><span style="color:#d8dee9ff;">   ├─ package.json</span></span>
<span class="line"><span style="color:#d8dee9ff;">   └─ node_modules</span></span>
<span class="line"><span style="color:#d8dee9ff;">      └─ bar</span></span>
<span class="line"><span style="color:#d8dee9ff;">         ├─ index.js</span></span>
<span class="line"><span style="color:#d8dee9ff;">         └─ package.json</span></span>
<span class="line"><span style="color:#d8dee9ff;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>而npm3之后，使用的是<strong>扁平化</strong>依赖管理。</p><div class="language-text ext-text line-numbers-mode"><pre class="shiki" style="background-color:#2e3440ff;"><code><span class="line"><span style="color:#d8dee9ff;">node_modules</span></span>
<span class="line"><span style="color:#d8dee9ff;">├─ foo</span></span>
<span class="line"><span style="color:#d8dee9ff;">|  ├─ index.js</span></span>
<span class="line"><span style="color:#d8dee9ff;">|  └─ package.json</span></span>
<span class="line"><span style="color:#d8dee9ff;">└─ bar</span></span>
<span class="line"><span style="color:#d8dee9ff;">   ├─ index.js</span></span>
<span class="line"><span style="color:#d8dee9ff;">   └─ package.json</span></span>
<span class="line"><span style="color:#d8dee9ff;"></span></span></code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>扁平化管理的缺点：</p><ul><li>依赖结构的不确定性</li><li>扁平化算法本身的复杂性很高，耗时很长</li><li>项目中仍然可以非法访问没有声明过的依赖包</li></ul><h3 id="pnpm依赖管理" tabindex="-1"><a class="header-anchor" href="#pnpm依赖管理" aria-hidden="true">#</a> pnpm依赖管理</h3><p>使用pnpm install之后，在node_modules下</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/eqDAax.png" alt="eqDAax"></p><p>我们直接就看到了我们在package.json中定义的依赖包，但值得注意的是，这里仅仅只是一个<code>软链接</code>，里面并没有node_modules，其实包的依赖包都放到了<code>.pnpm</code>中管理。</p><p><img src="https://images-1256612942.cos.ap-guangzhou.myqcloud.com/3D70Nv.png" alt="3D70Nv"></p><p>比如axios，需要根据对应的版本号的包下才能找到真正的axios，包的位置的规律都是<code>&lt;package-name&gt;@version/node_modules/&lt;package-name&gt;</code>这种目录结构，这些依赖全部都是<strong>软连接</strong>。</p><p>这些包的依赖方式，避免了<strong>项目中非法访问没有声明过的依赖包</strong>的问题。</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: czl624824554@163.com">chenzilin</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog-site/assets/app.06e41ebd.js" defer></script>
  </body>
</html>
